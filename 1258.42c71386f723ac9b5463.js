(self.webpackChunkSoriana=self.webpackChunkSoriana||[]).push([[1258],{1258:(t,e,n)=>{"use strict";n.d(e,{Y:()=>h});var r=n(3018),s=n(9826),i=n(8945),o=n(5496),a=n(910),c=n(8583);function u(t,e){if(1&t){const t=r.EpF();r.TgZ(0,"ion-card",8),r.TgZ(1,"ion-grid"),r.TgZ(2,"ion-row"),r.TgZ(3,"ion-col",9),r._UZ(4,"img",10),r.qZA(),r.TgZ(5,"ion-col"),r.TgZ(6,"ion-row"),r.TgZ(7,"ion-col"),r.TgZ(8,"h5"),r.TgZ(9,"b"),r._uU(10),r.qZA(),r.qZA(),r.qZA(),r.TgZ(11,"ion-col"),r.TgZ(12,"ion-icon",11),r.NdJ("click",function(){const e=r.CHM(t).$implicit;return r.oxw().deleteProduct(e.id)}),r.qZA(),r.qZA(),r.qZA(),r.TgZ(13,"ion-row"),r.TgZ(14,"ion-col",12),r.TgZ(15,"ion-label"),r._uU(16,"Cantidad"),r.qZA(),r._UZ(17,"ion-input",13),r.qZA(),r.TgZ(18,"ion-col"),r.TgZ(19,"h4"),r.TgZ(20,"b"),r._uU(21),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.qZA()}if(2&t){const t=e.$implicit;r.xp6(4),r.Q6J("src",t.image,r.LSH),r.xp6(6),r.Oqu(t.name),r.xp6(11),r.hij("$",t.price,"")}}let h=(()=>{class t{constructor(t,e,n,r,s){this.authSvc=t,this.cdr=e,this.modalCtrl=n,this.route=r,this.cartService=s,this.items=this.cartService.getItems(),this.subtotal=this.cartService.getSubtotal().toString(),this.total=this.cartService.getTotal()}ngOnInit(){}ngAfterViewInit(){this.cdr.detectChanges()}cerrar(){this.modalCtrl.dismiss()}compra(){let t=this.cartService.getNumberItems(),e=this.authSvc.getEstatusLogin();t>0&&1==e&&(this.route.navigate(["compra"]),this.modalCtrl.dismiss()),0==t&&1==e&&window.alert("El carrito est\xe1 vac\xedo"),0==t&&0==e&&window.alert("El carrito est\xe1 vac\xedo y debe iniciar sesi\xf3n"),t>0&&0==e&&(window.alert("Debe iniciar sesi\xf3n"),this.modalCtrl.dismiss(),this.route.navigate(["login"]))}actualizar(){this.subtotal=this.cartService.getSubtotal().toString(),this.total=this.cartService.getSubtotal()+49}eliminar(){this.cartService.getNumberItems()>0?(this.cartService.emptyCart(),this.actualizar()):window.alert("El carrito esta vacio")}deleteProduct(t){this.cartService.removeProduct(t),this.actualizar()}}return t.\u0275fac=function(e){return new(e||t)(r.Y36(s.e),r.Y36(r.sBO),r.Y36(i.IN),r.Y36(o.F0),r.Y36(a.N))},t.\u0275cmp=r.Xpm({type:t,selectors:[["app-modal-carrito"]],decls:28,vars:3,consts:[["color","rosa"],["size","11",2,"margin-block-start","5px"],["name","close-outline",1,"close",3,"click"],["class","producto-card","color","natural",4,"ngFor","ngForOf"],[2,"margin-top","160px"],[1,"vaciar",3,"click"],[1,"precios"],["color","pasto",2,"margin-left","140px",3,"click"],["color","natural",1,"producto-card"],["size","3.5"],[3,"src"],["name","trash-outline",1,"trash",3,"click"],["size","9"],["type","number","value","1","required","true",2,"width","40px"]],template:function(t,e){1&t&&(r.TgZ(0,"ion-header"),r.TgZ(1,"ion-toolbar",0),r.TgZ(2,"ion-grid"),r.TgZ(3,"ion-row"),r.TgZ(4,"ion-col",1),r.TgZ(5,"ion-title"),r._uU(6,"Mi carrito"),r.qZA(),r.qZA(),r.TgZ(7,"ion-col"),r.TgZ(8,"ion-icon",2),r.NdJ("click",function(){return e.cerrar()}),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.TgZ(9,"ion-content"),r.YNc(10,u,22,3,"ion-card",3),r._UZ(11,"ion-item-divider",4),r.TgZ(12,"h6",5),r.NdJ("click",function(){return e.eliminar()}),r._uU(13,"Vaciar carrito"),r.qZA(),r.TgZ(14,"div",6),r.TgZ(15,"h5"),r.TgZ(16,"b"),r._uU(17,"Subtotal: "),r.qZA(),r._uU(18),r.qZA(),r.TgZ(19,"h5"),r.TgZ(20,"b"),r._uU(21,"Costo de env\xedo: "),r.qZA(),r._uU(22,"$49"),r.qZA(),r.TgZ(23,"h3"),r.TgZ(24,"b"),r._uU(25),r.qZA(),r.qZA(),r.qZA(),r.TgZ(26,"ion-button",7),r.NdJ("click",function(){return e.compra()}),r._uU(27,"Continuar con la compra"),r.qZA(),r.qZA()),2&t&&(r.xp6(10),r.Q6J("ngForOf",e.items),r.xp6(8),r.hij("$",e.subtotal,""),r.xp6(7),r.hij("Total: $",e.total," "))},directives:[i.Gu,i.sr,i.jY,i.Nd,i.wI,i.wd,i.gu,i.W2,c.sg,i.rH,i.YG,i.PM,i.Q$,i.pK,i.as],styles:[".close[_ngcontent-%COMP%]{height:30px;width:30px;cursor:pointer}.vaciar[_ngcontent-%COMP%]{margin-left:20px;cursor:pointer;color:darkred}.precios[_ngcontent-%COMP%]{margin-left:270px;margin-bottom:20px}img[_ngcontent-%COMP%]{margin-left:7px;margin-top:7px;width:100px;height:100px}.margins[_ngcontent-%COMP%]{margin-left:50px;margin-top:50px}.margins[_ngcontent-%COMP%], .trash[_ngcontent-%COMP%]{cursor:pointer;text-decoration:blink}.trash[_ngcontent-%COMP%]{width:20px;height:20px;margin-top:15px;margin-left:90px}.edit[_ngcontent-%COMP%]{width:200px;height:30px;margin-top:10px;margin-left:250px;cursor:pointer;text-decoration:blink}.margin-toolbar[_ngcontent-%COMP%]{margin-top:10px;margin-bottom:20px}.cantidad[_ngcontent-%COMP%]{margin-left:120px}.carrito-title[_ngcontent-%COMP%]{margin-left:60px;margin-top:20px;color:darkred;margin-bottom:20px}.producto-card[_ngcontent-%COMP%]{margin-left:60px;height:170px;width:400px;padding-bottom:50px}.text-area[_ngcontent-%COMP%]{width:370px;height:100px;--background:#fbfbfb}.carrito-subtitle[_ngcontent-%COMP%]{margin-left:60px}.continuar[_ngcontent-%COMP%]{margin-left:350px;width:200px}.vaciar[_ngcontent-%COMP%]{--border-color:#b11a0e;--color:#b11a0e;--background:#fbfbfb}.ion-color-rosa[_ngcontent-%COMP%]{--ion-color-base:var(--ion-color-rosa);--ion-color-base-rgb:var(--ion-color-rosa-rgb);--ion-color-contrast:var(--ion-color-rosa-contrast);--ion-color-contrast-rgb:var(--ion-color-rosa-contrast-rgb);--ion-color-shade:var(--ion-color-rosa-shade);--ion-color-tint:var(--ion-color-rosa-tint)}.ion-color-pasto[_ngcontent-%COMP%]{--ion-color-base:var(--ion-color-pasto);--ion-color-base-rgb:var(--ion-color-pasto-rgb);--ion-color-contrast:var(--ion-color-pasto-contrast);--ion-color-contrast-rgb:var(--ion-color-pasto-contrast-rgb);--ion-color-shade:var(--ion-color-pasto-shade);--ion-color-tint:var(--ion-color-pasto-tint)}.ion-color-porcelana[_ngcontent-%COMP%]{--ion-color-base:var(--ion-color-porcelana);--ion-color-base-rgb:var(--ion-color-porcelana-rgb);--ion-color-contrast:var(--ion-color-porcelana-contrast);--ion-color-contrast-rgb:var(--ion-color-porcelana-contrast-rgb);--ion-color-shade:var(--ion-color-porcelana-shade);--ion-color-tint:var(--ion-color-porcelana-tint)}.ion-color-natural[_ngcontent-%COMP%]{--ion-color-base:var(--ion-color-natural);--ion-color-base-rgb:var(--ion-color-natural-rgb);--ion-color-contrast:var(--ion-color-natural-contrast);--ion-color-contrast-rgb:var(--ion-color-natural-contrast-rgb);--ion-color-shade:var(--ion-color-natural-shade);--ion-color-tint:var(--ion-color-natural-tint)}"]}),t})()},9826:(t,e,n)=>{"use strict";n.d(e,{e:()=>fg});var r=n(4762),s=n(5917),i=n(3190),o=n(3018),a=n(8006),c=n(3637),u=n(7574),h=n(4402),l=n(6643),d=n(9761),f=n(7393);function g(){return t=>t.lift(new m)}class m{call(t,e){return e.subscribe(new p(t))}}class p extends f.L{constructor(t){super(t),this.hasPrev=!1}_next(t){let e;this.hasPrev?e=[this.prev,t]:this.hasPrev=!0,this.prev=t,e&&this.destination.next(e)}}var y,w=n(8002),v=n(2145),b=n(7519),T=n(5435),I=n(8939),E=n(8583),_=(n(5841),n(4486)),S=n(5452),N=n(6034),A=n(5601),D=n(3854),x="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},C={},k=k||{},L=x||self;function R(){}function O(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function P(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var F="closure_uid_"+(1e9*Math.random()>>>0),M=0;function q(t,e,n){return t.call.apply(t.bind,arguments)}function U(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function V(t,e,n){return(V=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?q:U).apply(null,arguments)}function B(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function j(t,e){function n(){}n.prototype=e.prototype,t.Z=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Vb=function(t,n,r){for(var s=Array(arguments.length-2),i=2;i<arguments.length;i++)s[i-2]=arguments[i];return e.prototype[n].apply(t,s)}}function K(){this.s=this.s,this.o=this.o}var z={};K.prototype.s=!1,K.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var t=function(t){return Object.prototype.hasOwnProperty.call(t,F)&&t[F]||(t[F]=++M)}(this);delete z[t]}},K.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const $=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(let n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},G=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){const r=t.length,s="string"==typeof t?t.split(""):t;for(let i=0;i<r;i++)i in s&&e.call(n,s[i],i,t)};function H(t){return Array.prototype.concat.apply([],arguments)}function Q(t){const e=t.length;if(0<e){const n=Array(e);for(let r=0;r<e;r++)n[r]=t[r];return n}return[]}function W(t){return/^[\s\xa0]*$/.test(t)}var Y,Z=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function J(t,e){return-1!=t.indexOf(e)}function X(t,e){return t<e?-1:t>e?1:0}t:{var tt=L.navigator;if(tt){var et=tt.userAgent;if(et){Y=et;break t}}Y=""}function nt(t,e,n){for(const r in t)e.call(n,t[r],r,t)}function rt(t){const e={};for(const n in t)e[n]=t[n];return e}var st="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function it(t,e){let n,r;for(let s=1;s<arguments.length;s++){for(n in r=arguments[s],r)t[n]=r[n];for(let e=0;e<st.length;e++)n=st[e],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function ot(t){return ot[" "](t),t}ot[" "]=R;var at,ct,ut=J(Y,"Opera"),ht=J(Y,"Trident")||J(Y,"MSIE"),lt=J(Y,"Edge"),dt=lt||ht,ft=J(Y,"Gecko")&&!(J(Y.toLowerCase(),"webkit")&&!J(Y,"Edge"))&&!(J(Y,"Trident")||J(Y,"MSIE"))&&!J(Y,"Edge"),gt=J(Y.toLowerCase(),"webkit")&&!J(Y,"Edge");function mt(){var t=L.document;return t?t.documentMode:void 0}t:{var pt="",yt=(ct=Y,ft?/rv:([^\);]+)(\)|;)/.exec(ct):lt?/Edge\/([\d\.]+)/.exec(ct):ht?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(ct):gt?/WebKit\/(\S+)/.exec(ct):ut?/(?:Version)[ \/]?(\S+)/.exec(ct):void 0);if(yt&&(pt=yt?yt[1]:""),ht){var wt=mt();if(null!=wt&&wt>parseFloat(pt)){at=String(wt);break t}}at=pt}var vt={};var bt=L.document&&ht&&(mt()||parseInt(at,10))||void 0,Tt=function(){if(!L.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{L.addEventListener("test",R,e),L.removeEventListener("test",R,e)}catch(n){}return t}();function It(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}function Et(t,e){if(It.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(ft){t:{try{ot(e.nodeName);var s=!0;break t}catch(i){}s=!1}s||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:_t[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&Et.Z.h.call(this)}}It.prototype.h=function(){this.defaultPrevented=!0},j(Et,It);var _t={2:"touch",3:"pen",4:"mouse"};Et.prototype.h=function(){Et.Z.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var St="closure_listenable_"+(1e6*Math.random()|0),Nt=0;function At(t,e,n,r,s){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ia=s,this.key=++Nt,this.ca=this.fa=!1}function Dt(t){t.ca=!0,t.listener=null,t.proxy=null,t.src=null,t.ia=null}function xt(t){this.src=t,this.g={},this.h=0}function Ct(t,e){var n=e.type;if(n in t.g){var r,s=t.g[n],i=$(s,e);(r=0<=i)&&Array.prototype.splice.call(s,i,1),r&&(Dt(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function kt(t,e,n,r){for(var s=0;s<t.length;++s){var i=t[s];if(!i.ca&&i.listener==e&&i.capture==!!n&&i.ia==r)return s}return-1}xt.prototype.add=function(t,e,n,r,s){var i=t.toString();(t=this.g[i])||(t=this.g[i]=[],this.h++);var o=kt(t,e,r,s);return-1<o?(e=t[o],n||(e.fa=!1)):((e=new At(e,this.src,i,!!r,s)).fa=n,t.push(e)),e};var Lt="closure_lm_"+(1e6*Math.random()|0),Rt={};function Ot(t,e,n,r,s){if(r&&r.once)return Ft(t,e,n,r,s);if(Array.isArray(e)){for(var i=0;i<e.length;i++)Ot(t,e[i],n,r,s);return null}return n=Kt(n),t&&t[St]?t.N(e,n,P(r)?!!r.capture:!!r,s):Pt(t,e,n,!1,r,s)}function Pt(t,e,n,r,s,i){if(!e)throw Error("Invalid event type");var o=P(s)?!!s.capture:!!s,a=Bt(t);if(a||(t[Lt]=a=new xt(t)),(n=a.add(e,n,r,o,i)).proxy)return n;if(r=function(){var t=Vt;return function e(n){return t.call(e.src,e.listener,n)}}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)Tt||(s=o),void 0===s&&(s=!1),t.addEventListener(e.toString(),r,s);else if(t.attachEvent)t.attachEvent(Ut(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Ft(t,e,n,r,s){if(Array.isArray(e)){for(var i=0;i<e.length;i++)Ft(t,e[i],n,r,s);return null}return n=Kt(n),t&&t[St]?t.O(e,n,P(r)?!!r.capture:!!r,s):Pt(t,e,n,!0,r,s)}function Mt(t,e,n,r,s){if(Array.isArray(e))for(var i=0;i<e.length;i++)Mt(t,e[i],n,r,s);else r=P(r)?!!r.capture:!!r,n=Kt(n),t&&t[St]?(t=t.i,(e=String(e).toString())in t.g&&-1<(n=kt(i=t.g[e],n,r,s))&&(Dt(i[n]),Array.prototype.splice.call(i,n,1),0==i.length&&(delete t.g[e],t.h--))):t&&(t=Bt(t))&&(e=t.g[e.toString()],t=-1,e&&(t=kt(e,n,r,s)),(n=-1<t?e[t]:null)&&qt(n))}function qt(t){if("number"!=typeof t&&t&&!t.ca){var e=t.src;if(e&&e[St])Ct(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Ut(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Bt(e))?(Ct(n,t),0==n.h&&(n.src=null,e[Lt]=null)):Dt(t)}}}function Ut(t){return t in Rt?Rt[t]:Rt[t]="on"+t}function Vt(t,e){if(t.ca)t=!0;else{e=new Et(e,this);var n=t.listener,r=t.ia||t.src;t.fa&&qt(t),t=n.call(r,e)}return t}function Bt(t){return(t=t[Lt])instanceof xt?t:null}var jt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Kt(t){return"function"==typeof t?t:(t[jt]||(t[jt]=function(e){return t.handleEvent(e)}),t[jt])}function zt(){K.call(this),this.i=new xt(this),this.P=this,this.I=null}function $t(t,e){var n,r=t.I;if(r)for(n=[];r;r=r.I)n.push(r);if(t=t.P,r=e.type||e,"string"==typeof e)e=new It(e,t);else if(e instanceof It)e.target=e.target||t;else{var s=e;it(e=new It(r,t),s)}if(s=!0,n)for(var i=n.length-1;0<=i;i--){var o=e.g=n[i];s=Gt(o,r,!0,e)&&s}if(s=Gt(o=e.g=t,r,!0,e)&&s,s=Gt(o,r,!1,e)&&s,n)for(i=0;i<n.length;i++)s=Gt(o=e.g=n[i],r,!1,e)&&s}function Gt(t,e,n,r){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var s=!0,i=0;i<e.length;++i){var o=e[i];if(o&&!o.ca&&o.capture==n){var a=o.listener,c=o.ia||o.src;o.fa&&Ct(t.i,o),s=!1!==a.call(c,r)&&s}}return s&&!r.defaultPrevented}j(zt,K),zt.prototype[St]=!0,zt.prototype.removeEventListener=function(t,e,n,r){Mt(this,t,e,n,r)},zt.prototype.M=function(){if(zt.Z.M.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)Dt(n[r]);delete e.g[t],e.h--}}this.I=null},zt.prototype.N=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)},zt.prototype.O=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};var Ht=L.JSON.stringify;function Qt(){var t=ee;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var Wt,Yt=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}(()=>new Zt,t=>t.reset());class Zt{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}}function Jt(t){L.setTimeout(()=>{throw t},0)}function Xt(t,e){Wt||function(){var t=L.Promise.resolve(void 0);Wt=function(){t.then(ne)}}(),te||(Wt(),te=!0),ee.add(t,e)}var te=!1,ee=new class{constructor(){this.h=this.g=null}add(t,e){const n=Yt.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n}};function ne(){for(var t;t=Qt();){try{t.h.call(t.g)}catch(n){Jt(n)}var e=Yt;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}te=!1}function re(t,e){zt.call(this),this.h=t||1,this.g=e||L,this.j=V(this.kb,this),this.l=Date.now()}function se(t){t.da=!1,t.S&&(t.g.clearTimeout(t.S),t.S=null)}function ie(t,e,n){if("function"==typeof t)n&&(t=V(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=V(t.handleEvent,t)}return 2147483647<Number(e)?-1:L.setTimeout(t,e||0)}function oe(t){t.g=ie(()=>{t.g=null,t.i&&(t.i=!1,oe(t))},t.j);const e=t.h;t.h=null,t.m.apply(null,e)}j(re,zt),(y=re.prototype).da=!1,y.S=null,y.kb=function(){if(this.da){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-t):(this.S&&(this.g.clearTimeout(this.S),this.S=null),$t(this,"tick"),this.da&&(se(this),this.start()))}},y.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},y.M=function(){re.Z.M.call(this),se(this),delete this.g};class ae extends K{constructor(t,e){super(),this.m=t,this.j=e,this.h=null,this.i=!1,this.g=null}l(t){this.h=arguments,this.g?this.i=!0:oe(this)}M(){super.M(),this.g&&(L.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ce(t){K.call(this),this.h=t,this.g={}}j(ce,K);var ue=[];function he(t,e,n,r){Array.isArray(n)||(n&&(ue[0]=n.toString()),n=ue);for(var s=0;s<n.length;s++){var i=Ot(e,n[s],r||t.handleEvent,!1,t.h||t);if(!i)break;t.g[i.key]=i}}function le(t){nt(t.g,function(t,e){this.g.hasOwnProperty(e)&&qt(t)},t),t.g={}}function de(){this.g=!0}function fe(t,e,n,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var s=r[1];if(Array.isArray(s)&&!(1>s.length)){var i=s[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(var o=1;o<s.length;o++)s[o]=""}}}return Ht(n)}catch(a){return e}}(t,n)+(r?" "+r:"")})}ce.prototype.M=function(){ce.Z.M.call(this),le(this)},ce.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},de.prototype.Aa=function(){this.g=!1},de.prototype.info=function(){};var ge={},me=null;function pe(){return me=me||new zt}function ye(t){It.call(this,ge.Ma,t)}function we(t){const e=pe();$t(e,new ye(e,t))}function ve(t,e){It.call(this,ge.STAT_EVENT,t),this.stat=e}function be(t){const e=pe();$t(e,new ve(e,t))}function Te(t,e){It.call(this,ge.Na,t),this.size=e}function Ie(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return L.setTimeout(function(){t()},e)}ge.Ma="serverreachability",j(ye,It),ge.STAT_EVENT="statevent",j(ve,It),ge.Na="timingevent",j(Te,It);var Ee={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},_e={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function Se(){}function Ne(){}Se.prototype.h=null;var Ae,De={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function xe(){It.call(this,"d")}function Ce(){It.call(this,"c")}function ke(){}function Le(t,e,n,r){this.l=t,this.j=e,this.m=n,this.X=r||1,this.V=new ce(this),this.P=Oe,this.W=new re(t=dt?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new Re}function Re(){this.i=null,this.g="",this.h=!1}j(xe,It),j(Ce,It),j(ke,Se),ke.prototype.g=function(){return new XMLHttpRequest},ke.prototype.i=function(){return{}},Ae=new ke;var Oe=45e3,Pe={},Fe={};function Me(t,e,n){t.K=1,t.v=an(tn(e)),t.s=n,t.U=!0,qe(t,null)}function qe(t,e){t.F=Date.now(),je(t),t.A=tn(t.v);var n=t.A,r=t.X;Array.isArray(r)||(r=[String(r)]),bn(n.h,"t",r),t.C=0,n=t.l.H,t.h=new Re,t.g=br(t.l,n?e:null,!t.s),0<t.O&&(t.L=new ae(V(t.Ia,t,t.g),t.O)),he(t.V,t.g,"readystatechange",t.gb),e=t.H?rt(t.H):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ea(t.A,t.u,t.s,e)):(t.u="GET",t.g.ea(t.A,t.u,null,e)),we(1),function(t,e,n,r,s,i){t.info(function(){if(t.g)if(i)for(var o="",a=i.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var h=u[0];u=u[1];var l=h.split("_");o=2<=l.length&&"type"==l[1]?o+(h+"=")+u+"&":o+(h+"=redacted&")}}else o=null;else o=i;return"XMLHTTP REQ ("+r+") [attempt "+s+"]: "+e+"\n"+n+"\n"+o})}(t.j,t.u,t.A,t.m,t.X,t.s)}function Ue(t){return!!t.g&&"GET"==t.u&&2!=t.K&&t.l.Ba}function Ve(t,e,n){let r,s=!0;for(;!t.I&&t.C<n.length;){if(r=Be(t,n),r==Fe){4==e&&(t.o=4,be(14),s=!1),fe(t.j,t.m,null,"[Incomplete Response]");break}if(r==Pe){t.o=4,be(15),fe(t.j,t.m,n,"[Invalid Chunk]"),s=!1;break}fe(t.j,t.m,r,null),He(t,r)}Ue(t)&&r!=Fe&&r!=Pe&&(t.h.g="",t.C=0),4!=e||0!=n.length||t.h.h||(t.o=1,be(16),s=!1),t.i=t.i&&s,s?0<n.length&&!t.aa&&(t.aa=!0,(e=t.l).g==t&&e.$&&!e.L&&(e.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),dr(e),e.L=!0,be(11))):(fe(t.j,t.m,n,"[Invalid Chunked Response]"),Ge(t),$e(t))}function Be(t,e){var n=t.C,r=e.indexOf("\n",n);return-1==r?Fe:(n=Number(e.substring(n,r)),isNaN(n)?Pe:(r+=1)+n>e.length?Fe:(e=e.substr(r,n),t.C=r+n,e))}function je(t){t.Y=Date.now()+t.P,Ke(t,t.P)}function Ke(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=Ie(V(t.eb,t),e)}function ze(t){t.B&&(L.clearTimeout(t.B),t.B=null)}function $e(t){0==t.l.G||t.I||mr(t.l,t)}function Ge(t){ze(t);var e=t.L;e&&"function"==typeof e.na&&e.na(),t.L=null,se(t.W),le(t.V),t.g&&(e=t.g,t.g=null,e.abort(),e.na())}function He(t,e){try{var n=t.l;if(0!=n.G&&(n.g==t||Nn(n.i,t)))if(n.I=t.N,!t.J&&Nn(n.i,t)&&3==n.G){try{var r=n.Ca.g.parse(e)}catch(u){r=null}if(Array.isArray(r)&&3==r.length){var s=r;if(0==s[0]){t:if(!n.u){if(n.g){if(!(n.g.F+3e3<t.F))break t;gr(n),rr(n)}lr(n),be(18)}}else n.ta=s[1],0<n.ta-n.U&&37500>s[2]&&n.N&&0==n.A&&!n.v&&(n.v=Ie(V(n.ab,n),6e3));if(1>=Sn(n.i)&&n.ka){try{n.ka()}catch(u){}n.ka=void 0}}else yr(n,11)}else if((t.J||n.g==t)&&gr(n),!W(e))for(s=n.Ca.g.parse(e),e=0;e<s.length;e++){let u=s[e];if(n.U=u[0],u=u[1],2==n.G)if("c"==u[0]){n.J=u[1],n.la=u[2];const e=u[3];null!=e&&(n.ma=e,n.h.info("VER="+n.ma));const s=u[4];null!=s&&(n.za=s,n.h.info("SVER="+n.za));const h=u[5];null!=h&&"number"==typeof h&&0<h&&(n.K=r=1.5*h,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n;const l=t.g;if(l){const t=l.g?l.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var i=r.i;!i.g&&(J(t,"spdy")||J(t,"quic")||J(t,"h2"))&&(i.j=i.l,i.g=new Set,i.h&&(An(i,i.h),i.h=null))}if(r.D){const t=l.g?l.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(r.sa=t,on(r.F,r.D,t))}}n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-t.F,n.h.info("Handshake RTT: "+n.O+"ms"));var o=t;if((r=n).oa=vr(r,r.H?r.la:null,r.W),o.J){Dn(r.i,o);var a=o,c=r.K;c&&a.setTimeout(c),a.B&&(ze(a),je(a)),r.g=o}else hr(r);0<n.l.length&&or(n)}else"stop"!=u[0]&&"close"!=u[0]||yr(n,7);else 3==n.G&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?yr(n,7):nr(n):"noop"!=u[0]&&n.j&&n.j.wa(u),n.A=0)}we(4)}catch(u){}}function Qe(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(O(t)||"string"==typeof t)G(t,e,void 0);else{if(t.T&&"function"==typeof t.T)var n=t.T();else if(t.R&&"function"==typeof t.R)n=void 0;else if(O(t)||"string"==typeof t){n=[];for(var r=t.length,s=0;s<r;s++)n.push(s)}else for(s in n=[],r=0,t)n[r++]=s;s=(r=function(t){if(t.R&&"function"==typeof t.R)return t.R();if("string"==typeof t)return t.split("");if(O(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var i=0;i<s;i++)e.call(void 0,r[i],n&&n[i],t)}}function We(t,e){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof We)for(n=t.T(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function Ye(t){if(t.i!=t.g.length){for(var e=0,n=0;e<t.g.length;){var r=t.g[e];Ze(t.h,r)&&(t.g[n++]=r),e++}t.g.length=n}if(t.i!=t.g.length){var s={};for(n=e=0;e<t.g.length;)Ze(s,r=t.g[e])||(t.g[n++]=r,s[r]=1),e++;t.g.length=n}}function Ze(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(y=Le.prototype).setTimeout=function(t){this.P=t},y.gb=function(t){t=t.target;const e=this.L;e&&3==Zn(t)?e.l():this.Ia(t)},y.Ia=function(t){try{if(t==this.g)t:{const h=Zn(this.g);var e=this.g.Da();const l=this.g.ba();if(!(3>h)&&(3!=h||dt||this.g&&(this.h.h||this.g.ga()||Jn(this.g)))){this.I||4!=h||7==e||we(8==e||0>=l?3:2),ze(this);var n=this.g.ba();this.N=n;e:if(Ue(this)){var r=Jn(this.g);t="";var s=r.length,i=4==Zn(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Ge(this),$e(this);var o="";break e}this.h.i=new L.TextDecoder}for(e=0;e<s;e++)this.h.h=!0,t+=this.h.i.decode(r[e],{stream:i&&e==s-1});r.splice(0,s),this.h.g+=t,this.C=0,o=this.h.g}else o=this.g.ga();if(this.i=200==n,function(t,e,n,r,s,i,o){t.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+s+"]: "+e+"\n"+n+"\n"+i+" "+o})}(this.j,this.u,this.A,this.m,this.X,h,n),this.i){if(this.$&&!this.J){e:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!W(a)){var u=a;break e}}u=null}if(!(n=u)){this.i=!1,this.o=3,be(12),Ge(this),$e(this);break t}fe(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,He(this,n)}this.U?(Ve(this,h,o),dt&&this.i&&3==h&&(he(this.V,this.W,"tick",this.fb),this.W.start())):(fe(this.j,this.m,o,null),He(this,o)),4==h&&Ge(this),this.i&&!this.I&&(4==h?mr(this.l,this):(this.i=!1,je(this)))}else 400==n&&0<o.indexOf("Unknown SID")?(this.o=3,be(12)):(this.o=0,be(13)),Ge(this),$e(this)}}}catch(h){}},y.fb=function(){if(this.g){var t=Zn(this.g),e=this.g.ga();this.C<e.length&&(ze(this),Ve(this,t,e),this.i&&4!=t&&je(this))}},y.cancel=function(){this.I=!0,Ge(this)},y.eb=function(){this.B=null;const t=Date.now();0<=t-this.Y?(function(t,e){t.info(function(){return"TIMEOUT: "+e})}(this.j,this.A),2!=this.K&&(we(3),be(17)),Ge(this),this.o=2,$e(this)):Ke(this,this.Y-t)},(y=We.prototype).R=function(){Ye(this);for(var t=[],e=0;e<this.g.length;e++)t.push(this.h[this.g[e]]);return t},y.T=function(){return Ye(this),this.g.concat()},y.get=function(t,e){return Ze(this.h,t)?this.h[t]:e},y.set=function(t,e){Ze(this.h,t)||(this.i++,this.g.push(t)),this.h[t]=e},y.forEach=function(t,e){for(var n=this.T(),r=0;r<n.length;r++){var s=n[r],i=this.get(s);t.call(e,i,s,this)}};var Je=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Xe(t,e){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,t instanceof Xe){this.g=void 0!==e?e:t.g,en(this,t.j),this.s=t.s,nn(this,t.i),rn(this,t.m),this.l=t.l,e=t.h;var n=new pn;n.i=e.i,e.g&&(n.g=new We(e.g),n.h=e.h),sn(this,n),this.o=t.o}else t&&(n=String(t).match(Je))?(this.g=!!e,en(this,n[1]||"",!0),this.s=cn(n[2]||""),nn(this,n[3]||"",!0),rn(this,n[4]),this.l=cn(n[5]||"",!0),sn(this,n[6]||"",!0),this.o=cn(n[7]||"")):(this.g=!!e,this.h=new pn(null,this.g))}function tn(t){return new Xe(t)}function en(t,e,n){t.j=n?cn(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function nn(t,e,n){t.i=n?cn(e,!0):e}function rn(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function sn(t,e,n){e instanceof pn?(t.h=e,function(t,e){e&&!t.j&&(yn(t),t.i=null,t.g.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(wn(this,e),bn(this,n,t))},t)),t.j=e}(t.h,t.g)):(n||(e=un(e,gn)),t.h=new pn(e,t.g))}function on(t,e,n){t.h.set(e,n)}function an(t){return on(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function cn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function un(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,hn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function hn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Xe.prototype.toString=function(){var t=[],e=this.j;e&&t.push(un(e,ln,!0),":");var n=this.i;return(n||"file"==e)&&(t.push("//"),(e=this.s)&&t.push(un(e,ln,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&t.push("/"),t.push(un(n,"/"==n.charAt(0)?fn:dn,!0))),(n=this.h.toString())&&t.push("?",n),(n=this.o)&&t.push("#",un(n,mn)),t.join("")};var ln=/[#\/\?@]/g,dn=/[#\?:]/g,fn=/[#\?]/g,gn=/[#\?@]/g,mn=/#/g;function pn(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function yn(t){t.g||(t.g=new We,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),s=null;if(0<=r){var i=t[n].substring(0,r);s=t[n].substring(r+1)}else i=t[n];e(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(t.i,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}function wn(t,e){yn(t),e=Tn(t,e),Ze(t.g.h,e)&&(t.i=null,t.h-=t.g.get(e).length,Ze((t=t.g).h,e)&&(delete t.h[e],t.i--,t.g.length>2*t.i&&Ye(t)))}function vn(t,e){return yn(t),e=Tn(t,e),Ze(t.g.h,e)}function bn(t,e,n){wn(t,e),0<n.length&&(t.i=null,t.g.set(Tn(t,e),Q(n)),t.h+=n.length)}function Tn(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}function In(t){this.l=t||En,t=L.PerformanceNavigationTiming?0<(t=L.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(L.g&&L.g.Ea&&L.g.Ea()&&L.g.Ea().Zb),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(y=pn.prototype).add=function(t,e){yn(this),this.i=null,t=Tn(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},y.forEach=function(t,e){yn(this),this.g.forEach(function(n,r){G(n,function(n){t.call(e,n,r,this)},this)},this)},y.T=function(){yn(this);for(var t=this.g.R(),e=this.g.T(),n=[],r=0;r<e.length;r++)for(var s=t[r],i=0;i<s.length;i++)n.push(e[r]);return n},y.R=function(t){yn(this);var e=[];if("string"==typeof t)vn(this,t)&&(e=H(e,this.g.get(Tn(this,t))));else{t=this.g.R();for(var n=0;n<t.length;n++)e=H(e,t[n])}return e},y.set=function(t,e){return yn(this),this.i=null,vn(this,t=Tn(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},y.get=function(t,e){return t&&0<(t=this.R(t)).length?String(t[0]):e},y.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var t=[],e=this.g.T(),n=0;n<e.length;n++){var r=e[n],s=encodeURIComponent(String(r));r=this.R(r);for(var i=0;i<r.length;i++){var o=s;""!==r[i]&&(o+="="+encodeURIComponent(String(r[i]))),t.push(o)}}return this.i=t.join("&")};var En=10;function _n(t){return!!t.h||!!t.g&&t.g.size>=t.j}function Sn(t){return t.h?1:t.g?t.g.size:0}function Nn(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function An(t,e){t.g?t.g.add(e):t.h=e}function Dn(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function xn(t){if(null!=t.h)return t.i.concat(t.h.D);if(null!=t.g&&0!==t.g.size){let e=t.i;for(const n of t.g.values())e=e.concat(n.D);return e}return Q(t.i)}function Cn(){}function kn(){this.g=new Cn}function Ln(t,e,n){const r=n||"";try{Qe(t,function(t,n){let s=t;P(t)&&(s=Ht(t)),e.push(r+n+"="+encodeURIComponent(s))})}catch(s){throw e.push(r+"type="+encodeURIComponent("_badmap")),s}}function Rn(t,e,n,r,s){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,s(r)}catch(i){}}function On(t){this.l=t.$b||null,this.j=t.ib||!1}function Pn(t,e){zt.call(this),this.D=t,this.u=e,this.m=void 0,this.readyState=Fn,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}In.prototype.cancel=function(){if(this.i=xn(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const t of this.g.values())t.cancel();this.g.clear()}},Cn.prototype.stringify=function(t){return L.JSON.stringify(t,void 0)},Cn.prototype.parse=function(t){return L.JSON.parse(t,void 0)},j(On,Se),On.prototype.g=function(){return new Pn(this.l,this.j)},On.prototype.i=function(t){return function(){return t}}({}),j(Pn,zt);var Fn=0;function Mn(t){t.j.read().then(t.Sa.bind(t)).catch(t.ha.bind(t))}function qn(t){t.readyState=4,t.l=null,t.j=null,t.A=null,Un(t)}function Un(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(y=Pn.prototype).open=function(t,e){if(this.readyState!=Fn)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,Un(this)},y.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.D||L).fetch(new Request(this.B,e)).then(this.Va.bind(this),this.ha.bind(this))},y.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,qn(this)),this.readyState=Fn},y.Va=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,Un(this)),this.g&&(this.readyState=3,Un(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==L.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Mn(this)}else t.text().then(this.Ua.bind(this),this.ha.bind(this))},y.Sa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?qn(this):Un(this),3==this.readyState&&Mn(this)}},y.Ua=function(t){this.g&&(this.response=this.responseText=t,qn(this))},y.Ta=function(t){this.g&&(this.response=t,qn(this))},y.ha=function(){this.g&&qn(this)},y.setRequestHeader=function(t,e){this.v.append(t,e)},y.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},y.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)t.push((n=n.value)[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(Pn.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var Vn=L.JSON.parse;function Bn(t){zt.call(this),this.headers=new We,this.u=t||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=jn,this.K=this.L=!1}j(Bn,zt);var jn="",Kn=/^https?$/i,zn=["POST","PUT"];function $n(t){return"content-type"==t.toLowerCase()}function Gn(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,Hn(t),Wn(t)}function Hn(t){t.D||(t.D=!0,$t(t,"complete"),$t(t,"error"))}function Qn(t){if(t.h&&void 0!==k&&(!t.C[1]||4!=Zn(t)||2!=t.ba()))if(t.v&&4==Zn(t))ie(t.Fa,0,t);else if($t(t,"readystatechange"),4==Zn(t)){t.h=!1;try{const c=t.ba();t:switch(c){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}var n;if(!(n=e)){var r;if(r=0===c){var s=String(t.H).match(Je)[1]||null;if(!s&&L.self&&L.self.location){var i=L.self.location.protocol;s=i.substr(0,i.length-1)}r=!Kn.test(s?s.toLowerCase():"")}n=r}if(n)$t(t,"complete"),$t(t,"success");else{t.m=6;try{var o=2<Zn(t)?t.g.statusText:""}catch(a){o=""}t.j=o+" ["+t.ba()+"]",Hn(t)}}finally{Wn(t)}}}function Wn(t,e){if(t.g){Yn(t);const r=t.g,s=t.C[0]?R:null;t.g=null,t.C=null,e||$t(t,"ready");try{r.onreadystatechange=s}catch(n){}}}function Yn(t){t.g&&t.K&&(t.g.ontimeout=null),t.A&&(L.clearTimeout(t.A),t.A=null)}function Zn(t){return t.g?t.g.readyState:0}function Jn(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.J){case jn:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(e){return null}}function Xn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=function(t){let e="";return nt(t,function(t,n){e+=n,e+=":",e+=t,e+="\r\n"}),e}(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):on(t,e,n))}function tr(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function er(t){this.za=0,this.l=[],this.h=new de,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=tr("failFast",!1,t),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=tr("baseRetryDelayMs",5e3,t),this.$a=tr("retryDelaySeedMs",1e4,t),this.Ya=tr("forwardChannelMaxRetries",2,t),this.ra=tr("forwardChannelRequestTimeoutMs",2e4,t),this.qa=t&&t.xmlHttpFactory||void 0,this.Ba=t&&t.Yb||!1,this.K=void 0,this.H=t&&t.supportsCrossDomainXhr||!1,this.J="",this.i=new In(t&&t.concurrentRequestLimit),this.Ca=new kn,this.ja=t&&t.fastHandshake||!1,this.Ra=t&&t.Wb||!1,t&&t.Aa&&this.h.Aa(),t&&t.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&t&&t.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!t||!1!==t.Xb}function nr(t){if(sr(t),3==t.G){var e=t.V++,n=tn(t.F);on(n,"SID",t.J),on(n,"RID",e),on(n,"TYPE","terminate"),cr(t,n),(e=new Le(t,t.h,e,void 0)).K=2,e.v=an(tn(n)),n=!1,L.navigator&&L.navigator.sendBeacon&&(n=L.navigator.sendBeacon(e.v.toString(),"")),!n&&L.Image&&((new Image).src=e.v,n=!0),n||(e.g=br(e.l,null),e.g.ea(e.v)),e.F=Date.now(),je(e)}wr(t)}function rr(t){t.g&&(dr(t),t.g.cancel(),t.g=null)}function sr(t){rr(t),t.u&&(L.clearTimeout(t.u),t.u=null),gr(t),t.i.cancel(),t.m&&("number"==typeof t.m&&L.clearTimeout(t.m),t.m=null)}function ir(t,e){t.l.push(new class{constructor(t,e){this.h=t,this.g=e}}(t.Za++,e)),3==t.G&&or(t)}function or(t){_n(t.i)||t.m||(t.m=!0,Xt(t.Ha,t),t.C=0)}function ar(t,e){var n;n=e?e.m:t.V++;const r=tn(t.F);on(r,"SID",t.J),on(r,"RID",n),on(r,"AID",t.U),cr(t,r),t.o&&t.s&&Xn(r,t.o,t.s),n=new Le(t,t.h,n,t.C+1),null===t.o&&(n.H=t.s),e&&(t.l=e.D.concat(t.l)),e=ur(t,n,1e3),n.setTimeout(Math.round(.5*t.ra)+Math.round(.5*t.ra*Math.random())),An(t.i,n),Me(n,r,e)}function cr(t,e){t.j&&Qe({},function(t,n){on(e,n,t)})}function ur(t,e,n){n=Math.min(t.l.length,n);var r=t.j?V(t.j.Oa,t.j,t):null;t:{var s=t.l;let e=-1;for(;;){const t=["count="+n];-1==e?0<n?(e=s[0].h,t.push("ofs="+e)):e=0:t.push("ofs="+e);let i=!0;for(let o=0;o<n;o++){let n=s[o].h;const a=s[o].g;if(n-=e,0>n)e=Math.max(0,s[o].h-100),i=!1;else try{Ln(a,t,"req"+n+"_")}catch(Jr){r&&r(a)}}if(i){r=t.join("&");break t}}}return t=t.l.splice(0,n),e.D=t,r}function hr(t){t.g||t.u||(t.Y=1,Xt(t.Ga,t),t.A=0)}function lr(t){return!(t.g||t.u||3<=t.A||(t.Y++,t.u=Ie(V(t.Ga,t),pr(t,t.A)),t.A++,0))}function dr(t){null!=t.B&&(L.clearTimeout(t.B),t.B=null)}function fr(t){t.g=new Le(t,t.h,"rpc",t.Y),null===t.o&&(t.g.H=t.s),t.g.O=0;var e=tn(t.oa);on(e,"RID","rpc"),on(e,"SID",t.J),on(e,"CI",t.N?"0":"1"),on(e,"AID",t.U),cr(t,e),on(e,"TYPE","xmlhttp"),t.o&&t.s&&Xn(e,t.o,t.s),t.K&&t.g.setTimeout(t.K);var n=t.g;t=t.la,n.K=1,n.v=an(tn(e)),n.s=null,n.U=!0,qe(n,t)}function gr(t){null!=t.v&&(L.clearTimeout(t.v),t.v=null)}function mr(t,e){var n=null;if(t.g==e){gr(t),dr(t),t.g=null;var r=2}else{if(!Nn(t.i,e))return;n=e.D,Dn(t.i,e),r=1}if(t.I=e.N,0!=t.G)if(e.i)if(1==r){n=e.s?e.s.length:0,e=Date.now()-e.F;var s=t.C;$t(r=pe(),new Te(r,n,e,s)),or(t)}else hr(t);else if(3==(s=e.o)||0==s&&0<t.I||!(1==r&&function(t,e){return!(Sn(t.i)>=t.i.j-(t.m?1:0)||(t.m?(t.l=e.D.concat(t.l),0):1==t.G||2==t.G||t.C>=(t.Xa?0:t.Ya)||(t.m=Ie(V(t.Ha,t,e),pr(t,t.C)),t.C++,0)))}(t,e)||2==r&&lr(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),s){case 1:yr(t,5);break;case 4:yr(t,10);break;case 3:yr(t,6);break;default:yr(t,2)}}function pr(t,e){let n=t.Pa+Math.floor(Math.random()*t.$a);return t.j||(n*=2),n*e}function yr(t,e){if(t.h.info("Error code "+e),2==e){var n=null;t.j&&(n=null);var r=V(t.jb,t);n||(n=new Xe("//www.google.com/images/cleardot.gif"),L.location&&"http"==L.location.protocol||en(n,"https"),an(n)),function(t,e){const n=new de;if(L.Image){const r=new Image;r.onload=B(Rn,n,r,"TestLoadImage: loaded",!0,e),r.onerror=B(Rn,n,r,"TestLoadImage: error",!1,e),r.onabort=B(Rn,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=B(Rn,n,r,"TestLoadImage: timeout",!1,e),L.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}(n.toString(),r)}else be(2);t.G=0,t.j&&t.j.va(e),wr(t),sr(t)}function wr(t){t.G=0,t.I=-1,t.j&&(0==xn(t.i).length&&0==t.l.length||(t.i.i.length=0,Q(t.l),t.l.length=0),t.j.ua())}function vr(t,e,n){let r=function(t){return t instanceof Xe?tn(t):new Xe(t,void 0)}(n);if(""!=r.i)e&&nn(r,e+"."+r.i),rn(r,r.m);else{const t=L.location;r=function(t,e,n,r){var s=new Xe(null,void 0);return t&&en(s,t),e&&nn(s,e),n&&rn(s,n),r&&(s.l=r),s}(t.protocol,e?e+"."+t.hostname:t.hostname,+t.port,n)}return t.aa&&nt(t.aa,function(t,e){on(r,e,t)}),n=t.sa,(e=t.D)&&n&&on(r,e,n),on(r,"VER",t.ma),cr(t,r),r}function br(t,e,n){if(e&&!t.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new Bn(n&&t.Ba&&!t.qa?new On({ib:!0}):t.qa)).L=t.H,e}function Tr(){}function Ir(){if(ht&&!(10<=Number(bt)))throw Error("Environmental error: no available transport.")}function Er(t,e){zt.call(this),this.g=new er(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(t?t["X-WebChannel-Client-Profile"]=e.ya:t={"X-WebChannel-Client-Profile":e.ya}),this.g.P=t,(t=e&&e.httpHeadersOverwriteParam)&&!W(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!W(e)&&(this.g.D=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new Nr(this)}function _r(t){xe.call(this);var e=t.__sm__;if(e){t:{for(const n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function Sr(){Ce.call(this),this.status=1}function Nr(t){this.g=t}(y=Bn.prototype).ea=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+t);e=e?e.toUpperCase():"GET",this.H=t,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():Ae.g(),this.C=function(t){return t.h||(t.h=t.i())}(this.u?this.u:Ae),this.g.onreadystatechange=V(this.Fa,this);try{this.F=!0,this.g.open(e,String(t),!0),this.F=!1}catch(i){return void Gn(this,i)}t=n||"";const s=new We(this.headers);r&&Qe(r,function(t,e){s.set(e,t)}),r=function(t){t:{var e=$n;const n=t.length,r="string"==typeof t?t.split(""):t;for(let s=0;s<n;s++)if(s in r&&e.call(void 0,r[s],s,t)){e=s;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(s.T()),n=L.FormData&&t instanceof L.FormData,!(0<=$(zn,e))||r||n||s.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),s.forEach(function(t,e){this.g.setRequestHeader(e,t)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Yn(this),0<this.B&&((this.K=function(t){return ht&&function(){return t=vt,Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=function(){let t=0;const e=Z(String(at)).split("."),n=Z("9").split("."),r=Math.max(e.length,n.length);for(let o=0;0==t&&o<r;o++){var s=e[o]||"",i=n[o]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],0==s[0].length&&0==i[0].length)break;t=X(0==s[1].length?0:parseInt(s[1],10),0==i[1].length?0:parseInt(i[1],10))||X(0==s[2].length,0==i[2].length)||X(s[2],i[2]),s=s[3],i=i[3]}while(0==t)}return 0<=t}();var t}()&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=V(this.pa,this)):this.A=ie(this.pa,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(i){Gn(this,i)}},y.pa=function(){void 0!==k&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,$t(this,"timeout"),this.abort(8))},y.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,$t(this,"complete"),$t(this,"abort"),Wn(this))},y.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Wn(this,!0)),Bn.Z.M.call(this)},y.Fa=function(){this.s||(this.F||this.v||this.l?Qn(this):this.cb())},y.cb=function(){Qn(this)},y.ba=function(){try{return 2<Zn(this)?this.g.status:-1}catch(ct){return-1}},y.ga=function(){try{return this.g?this.g.responseText:""}catch(ct){return""}},y.Qa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Vn(e)}},y.Da=function(){return this.m},y.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(y=er.prototype).ma=8,y.G=1,y.hb=function(t){try{this.h.info("Origin Trials invoked: "+t)}catch(e){}},y.Ha=function(t){if(this.m)if(this.m=null,1==this.G){if(!t){this.V=Math.floor(1e5*Math.random()),t=this.V++;const s=new Le(this,this.h,t,void 0);let i=this.s;if(this.P&&(i?(i=rt(i),it(i,this.P)):i=this.P),null===this.o&&(s.H=i),this.ja)t:{for(var e=0,n=0;n<this.l.length;n++){var r=this.l[n];if(void 0===(r="__data__"in r.g&&"string"==typeof(r=r.g.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=n;break t}if(4096===e||n===this.l.length-1){e=n+1;break t}}e=1e3}else e=1e3;e=ur(this,s,e),on(n=tn(this.F),"RID",t),on(n,"CVER",22),this.D&&on(n,"X-HTTP-Session-Id",this.D),cr(this,n),this.o&&i&&Xn(n,this.o,i),An(this.i,s),this.Ra&&on(n,"TYPE","init"),this.ja?(on(n,"$req",e),on(n,"SID","null"),s.$=!0,Me(s,n,null)):Me(s,n,e),this.G=2}}else 3==this.G&&(t?ar(this,t):0==this.l.length||_n(this.i)||ar(this))},y.Ga=function(){if(this.u=null,fr(this),this.$&&!(this.L||null==this.g||0>=this.O)){var t=2*this.O;this.h.info("BP detection timer enabled: "+t),this.B=Ie(V(this.bb,this),t)}},y.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,be(10),rr(this),fr(this))},y.ab=function(){null!=this.v&&(this.v=null,rr(this),lr(this),be(19))},y.jb=function(t){t?(this.h.info("Successfully pinged google.com"),be(2)):(this.h.info("Failed to ping google.com"),be(1))},(y=Tr.prototype).xa=function(){},y.wa=function(){},y.va=function(){},y.ua=function(){},y.Oa=function(){},Ir.prototype.g=function(t,e){return new Er(t,e)},j(Er,zt),Er.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var t=this.g,e=this.l,n=this.h||void 0;t.Wa&&(t.h.info("Origin Trials enabled."),Xt(V(t.hb,t,e))),be(0),t.W=e,t.aa=n||{},t.N=t.X,t.F=vr(t,null,t.W),or(t)},Er.prototype.close=function(){nr(this.g)},Er.prototype.u=function(t){if("string"==typeof t){var e={};e.__data__=t,ir(this.g,e)}else this.v?((e={}).__data__=Ht(t),ir(this.g,e)):ir(this.g,t)},Er.prototype.M=function(){this.g.j=null,delete this.j,nr(this.g),delete this.g,Er.Z.M.call(this)},j(_r,xe),j(Sr,Ce),j(Nr,Tr),Nr.prototype.xa=function(){$t(this.g,"a")},Nr.prototype.wa=function(t){$t(this.g,new _r(t))},Nr.prototype.va=function(t){$t(this.g,new Sr(t))},Nr.prototype.ua=function(){$t(this.g,"b")},Ir.prototype.createWebChannel=Ir.prototype.g,Er.prototype.send=Er.prototype.u,Er.prototype.open=Er.prototype.m,Er.prototype.close=Er.prototype.close,Ee.NO_ERROR=0,Ee.TIMEOUT=8,Ee.HTTP_ERROR=6,_e.COMPLETE="complete",Ne.EventType=De,De.OPEN="a",De.CLOSE="b",De.ERROR="c",De.MESSAGE="d",zt.prototype.listen=zt.prototype.N,Bn.prototype.listenOnce=Bn.prototype.O,Bn.prototype.getLastError=Bn.prototype.La,Bn.prototype.getLastErrorCode=Bn.prototype.Da,Bn.prototype.getStatus=Bn.prototype.ba,Bn.prototype.getResponseJson=Bn.prototype.Qa,Bn.prototype.getResponseText=Bn.prototype.ga,Bn.prototype.send=Bn.prototype.ea;var Ar=C.createWebChannelTransport=function(){return new Ir},Dr=C.getStatEventTarget=function(){return pe()},xr=C.ErrorCode=Ee,Cr=C.EventType=_e,kr=C.Event=ge,Lr=C.Stat={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},Rr=C.FetchXmlHttpFactory=On,Or=C.WebChannel=Ne,Pr=C.XhrIo=Bn;class Fr{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}Fr.UNAUTHENTICATED=new Fr(null),Fr.GOOGLE_CREDENTIALS=new Fr("google-credentials-uid"),Fr.FIRST_PARTY=new Fr("first-party-uid"),Fr.MOCK_USER=new Fr("mock-user");let Mr="9.1.0";const qr=new A.Yd("@firebase/firestore");function Ur(){return qr.logLevel}function Vr(t,...e){if(qr.logLevel<=A.in.DEBUG){const n=e.map(Kr);qr.debug(`Firestore (${Mr}): ${t}`,...n)}}function Br(t,...e){if(qr.logLevel<=A.in.ERROR){const n=e.map(Kr);qr.error(`Firestore (${Mr}): ${t}`,...n)}}function jr(t,...e){if(qr.logLevel<=A.in.WARN){const n=e.map(Kr);qr.warn(`Firestore (${Mr}): ${t}`,...n)}}function Kr(t){if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(e){return t}}function zr(t="Unexpected state"){const e=`FIRESTORE (${Mr}) INTERNAL ASSERTION FAILED: `+t;throw Br(e),new Error(e)}function $r(t,e){t||zr()}function Gr(t,e){return t}const Hr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Qr extends Error{constructor(t,e){super(e),this.code=t,this.message=e,this.name="FirebaseError",this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Wr{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}}class Yr{constructor(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization=`Bearer ${t}`}}class Zr{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable(()=>e(Fr.UNAUTHENTICATED))}shutdown(){}}class Jr{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable(()=>e(this.token.user))}shutdown(){this.changeListener=null}}class Xr{constructor(t){this.t=t,this.currentUser=Fr.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let n=this.i;const r=t=>this.i!==n?(n=this.i,e(t)):Promise.resolve();let s=new Wr;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Wr,t.enqueueRetryable(()=>r(this.currentUser))};const i=()=>{const e=s;t.enqueueRetryable(async()=>{await e.promise,await r(this.currentUser)})},o=t=>{Vr("FirebaseCredentialsProvider","Auth detected"),this.auth=t,this.auth.addAuthTokenListener(this.o),i()};this.t.onInit(t=>o(t)),setTimeout(()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?o(t):(Vr("FirebaseCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Wr)}},0),i()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(e=>this.i!==t?(Vr("FirebaseCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?($r("string"==typeof e.accessToken),new Yr(e.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const t=this.auth&&this.auth.getUid();return $r(null===t||"string"==typeof t),new Fr(t)}}class ts{constructor(t,e,n){this.h=t,this.l=e,this.m=n,this.type="FirstParty",this.user=Fr.FIRST_PARTY}get authHeaders(){const t={"X-Goog-AuthUser":this.l},e=this.h.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),this.m&&(t["X-Goog-Iam-Authorization-Token"]=this.m),t}}class es{constructor(t,e,n){this.h=t,this.l=e,this.m=n}getToken(){return Promise.resolve(new ts(this.h,this.l,this.m))}start(t,e){t.enqueueRetryable(()=>e(Fr.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class ns{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.g(t),this.p=t=>e.writeSequenceNumber(t))}g(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.p&&this.p(t),t}}function rs(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}ns.T=-1;class ss{static I(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length;let n="";for(;n.length<20;){const r=rs(40);for(let s=0;s<r.length;++s)n.length<20&&r[s]<e&&(n+=t.charAt(r[s]%t.length))}return n}}function is(t,e){return t<e?-1:t>e?1:0}function os(t,e,n){return t.length===e.length&&t.every((t,r)=>n(t,e[r]))}function as(t){return t+"\0"}class cs{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new Qr(Hr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new Qr(Hr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Qr(Hr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Qr(Hr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return cs.fromMillis(Date.now())}static fromDate(t){return cs.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new cs(e,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?is(this.nanoseconds,t.nanoseconds):is(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class us{constructor(t){this.timestamp=t}static fromTimestamp(t){return new us(t)}static min(){return new us(new cs(0,0))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}function hs(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function ls(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function ds(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class fs{constructor(t,e,n){void 0===e?e=0:e>t.length&&zr(),void 0===n?n=t.length-e:n>t.length-e&&zr(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===fs.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof fs?t.forEach(t=>{e.push(t)}):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return this.construct(this.segments,this.offset+(t=void 0===t?1:t),this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const n=t.get(r),s=e.get(r);if(n<s)return-1;if(n>s)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class gs extends fs{construct(t,e,n){return new gs(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new Qr(Hr.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter(t=>t.length>0))}return new gs(e)}static emptyPath(){return new gs([])}}const ms=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ps extends fs{construct(t,e,n){return new ps(t,e,n)}static isValidIdentifier(t){return ms.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ps.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new ps(["__name__"])}static fromServerFormat(t){const e=[];let n="",r=0;const s=()=>{if(0===n.length)throw new Qr(Hr.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let i=!1;for(;r<t.length;){const e=t[r];if("\\"===e){if(r+1===t.length)throw new Qr(Hr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[r+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new Qr(Hr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,r+=2}else"`"===e?(i=!i,r++):"."!==e||i?(n+=e,r++):(s(),r++)}if(s(),i)throw new Qr(Hr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new ps(e)}static emptyPath(){return new ps([])}}class ys{constructor(t){this.fields=t,t.sort(ps.comparator)}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return os(this.fields,t.fields,(t,e)=>t.isEqual(e))}}class ws{constructor(t){this.binaryString=t}static fromBase64String(t){const e=atob(t);return new ws(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new ws(e)}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return is(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}ws.EMPTY_BYTE_STRING=new ws("");const vs=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function bs(t){if($r(!!t),"string"==typeof t){let e=0;const n=vs.exec(t);if($r(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Ts(t.seconds),nanos:Ts(t.nanos)}}function Ts(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Is(t){return"string"==typeof t?ws.fromBase64String(t):ws.fromUint8Array(t)}function Es(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function _s(t){const e=t.mapValue.fields.__previous_value__;return Es(e)?_s(e):e}function Ss(t){const e=bs(t.mapValue.fields.__local_write_time__.timestampValue);return new cs(e.seconds,e.nanos)}function Ns(t){return null==t}function As(t){return 0===t&&1/t==-1/0}function Ds(t){return"number"==typeof t&&Number.isInteger(t)&&!As(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}class xs{constructor(t){this.path=t}static fromPath(t){return new xs(gs.fromString(t))}static fromName(t){return new xs(gs.fromString(t).popFirst(5))}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}isEqual(t){return null!==t&&0===gs.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return gs.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new xs(new gs(t.slice()))}}function Cs(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Es(t)?4:10:zr()}function ks(t,e){const n=Cs(t);if(n!==Cs(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Ss(t).isEqual(Ss(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=bs(t.timestampValue),r=bs(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return Is(t.bytesValue).isEqual(Is(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return Ts(t.geoPointValue.latitude)===Ts(e.geoPointValue.latitude)&&Ts(t.geoPointValue.longitude)===Ts(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return Ts(t.integerValue)===Ts(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=Ts(t.doubleValue),r=Ts(e.doubleValue);return n===r?As(n)===As(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return os(t.arrayValue.values||[],e.arrayValue.values||[],ks);case 10:return function(t,e){const n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(hs(n)!==hs(r))return!1;for(const s in n)if(n.hasOwnProperty(s)&&(void 0===r[s]||!ks(n[s],r[s])))return!1;return!0}(t,e);default:return zr()}}function Ls(t,e){return void 0!==(t.values||[]).find(t=>ks(t,e))}function Rs(t,e){const n=Cs(t),r=Cs(e);if(n!==r)return is(n,r);switch(n){case 0:return 0;case 1:return is(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=Ts(t.integerValue||t.doubleValue),r=Ts(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return Os(t.timestampValue,e.timestampValue);case 4:return Os(Ss(t),Ss(e));case 5:return is(t.stringValue,e.stringValue);case 6:return function(t,e){const n=Is(t),r=Is(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),r=e.split("/");for(let s=0;s<n.length&&s<r.length;s++){const t=is(n[s],r[s]);if(0!==t)return t}return is(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=is(Ts(t.latitude),Ts(e.latitude));return 0!==n?n:is(Ts(t.longitude),Ts(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],r=e.values||[];for(let s=0;s<n.length&&s<r.length;++s){const t=Rs(n[s],r[s]);if(t)return t}return is(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){const n=t.fields||{},r=Object.keys(n),s=e.fields||{},i=Object.keys(s);r.sort(),i.sort();for(let o=0;o<r.length&&o<i.length;++o){const t=is(r[o],i[o]);if(0!==t)return t;const e=Rs(n[r[o]],s[i[o]]);if(0!==e)return e}return is(r.length,i.length)}(t.mapValue,e.mapValue);default:throw zr()}}function Os(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return is(t,e);const n=bs(t),r=bs(e),s=is(n.seconds,r.seconds);return 0!==s?s:is(n.nanos,r.nanos)}function Ps(t){return Fs(t)}function Fs(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=bs(t);return`time(${e.seconds},${e.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?Is(t.bytesValue).toBase64():"referenceValue"in t?xs.fromName(t.referenceValue).toString():"geoPointValue"in t?`geo(${(e=t.geoPointValue).latitude},${e.longitude})`:"arrayValue"in t?function(t){let e="[",n=!0;for(const r of t.values||[])n?n=!1:e+=",",e+=Fs(r);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",r=!0;for(const s of e)r?r=!1:n+=",",n+=`${s}:${Fs(t.fields[s])}`;return n+"}"}(t.mapValue):zr();var e}function Ms(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function qs(t){return!!t&&"integerValue"in t}function Us(t){return!!t&&"arrayValue"in t}function Vs(t){return!!t&&"nullValue"in t}function Bs(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function js(t){return!!t&&"mapValue"in t}function Ks(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return ls(t.mapValue.fields,(t,n)=>e.mapValue.fields[t]=Ks(n)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Ks(t.arrayValue.values[n]);return e}return Object.assign({},t)}class zs{constructor(t){this.value=t}static empty(){return new zs({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!js(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Ks(e)}setAll(t){let e=ps.emptyPath(),n={},r=[];t.forEach((t,s)=>{if(!e.isImmediateParentOf(s)){const t=this.getFieldsMap(e);this.applyChanges(t,n,r),n={},r=[],e=s.popLast()}t?n[s.lastSegment()]=Ks(t):r.push(s.lastSegment())});const s=this.getFieldsMap(e);this.applyChanges(s,n,r)}delete(t){const e=this.field(t.popLast());js(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return ks(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let r=e.mapValue.fields[t.get(n)];js(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields}applyChanges(t,e,n){ls(e,(e,n)=>t[e]=n);for(const r of n)delete t[r]}clone(){return new zs(Ks(this.value))}}function $s(t){const e=[];return ls(t.fields,(t,n)=>{const r=new ps([t]);if(js(n)){const t=$s(n.mapValue).fields;if(0===t.length)e.push(r);else for(const n of t)e.push(r.child(n))}else e.push(r)}),new ys(e)}class Gs{constructor(t,e,n,r,s){this.key=t,this.documentType=e,this.version=n,this.data=r,this.documentState=s}static newInvalidDocument(t){return new Gs(t,0,us.min(),zs.empty(),0)}static newFoundDocument(t,e,n){return new Gs(t,1,e,n,0)}static newNoDocument(t,e){return new Gs(t,2,e,zs.empty(),0)}static newUnknownDocument(t,e){return new Gs(t,3,e,zs.empty(),2)}convertToFoundDocument(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=zs.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=zs.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof Gs&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}clone(){return new Gs(this.key,this.documentType,this.version,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Hs{constructor(t,e=null,n=[],r=[],s=null,i=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=s,this.startAt=i,this.endAt=o,this.A=null}}function Qs(t,e=null,n=[],r=[],s=null,i=null,o=null){return new Hs(t,e,n,r,s,i,o)}function Ws(t){const e=Gr(t);if(null===e.A){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(t=>function(t){return t.field.canonicalString()+t.op.toString()+Ps(t.value)}(t)).join(","),t+="|ob:",t+=e.orderBy.map(t=>function(t){return t.field.canonicalString()+t.dir}(t)).join(","),Ns(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=ci(e.startAt)),e.endAt&&(t+="|ub:",t+=ci(e.endAt)),e.A=t}return e.A}function Ys(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let s=0;s<t.orderBy.length;s++)if(!hi(t.orderBy[s],e.orderBy[s]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let s=0;s<t.filters.length;s++)if((n=t.filters[s]).op!==(r=e.filters[s]).op||!n.field.isEqual(r.field)||!ks(n.value,r.value))return!1;var n,r;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!di(t.startAt,e.startAt)&&di(t.endAt,e.endAt)}function Zs(t){return xs.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}class Js extends class{}{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.R(t,e,n):new Xs(t,e,n):"array-contains"===e?new ri(t,n):"in"===e?new si(t,n):"not-in"===e?new ii(t,n):"array-contains-any"===e?new oi(t,n):new Js(t,e,n)}static R(t,e,n){return"in"===e?new ti(t,n):new ei(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&this.P(Rs(e,this.value)):null!==e&&Cs(this.value)===Cs(e)&&this.P(Rs(e,this.value))}P(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return zr()}}v(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class Xs extends Js{constructor(t,e,n){super(t,e,n),this.key=xs.fromName(n.referenceValue)}matches(t){const e=xs.comparator(t.key,this.key);return this.P(e)}}class ti extends Js{constructor(t,e){super(t,"in",e),this.keys=ni(0,e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}}class ei extends Js{constructor(t,e){super(t,"not-in",e),this.keys=ni(0,e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}}function ni(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map(t=>xs.fromName(t.referenceValue))}class ri extends Js{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return Us(e)&&Ls(e.arrayValue,this.value)}}class si extends Js{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&Ls(this.value.arrayValue,e)}}class ii extends Js{constructor(t,e){super(t,"not-in",e)}matches(t){if(Ls(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&!Ls(this.value.arrayValue,e)}}class oi extends Js{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!Us(e)||!e.arrayValue.values)&&e.arrayValue.values.some(t=>Ls(this.value.arrayValue,t))}}class ai{constructor(t,e){this.position=t,this.before=e}}function ci(t){return`${t.before?"b":"a"}:${t.position.map(t=>Ps(t)).join(",")}`}class ui{constructor(t,e="asc"){this.field=t,this.dir=e}}function hi(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function li(t,e,n){let r=0;for(let s=0;s<t.position.length;s++){const i=e[s],o=t.position[s];if(r=i.field.isKeyField()?xs.comparator(xs.fromName(o.referenceValue),n.key):Rs(o,n.data.field(i.field)),"desc"===i.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function di(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!ks(t.position[n],e.position[n]))return!1;return!0}class fi{constructor(t,e=null,n=[],r=[],s=null,i="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=s,this.limitType=i,this.startAt=o,this.endAt=a,this.V=null,this.S=null}}function gi(t,e,n,r,s,i,o,a){return new fi(t,e,n,r,s,i,o,a)}function mi(t){return new fi(t)}function pi(t){return!Ns(t.limit)&&"F"===t.limitType}function yi(t){return!Ns(t.limit)&&"L"===t.limitType}function wi(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function vi(t){for(const e of t.filters)if(e.v())return e.field;return null}function bi(t){return null!==t.collectionGroup}function Ti(t){const e=Gr(t);if(null===e.V){e.V=[];const t=vi(e),n=wi(e);if(null!==t&&null===n)t.isKeyField()||e.V.push(new ui(t)),e.V.push(new ui(ps.keyField(),"asc"));else{let t=!1;for(const n of e.explicitOrderBy)e.V.push(n),n.field.isKeyField()&&(t=!0);if(!t){const t=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.V.push(new ui(ps.keyField(),t))}}}return e.V}function Ii(t){const e=Gr(t);if(!e.S)if("F"===e.limitType)e.S=Qs(e.path,e.collectionGroup,Ti(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const s of Ti(e))t.push(new ui(s.field,"desc"===s.dir?"asc":"desc"));const n=e.endAt?new ai(e.endAt.position,!e.endAt.before):null,r=e.startAt?new ai(e.startAt.position,!e.startAt.before):null;e.S=Qs(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}return e.S}function Ei(t,e,n){return new fi(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function _i(t,e){return Ys(Ii(t),Ii(e))&&t.limitType===e.limitType}function Si(t){return`${Ws(Ii(t))}|lt:${t.limitType}`}function Ni(t){return`Query(target=${function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map(t=>{return`${(e=t).field.canonicalString()} ${e.op} ${Ps(e.value)}`;var e}).join(", ")}]`),Ns(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map(t=>function(t){return`${t.field.canonicalString()} (${t.dir})`}(t)).join(", ")}]`),t.startAt&&(e+=", startAt: "+ci(t.startAt)),t.endAt&&(e+=", endAt: "+ci(t.endAt)),`Target(${e})`}(Ii(t))}; limitType=${t.limitType})`}function Ai(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):xs.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of t.explicitOrderBy)if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!li(t.startAt,Ti(t),e)||t.endAt&&li(t.endAt,Ti(t),e))}(t,e)}function Di(t){return(e,n)=>{let r=!1;for(const s of Ti(t)){const t=xi(s,e,n);if(0!==t)return t;r=r||s.field.isKeyField()}return 0}}function xi(t,e,n){const r=t.field.isKeyField()?xs.comparator(e.key,n.key):function(t,e,n){const r=e.data.field(t),s=n.data.field(t);return null!==r&&null!==s?Rs(r,s):zr()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return zr()}}function Ci(t,e){if(t.D){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:As(e)?"-0":e}}function ki(t){return{integerValue:""+t}}function Li(t,e){return Ds(e)?ki(e):Ci(t,e)}class Ri{constructor(){this._=void 0}}function Oi(t,e,n){return t instanceof Mi?function(t,e){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof qi?Ui(t,e):t instanceof Vi?Bi(t,e):function(t,e){const n=Fi(t,e),r=Ki(n)+Ki(t.C);return qs(n)&&qs(t.C)?ki(r):Ci(t.N,r)}(t,e)}function Pi(t,e,n){return t instanceof qi?Ui(t,e):t instanceof Vi?Bi(t,e):n}function Fi(t,e){return t instanceof ji?qs(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}class Mi extends Ri{}class qi extends Ri{constructor(t){super(),this.elements=t}}function Ui(t,e){const n=zi(e);for(const r of t.elements)n.some(t=>ks(t,r))||n.push(r);return{arrayValue:{values:n}}}class Vi extends Ri{constructor(t){super(),this.elements=t}}function Bi(t,e){let n=zi(e);for(const r of t.elements)n=n.filter(t=>!ks(t,r));return{arrayValue:{values:n}}}class ji extends Ri{constructor(t,e){super(),this.N=t,this.C=e}}function Ki(t){return Ts(t.integerValue||t.doubleValue)}function zi(t){return Us(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class $i{constructor(t,e){this.field=t,this.transform=e}}class Gi{constructor(t,e){this.version=t,this.transformResults=e}}class Hi{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new Hi}static exists(t){return new Hi(void 0,t)}static updateTime(t){return new Hi(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Qi(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class Wi{}function Yi(t,e,n){t instanceof eo?function(t,e,n){const r=t.value.clone(),s=so(t.fieldTransforms,e,n.transformResults);r.setAll(s),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof no?function(t,e,n){if(!Qi(t.precondition,e))return void e.convertToUnknownDocument(n.version);const r=so(t.fieldTransforms,e,n.transformResults),s=e.data;s.setAll(ro(t)),s.setAll(r),e.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function Zi(t,e,n){t instanceof eo?function(t,e,n){if(!Qi(t.precondition,e))return;const r=t.value.clone(),s=io(t.fieldTransforms,n,e);r.setAll(s),e.convertToFoundDocument(to(e),r).setHasLocalMutations()}(t,e,n):t instanceof no?function(t,e,n){if(!Qi(t.precondition,e))return;const r=io(t.fieldTransforms,n,e),s=e.data;s.setAll(ro(t)),s.setAll(r),e.convertToFoundDocument(to(e),s).setHasLocalMutations()}(t,e,n):function(t,e){Qi(t.precondition,e)&&e.convertToNoDocument(us.min())}(t,e)}function Ji(t,e){let n=null;for(const r of t.fieldTransforms){const t=e.data.field(r.field),s=Fi(r.transform,t||null);null!=s&&(null==n&&(n=zs.empty()),n.set(r.field,s))}return n||null}function Xi(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&os(t,e,(t,e)=>function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof qi&&e instanceof qi||t instanceof Vi&&e instanceof Vi?os(t.elements,e.elements,ks):t instanceof ji&&e instanceof ji?ks(t.C,e.C):t instanceof Mi&&e instanceof Mi}(t.transform,e.transform)}(t,e))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}function to(t){return t.isFoundDocument()?t.version:us.min()}class eo extends Wi{constructor(t,e,n,r=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=r,this.type=0}}class no extends Wi{constructor(t,e,n,r,s=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=r,this.fieldTransforms=s,this.type=1}}function ro(t){const e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}}),e}function so(t,e,n){const r=new Map;$r(t.length===n.length);for(let s=0;s<n.length;s++){const i=t[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,Pi(o,a,n[s]))}return r}function io(t,e,n){const r=new Map;for(const s of t){const t=s.transform,i=n.data.field(s.field);r.set(s.field,Oi(t,i,e))}return r}class oo extends Wi{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}}class ao extends Wi{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}}class co{constructor(t){this.count=t}}var uo,ho;function lo(t){switch(t){case Hr.OK:return zr();case Hr.CANCELLED:case Hr.UNKNOWN:case Hr.DEADLINE_EXCEEDED:case Hr.RESOURCE_EXHAUSTED:case Hr.INTERNAL:case Hr.UNAVAILABLE:case Hr.UNAUTHENTICATED:return!1;case Hr.INVALID_ARGUMENT:case Hr.NOT_FOUND:case Hr.ALREADY_EXISTS:case Hr.PERMISSION_DENIED:case Hr.FAILED_PRECONDITION:case Hr.ABORTED:case Hr.OUT_OF_RANGE:case Hr.UNIMPLEMENTED:case Hr.DATA_LOSS:return!0;default:return zr()}}function fo(t){if(void 0===t)return Br("GRPC error has no .code"),Hr.UNKNOWN;switch(t){case uo.OK:return Hr.OK;case uo.CANCELLED:return Hr.CANCELLED;case uo.UNKNOWN:return Hr.UNKNOWN;case uo.DEADLINE_EXCEEDED:return Hr.DEADLINE_EXCEEDED;case uo.RESOURCE_EXHAUSTED:return Hr.RESOURCE_EXHAUSTED;case uo.INTERNAL:return Hr.INTERNAL;case uo.UNAVAILABLE:return Hr.UNAVAILABLE;case uo.UNAUTHENTICATED:return Hr.UNAUTHENTICATED;case uo.INVALID_ARGUMENT:return Hr.INVALID_ARGUMENT;case uo.NOT_FOUND:return Hr.NOT_FOUND;case uo.ALREADY_EXISTS:return Hr.ALREADY_EXISTS;case uo.PERMISSION_DENIED:return Hr.PERMISSION_DENIED;case uo.FAILED_PRECONDITION:return Hr.FAILED_PRECONDITION;case uo.ABORTED:return Hr.ABORTED;case uo.OUT_OF_RANGE:return Hr.OUT_OF_RANGE;case uo.UNIMPLEMENTED:return Hr.UNIMPLEMENTED;case uo.DATA_LOSS:return Hr.DATA_LOSS;default:return zr()}}(ho=uo||(uo={}))[ho.OK=0]="OK",ho[ho.CANCELLED=1]="CANCELLED",ho[ho.UNKNOWN=2]="UNKNOWN",ho[ho.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ho[ho.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ho[ho.NOT_FOUND=5]="NOT_FOUND",ho[ho.ALREADY_EXISTS=6]="ALREADY_EXISTS",ho[ho.PERMISSION_DENIED=7]="PERMISSION_DENIED",ho[ho.UNAUTHENTICATED=16]="UNAUTHENTICATED",ho[ho.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ho[ho.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ho[ho.ABORTED=10]="ABORTED",ho[ho.OUT_OF_RANGE=11]="OUT_OF_RANGE",ho[ho.UNIMPLEMENTED=12]="UNIMPLEMENTED",ho[ho.INTERNAL=13]="INTERNAL",ho[ho.UNAVAILABLE=14]="UNAVAILABLE",ho[ho.DATA_LOSS=15]="DATA_LOSS";class go{constructor(t,e){this.comparator=t,this.root=e||po.EMPTY}insert(t,e){return new go(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,po.BLACK,null,null))}remove(t){return new go(this.comparator,this.root.remove(t,this.comparator).copy(null,null,po.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((e,n)=>(t(e,n),!1))}toString(){const t=[];return this.inorderTraversal((e,n)=>(t.push(`${e}:${n}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new mo(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new mo(this.root,t,this.comparator,!1)}getReverseIterator(){return new mo(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new mo(this.root,t,this.comparator,!0)}}class mo{constructor(t,e,n,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!t.isEmpty();)if(s=e?n(t.key,e):1,r&&(s*=-1),s<0)t=this.isReverse?t.left:t.right;else{if(0===s){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class po{constructor(t,e,n,r,s){this.key=t,this.value=e,this.color=null!=n?n:po.RED,this.left=null!=r?r:po.EMPTY,this.right=null!=s?s:po.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,r,s){return new po(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let r=this;const s=n(t,r.key);return r=s<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===s?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return po.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,r=this;if(e(t,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===e(t,r.key)){if(r.right.isEmpty())return po.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,po.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,po.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw zr();if(this.right.isRed())throw zr();const t=this.left.check();if(t!==this.right.check())throw zr();return t+(this.isRed()?0:1)}}po.EMPTY=null,po.RED=!0,po.BLACK=!1,po.EMPTY=new class{constructor(){this.size=0}get key(){throw zr()}get value(){throw zr()}get color(){throw zr()}get left(){throw zr()}get right(){throw zr()}copy(t,e,n,r,s){return this}insert(t,e,n){return new po(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class yo{constructor(t){this.comparator=t,this.data=new go(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((e,n)=>(t(e),!1))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new wo(this.data.getIterator())}getIteratorFrom(t){return new wo(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(t=>{e=e.add(t)}),e}isEqual(t){if(!(t instanceof yo))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(0!==this.comparator(t,r))return!1}return!0}toArray(){const t=[];return this.forEach(e=>{t.push(e)}),t}toString(){const t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){const e=new yo(this.comparator);return e.data=t,e}}class wo{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}const vo=new go(xs.comparator);function bo(){return vo}const To=new go(xs.comparator);function Io(){return To}const Eo=new go(xs.comparator);function _o(){return Eo}const So=new yo(xs.comparator);function No(...t){let e=So;for(const n of t)e=e.add(n);return e}const Ao=new yo(is);function Do(){return Ao}class xo{constructor(t,e,n,r,s){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(t,e){const n=new Map;return n.set(t,Co.createSynthesizedTargetChangeForCurrentChange(t,e)),new xo(us.min(),n,Do(),bo(),No())}}class Co{constructor(t,e,n,r,s){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(t,e){return new Co(ws.EMPTY_BYTE_STRING,e,No(),No(),No())}}class ko{constructor(t,e,n,r){this.k=t,this.removedTargetIds=e,this.key=n,this.$=r}}class Lo{constructor(t,e){this.targetId=t,this.O=e}}class Ro{constructor(t,e,n=ws.EMPTY_BYTE_STRING,r=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}}class Oo{constructor(){this.F=0,this.M=Mo(),this.L=ws.EMPTY_BYTE_STRING,this.B=!1,this.U=!0}get current(){return this.B}get resumeToken(){return this.L}get q(){return 0!==this.F}get K(){return this.U}j(t){t.approximateByteSize()>0&&(this.U=!0,this.L=t)}W(){let t=No(),e=No(),n=No();return this.M.forEach((r,s)=>{switch(s){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:zr()}}),new Co(this.L,this.B,t,e,n)}G(){this.U=!1,this.M=Mo()}H(t,e){this.U=!0,this.M=this.M.insert(t,e)}J(t){this.U=!0,this.M=this.M.remove(t)}Y(){this.F+=1}X(){this.F-=1}Z(){this.U=!0,this.B=!0}}class Po{constructor(t){this.tt=t,this.et=new Map,this.nt=bo(),this.st=Fo(),this.it=new yo(is)}rt(t){for(const e of t.k)t.$&&t.$.isFoundDocument()?this.ot(e,t.$):this.at(e,t.key,t.$);for(const e of t.removedTargetIds)this.at(e,t.key,t.$)}ct(t){this.forEachTarget(t,e=>{const n=this.ut(e);switch(t.state){case 0:this.ht(e)&&n.j(t.resumeToken);break;case 1:n.X(),n.q||n.G(),n.j(t.resumeToken);break;case 2:n.X(),n.q||this.removeTarget(e);break;case 3:this.ht(e)&&(n.Z(),n.j(t.resumeToken));break;case 4:this.ht(e)&&(this.lt(e),n.j(t.resumeToken));break;default:zr()}})}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.et.forEach((t,n)=>{this.ht(n)&&e(n)})}ft(t){const e=t.targetId,n=t.O.count,r=this.dt(e);if(r){const t=r.target;if(Zs(t))if(0===n){const n=new xs(t.path);this.at(e,n,Gs.newNoDocument(n,us.min()))}else $r(1===n);else this.wt(e)!==n&&(this.lt(e),this.it=this.it.add(e))}}_t(t){const e=new Map;this.et.forEach((n,r)=>{const s=this.dt(r);if(s){if(n.current&&Zs(s.target)){const e=new xs(s.target.path);null!==this.nt.get(e)||this.gt(r,e)||this.at(r,e,Gs.newNoDocument(e,t))}n.K&&(e.set(r,n.W()),n.G())}});let n=No();this.st.forEach((t,e)=>{let r=!0;e.forEachWhile(t=>{const e=this.dt(t);return!e||2===e.purpose||(r=!1,!1)}),r&&(n=n.add(t))});const r=new xo(t,e,this.it,this.nt,n);return this.nt=bo(),this.st=Fo(),this.it=new yo(is),r}ot(t,e){if(!this.ht(t))return;const n=this.gt(t,e.key)?2:0;this.ut(t).H(e.key,n),this.nt=this.nt.insert(e.key,e),this.st=this.st.insert(e.key,this.yt(e.key).add(t))}at(t,e,n){if(!this.ht(t))return;const r=this.ut(t);this.gt(t,e)?r.H(e,1):r.J(e),this.st=this.st.insert(e,this.yt(e).delete(t)),n&&(this.nt=this.nt.insert(e,n))}removeTarget(t){this.et.delete(t)}wt(t){const e=this.ut(t).W();return this.tt.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Y(t){this.ut(t).Y()}ut(t){let e=this.et.get(t);return e||(e=new Oo,this.et.set(t,e)),e}yt(t){let e=this.st.get(t);return e||(e=new yo(is),this.st=this.st.insert(t,e)),e}ht(t){const e=null!==this.dt(t);return e||Vr("WatchChangeAggregator","Detected inactive target",t),e}dt(t){const e=this.et.get(t);return e&&e.q?null:this.tt.Et(t)}lt(t){this.et.set(t,new Oo),this.tt.getRemoteKeysForTarget(t).forEach(e=>{this.at(t,e,null)})}gt(t,e){return this.tt.getRemoteKeysForTarget(t).has(e)}}function Fo(){return new go(xs.comparator)}function Mo(){return new go(xs.comparator)}const qo={asc:"ASCENDING",desc:"DESCENDING"},Uo={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class Vo{constructor(t,e){this.databaseId=t,this.D=e}}function Bo(t,e){return t.D?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function jo(t,e){return t.D?e.toBase64():e.toUint8Array()}function Ko(t,e){return Bo(t,e.toTimestamp())}function zo(t){return $r(!!t),us.fromTimestamp(function(t){const e=bs(t);return new cs(e.seconds,e.nanos)}(t))}function $o(t,e){return function(t){return new gs(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function Go(t){const e=gs.fromString(t);return $r(pa(e)),e}function Ho(t,e){return $o(t.databaseId,e.path)}function Qo(t,e){const n=Go(e);if(n.get(1)!==t.databaseId.projectId)throw new Qr(Hr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Qr(Hr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new xs(Jo(n))}function Wo(t,e){return $o(t.databaseId,e)}function Yo(t){const e=Go(t);return 4===e.length?gs.emptyPath():Jo(e)}function Zo(t){return new gs(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Jo(t){return $r(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function Xo(t,e,n){return{name:Ho(t,e),fields:n.value.mapValue.fields}}function ta(t,e,n){const r=Qo(t,e.name),s=zo(e.updateTime),i=new zs({mapValue:{fields:e.fields}}),o=Gs.newFoundDocument(r,s,i);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function ea(t,e){let n;if(e instanceof eo)n={update:Xo(t,e.key,e.value)};else if(e instanceof oo)n={delete:Ho(t,e.key)};else if(e instanceof no)n={update:Xo(t,e.key,e.data),updateMask:ma(e.fieldMask)};else{if(!(e instanceof ao))return zr();n={verify:Ho(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(t=>function(t,e){const n=e.transform;if(n instanceof Mi)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof qi)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Vi)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof ji)return{fieldPath:e.field.canonicalString(),increment:n.C};throw zr()}(0,t))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:Ko(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:zr()}(t,e.precondition)),n}function na(t,e){const n=e.currentDocument?function(t){return void 0!==t.updateTime?Hi.updateTime(zo(t.updateTime)):void 0!==t.exists?Hi.exists(t.exists):Hi.none()}(e.currentDocument):Hi.none(),r=e.updateTransforms?e.updateTransforms.map(e=>function(t,e){let n=null;"setToServerValue"in e?($r("REQUEST_TIME"===e.setToServerValue),n=new Mi):"appendMissingElements"in e?n=new qi(e.appendMissingElements.values||[]):"removeAllFromArray"in e?n=new Vi(e.removeAllFromArray.values||[]):"increment"in e?n=new ji(t,e.increment):zr();const r=ps.fromServerFormat(e.fieldPath);return new $i(r,n)}(t,e)):[];if(e.update){const s=Qo(t,e.update.name),i=new zs({mapValue:{fields:e.update.fields}});if(e.updateMask){const t=function(t){return new ys((t.fieldPaths||[]).map(t=>ps.fromServerFormat(t)))}(e.updateMask);return new no(s,i,t,n,r)}return new eo(s,i,n,r)}if(e.delete){const r=Qo(t,e.delete);return new oo(r,n)}if(e.verify){const r=Qo(t,e.verify);return new ao(r,n)}return zr()}function ra(t,e){return{documents:[Wo(t,e.path)]}}function sa(t,e){const n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=Wo(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=Wo(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);const s=function(t){if(0===t.length)return;const e=t.map(t=>function(t){if("=="===t.op){if(Bs(t.value))return{unaryFilter:{field:la(t.field),op:"IS_NAN"}};if(Vs(t.value))return{unaryFilter:{field:la(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Bs(t.value))return{unaryFilter:{field:la(t.field),op:"IS_NOT_NAN"}};if(Vs(t.value))return{unaryFilter:{field:la(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:la(t.field),op:ha(t.op),value:t.value}}}(t));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}(e.filters);s&&(n.structuredQuery.where=s);const i=function(t){if(0!==t.length)return t.map(t=>function(t){return{field:la(t.field),direction:ua(t.dir)}}(t))}(e.orderBy);i&&(n.structuredQuery.orderBy=i);const o=function(t,e){return t.D||Ns(e)?e:{value:e}}(t,e.limit);return null!==o&&(n.structuredQuery.limit=o),e.startAt&&(n.structuredQuery.startAt=aa(e.startAt)),e.endAt&&(n.structuredQuery.endAt=aa(e.endAt)),n}function ia(t){let e=Yo(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let s=null;if(r>0){$r(1===r);const t=n.from[0];t.allDescendants?s=t.collectionId:e=e.child(t.collectionId)}let i=[];n.where&&(i=oa(n.where));let o=[];n.orderBy&&(o=n.orderBy.map(t=>function(t){return new ui(da(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)));let a=null;n.limit&&(a=function(t){let e;return e="object"==typeof t?t.value:t,Ns(e)?null:e}(n.limit));let c=null;n.startAt&&(c=ca(n.startAt));let u=null;return n.endAt&&(u=ca(n.endAt)),gi(e,s,o,i,a,"F",c,u)}function oa(t){return t?void 0!==t.unaryFilter?[ga(t)]:void 0!==t.fieldFilter?[fa(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(t=>oa(t)).reduce((t,e)=>t.concat(e)):zr():[]}function aa(t){return{before:t.before,values:t.position}}function ca(t){return new ai(t.values||[],!!t.before)}function ua(t){return qo[t]}function ha(t){return Uo[t]}function la(t){return{fieldPath:t.canonicalString()}}function da(t){return ps.fromServerFormat(t.fieldPath)}function fa(t){return Js.create(da(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return zr()}}(t.fieldFilter.op),t.fieldFilter.value)}function ga(t){switch(t.unaryFilter.op){case"IS_NAN":const e=da(t.unaryFilter.field);return Js.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=da(t.unaryFilter.field);return Js.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=da(t.unaryFilter.field);return Js.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=da(t.unaryFilter.field);return Js.create(s,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return zr()}}function ma(t){const e=[];return t.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function pa(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}function ya(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=va(e)),e=wa(t.get(n),e);return va(e)}function wa(t,e){let n=e;const r=t.length;for(let s=0;s<r;s++){const e=t.charAt(s);switch(e){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=e}}return n}function va(t){return t+"\x01\x01"}function ba(t){const e=t.length;if($r(e>=2),2===e)return $r("\x01"===t.charAt(0)&&"\x01"===t.charAt(1)),gs.emptyPath();const n=e-2,r=[];let s="";for(let i=0;i<e;){const e=t.indexOf("\x01",i);switch((e<0||e>n)&&zr(),t.charAt(e+1)){case"\x01":const n=t.substring(i,e);let o;0===s.length?o=n:(s+=n,o=s,s=""),r.push(o);break;case"\x10":s+=t.substring(i,e),s+="\0";break;case"\x11":s+=t.substring(i,e+1);break;default:zr()}i=e+2}return new gs(r)}class Ta{constructor(t,e){this.seconds=t,this.nanoseconds=e}}class Ia{constructor(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}}Ia.store="owner",Ia.key="owner";class Ea{constructor(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}}Ea.store="mutationQueues",Ea.keyPath="userId";class _a{constructor(t,e,n,r,s){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=s}}_a.store="mutations",_a.keyPath="batchId",_a.userMutationsIndex="userMutationsIndex",_a.userMutationsKeyPath=["userId","batchId"];class Sa{constructor(){}static prefixForUser(t){return[t]}static prefixForPath(t,e){return[t,ya(e)]}static key(t,e,n){return[t,ya(e),n]}}Sa.store="documentMutations",Sa.PLACEHOLDER=new Sa;class Na{constructor(t,e){this.path=t,this.readTime=e}}class Aa{constructor(t,e){this.path=t,this.version=e}}class Da{constructor(t,e,n,r,s,i){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=s,this.parentPath=i}}Da.store="remoteDocuments",Da.readTimeIndex="readTimeIndex",Da.readTimeIndexPath="readTime",Da.collectionReadTimeIndex="collectionReadTimeIndex",Da.collectionReadTimeIndexPath=["parentPath","readTime"];class xa{constructor(t){this.byteSize=t}}xa.store="remoteDocumentGlobal",xa.key="remoteDocumentGlobalKey";class Ca{constructor(t,e,n,r,s,i,o){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=s,this.lastLimboFreeSnapshotVersion=i,this.query=o}}Ca.store="targets",Ca.keyPath="targetId",Ca.queryTargetsIndexName="queryTargetsIndex",Ca.queryTargetsKeyPath=["canonicalId","targetId"];class ka{constructor(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n}}ka.store="targetDocuments",ka.keyPath=["targetId","path"],ka.documentTargetsIndex="documentTargetsIndex",ka.documentTargetsKeyPath=["path","targetId"];class La{constructor(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r}}La.key="targetGlobalKey",La.store="targetGlobal";class Ra{constructor(t,e){this.collectionId=t,this.parent=e}}Ra.store="collectionParents",Ra.keyPath=["collectionId","parent"];class Oa{constructor(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r}}Oa.store="clientMetadata",Oa.keyPath="clientId";class Pa{constructor(t,e,n){this.bundleId=t,this.createTime=e,this.version=n}}Pa.store="bundles",Pa.keyPath="bundleId";class Fa{constructor(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n}}Fa.store="namedQueries",Fa.keyPath="name";const Ma=[Ea.store,_a.store,Sa.store,Da.store,Ca.store,Ia.store,La.store,ka.store,Oa.store,xa.store,Ra.store,Pa.store,Fa.store],qa="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Ua{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}}class Va{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&zr(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new Va((n,r)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,r)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,r)}})}toPromise(){return new Promise((t,e)=>{this.next(t,e)})}wrapUserFunction(t){try{const e=t();return e instanceof Va?e:Va.resolve(e)}catch(t){return Va.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction(()=>t(e)):Va.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction(()=>t(e)):Va.reject(e)}static resolve(t){return new Va((e,n)=>{e(t)})}static reject(t){return new Va((e,n)=>{n(t)})}static waitFor(t){return new Va((e,n)=>{let r=0,s=0,i=!1;t.forEach(t=>{++r,t.next(()=>{++s,i&&s===r&&e()},t=>n(t))}),i=!0,s===r&&e()})}static or(t){let e=Va.resolve(!1);for(const n of t)e=e.next(t=>t?Va.resolve(t):n());return e}static forEach(t,e){const n=[];return t.forEach((t,r)=>{n.push(e.call(this,t,r))}),this.waitFor(n)}}class Ba{constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.Tt=new Wr,this.transaction.oncomplete=()=>{this.Tt.resolve()},this.transaction.onabort=()=>{e.error?this.Tt.reject(new za(t,e.error)):this.Tt.resolve()},this.transaction.onerror=e=>{const n=Wa(e.target.error);this.Tt.reject(new za(t,n))}}static open(t,e,n,r){try{return new Ba(e,t.transaction(r,n))}catch(t){throw new za(e,t)}}get It(){return this.Tt.promise}abort(t){t&&this.Tt.reject(t),this.aborted||(Vr("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}store(t){const e=this.transaction.objectStore(t);return new Ga(e)}}class ja{constructor(t,e,n){this.name=t,this.version=e,this.At=n,12.2===ja.Rt((0,D.z$)())&&Br("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(t){return Vr("SimpleDb","Removing database:",t),Ha(window.indexedDB.deleteDatabase(t)).toPromise()}static bt(){if(!(0,D.hl)())return!1;if(ja.Pt())return!0;const t=(0,D.z$)(),e=ja.Rt(t),n=0<e&&e<10,r=ja.vt(t),s=0<r&&r<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||n||s)}static Pt(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Vt)}static St(t,e){return t.store(e)}static Rt(t){const e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static vt(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async Dt(t){return this.db||(Vr("SimpleDb","Opening database:",this.name),this.db=await new Promise((e,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=t=>{e(t.target.result)},r.onblocked=()=>{n(new za(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=e=>{const r=e.target.error;n("VersionError"===r.name?new Qr(Hr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):"InvalidStateError"===r.name?new Qr(Hr.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r):new za(t,r))},r.onupgradeneeded=t=>{Vr("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',t.oldVersion),this.At.Ct(t.target.result,r.transaction,t.oldVersion,this.version).next(()=>{Vr("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.Nt&&(this.db.onversionchange=t=>this.Nt(t)),this.db}xt(t){this.Nt=t,this.db&&(this.db.onversionchange=e=>t(e))}async runTransaction(t,e,n,r){const s="readonly"===e;let i=0;for(;;){++i;try{this.db=await this.Dt(t);const e=Ba.open(this.db,t,s?"readonly":"readwrite",n),i=r(e).catch(t=>(e.abort(t),Va.reject(t))).toPromise();return i.catch(()=>{}),await e.It,i}catch(t){const e="FirebaseError"!==t.name&&i<3;if(Vr("SimpleDb","Transaction failed with error:",t.message,"Retrying:",e),this.close(),!e)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}class Ka{constructor(t){this.kt=t,this.$t=!1,this.Ot=null}get isDone(){return this.$t}get Ft(){return this.Ot}set cursor(t){this.kt=t}done(){this.$t=!0}Mt(t){this.Ot=t}delete(){return Ha(this.kt.delete())}}class za extends Qr{constructor(t,e){super(Hr.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}}function $a(t){return"IndexedDbTransactionError"===t.name}class Ga{constructor(t){this.store=t}put(t,e){let n;return void 0!==e?(Vr("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(Vr("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),Ha(n)}add(t){return Vr("SimpleDb","ADD",this.store.name,t,t),Ha(this.store.add(t))}get(t){return Ha(this.store.get(t)).next(e=>(void 0===e&&(e=null),Vr("SimpleDb","GET",this.store.name,t,e),e))}delete(t){return Vr("SimpleDb","DELETE",this.store.name,t),Ha(this.store.delete(t))}count(){return Vr("SimpleDb","COUNT",this.store.name),Ha(this.store.count())}Lt(t,e){const n=this.cursor(this.options(t,e)),r=[];return this.Bt(n,(t,e)=>{r.push(e)}).next(()=>r)}Ut(t,e){Vr("SimpleDb","DELETE ALL",this.store.name);const n=this.options(t,e);n.qt=!1;const r=this.cursor(n);return this.Bt(r,(t,e,n)=>n.delete())}Kt(t,e){let n;e?n=t:(n={},e=t);const r=this.cursor(n);return this.Bt(r,e)}jt(t){const e=this.cursor({});return new Va((n,r)=>{e.onerror=t=>{const e=Wa(t.target.error);r(e)},e.onsuccess=e=>{const r=e.target.result;r?t(r.primaryKey,r.value).next(t=>{t?r.continue():n()}):n()}})}Bt(t,e){const n=[];return new Va((r,s)=>{t.onerror=t=>{s(t.target.error)},t.onsuccess=t=>{const s=t.target.result;if(!s)return void r();const i=new Ka(s),o=e(s.primaryKey,s.value,i);if(o instanceof Va){const t=o.catch(t=>(i.done(),Va.reject(t)));n.push(t)}i.isDone?r():null===i.Ft?s.continue():s.continue(i.Ft)}}).next(()=>Va.waitFor(n))}options(t,e){let n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){const n=this.store.index(t.index);return t.qt?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}}function Ha(t){return new Va((e,n)=>{t.onsuccess=t=>{e(t.target.result)},t.onerror=t=>{const e=Wa(t.target.error);n(e)}})}let Qa=!1;function Wa(t){const e=ja.Rt((0,D.z$)());if(e>=12.2&&e<13){const e="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(e)>=0){const t=new Qr("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Qa||(Qa=!0,setTimeout(()=>{throw t},0)),t}}return t}class Ya extends Ua{constructor(t,e){super(),this.Qt=t,this.currentSequenceNumber=e}}function Za(t,e){const n=Gr(t);return ja.St(n.Qt,e)}class Ja{constructor(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let r=0;r<this.mutations.length;r++){const e=this.mutations[r];e.key.isEqual(t.key)&&Yi(e,t,n[r])}}applyToLocalView(t){for(const e of this.baseMutations)e.key.isEqual(t.key)&&Zi(e,t,this.localWriteTime);for(const e of this.mutations)e.key.isEqual(t.key)&&Zi(e,t,this.localWriteTime)}applyToLocalDocumentSet(t){this.mutations.forEach(e=>{const n=t.get(e.key),r=n;this.applyToLocalView(r),n.isValidDocument()||r.convertToNoDocument(us.min())})}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),No())}isEqual(t){return this.batchId===t.batchId&&os(this.mutations,t.mutations,(t,e)=>Xi(t,e))&&os(this.baseMutations,t.baseMutations,(t,e)=>Xi(t,e))}}class Xa{constructor(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}static from(t,e,n){$r(t.mutations.length===n.length);let r=_o();const s=t.mutations;for(let i=0;i<s.length;i++)r=r.insert(s[i].key,n[i].version);return new Xa(t,e,n,r)}}class tc{constructor(t,e,n,r,s=us.min(),i=us.min(),o=ws.EMPTY_BYTE_STRING){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=i,this.resumeToken=o}withSequenceNumber(t){return new tc(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(t,e){return new tc(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)}withLastLimboFreeSnapshotVersion(t){return new tc(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)}}class ec{constructor(t){this.Wt=t}}function nc(t,e){if(e.document)return ta(t.Wt,e.document,!!e.hasCommittedMutations);if(e.noDocument){const t=xs.fromSegments(e.noDocument.path),n=ac(e.noDocument.readTime),r=Gs.newNoDocument(t,n);return e.hasCommittedMutations?r.setHasCommittedMutations():r}if(e.unknownDocument){const t=xs.fromSegments(e.unknownDocument.path),n=ac(e.unknownDocument.version);return Gs.newUnknownDocument(t,n)}return zr()}function rc(t,e,n){const r=sc(n),s=e.key.path.popLast().toArray();if(e.isFoundDocument()){const n=function(t,e){return{name:Ho(t,e.key),fields:e.data.value.mapValue.fields,updateTime:Bo(t,e.version.toTimestamp())}}(t.Wt,e);return new Da(null,null,n,e.hasCommittedMutations,r,s)}if(e.isNoDocument()){const t=e.key.path.toArray(),n=oc(e.version),i=e.hasCommittedMutations;return new Da(null,new Na(t,n),null,i,r,s)}if(e.isUnknownDocument()){const t=e.key.path.toArray(),n=oc(e.version);return new Da(new Aa(t,n),null,null,!0,r,s)}return zr()}function sc(t){const e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function ic(t){const e=new cs(t[0],t[1]);return us.fromTimestamp(e)}function oc(t){const e=t.toTimestamp();return new Ta(e.seconds,e.nanoseconds)}function ac(t){const e=new cs(t.seconds,t.nanoseconds);return us.fromTimestamp(e)}function cc(t,e){const n=(e.baseMutations||[]).map(e=>na(t.Wt,e));for(let i=0;i<e.mutations.length-1;++i){const t=e.mutations[i];i+1<e.mutations.length&&void 0!==e.mutations[i+1].transform&&(t.updateTransforms=e.mutations[i+1].transform.fieldTransforms,e.mutations.splice(i+1,1),++i)}const r=e.mutations.map(e=>na(t.Wt,e)),s=cs.fromMillis(e.localWriteTimeMs);return new Ja(e.batchId,s,n,r)}function uc(t){const e=ac(t.readTime),n=void 0!==t.lastLimboFreeSnapshotVersion?ac(t.lastLimboFreeSnapshotVersion):us.min();let r;var s;return void 0!==t.query.documents?($r(1===(s=t.query).documents.length),r=Ii(mi(Yo(s.documents[0])))):r=function(t){return Ii(ia(t))}(t.query),new tc(r,t.targetId,0,t.lastListenSequenceNumber,e,n,ws.fromBase64String(t.resumeToken))}function hc(t,e){const n=oc(e.snapshotVersion),r=oc(e.lastLimboFreeSnapshotVersion);let s;s=Zs(e.target)?ra(t.Wt,e.target):sa(t.Wt,e.target);const i=e.resumeToken.toBase64();return new Ca(e.targetId,Ws(e.target),n,i,e.sequenceNumber,r,s)}function lc(t){const e=ia({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Ei(e,e.limit,"L"):e}class dc{getBundleMetadata(t,e){return fc(t).get(e).next(t=>{if(t)return{id:(e=t).bundleId,createTime:ac(e.createTime),version:e.version};var e})}saveBundleMetadata(t,e){return fc(t).put({bundleId:(n=e).id,createTime:oc(zo(n.createTime)),version:n.version});var n}getNamedQuery(t,e){return gc(t).get(e).next(t=>{if(t)return{name:(e=t).name,query:lc(e.bundledQuery),readTime:ac(e.readTime)};var e})}saveNamedQuery(t,e){return gc(t).put(function(t){return{name:t.name,readTime:oc(zo(t.readTime)),bundledQuery:t.bundledQuery}}(e))}}function fc(t){return Za(t,Pa.store)}function gc(t){return Za(t,Fa.store)}class mc{constructor(){this.Gt=new pc}addToCollectionParentIndex(t,e){return this.Gt.add(e),Va.resolve()}getCollectionParents(t,e){return Va.resolve(this.Gt.getEntries(e))}}class pc{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new yo(gs.comparator),s=!r.has(n);return this.index[e]=r.add(n),s}has(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)}getEntries(t){return(this.index[t]||new yo(gs.comparator)).toArray()}}class yc{constructor(){this.zt=new pc}addToCollectionParentIndex(t,e){if(!this.zt.has(e)){const n=e.lastSegment(),r=e.popLast();t.addOnCommittedListener(()=>{this.zt.add(e)});const s={collectionId:n,parent:ya(r)};return wc(t).put(s)}return Va.resolve()}getCollectionParents(t,e){const n=[],r=IDBKeyRange.bound([e,""],[as(e),""],!1,!0);return wc(t).Lt(r).next(t=>{for(const r of t){if(r.collectionId!==e)break;n.push(ba(r.parent))}return n})}}function wc(t){return Za(t,Ra.store)}const vc={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class bc{constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}static withCacheSize(t){return new bc(t,bc.DEFAULT_COLLECTION_PERCENTILE,bc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function Tc(t,e,n){const r=t.store(_a.store),s=t.store(Sa.store),i=[],o=IDBKeyRange.only(n.batchId);let a=0;const c=r.Kt({range:o},(t,e,n)=>(a++,n.delete()));i.push(c.next(()=>{$r(1===a)}));const u=[];for(const h of n.mutations){const t=Sa.key(e,h.key.path,n.batchId);i.push(s.delete(t)),u.push(h.key)}return Va.waitFor(i).next(()=>u)}function Ic(t){if(!t)return 0;let e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw zr();e=t.noDocument}return JSON.stringify(e).length}bc.DEFAULT_COLLECTION_PERCENTILE=10,bc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,bc.DEFAULT=new bc(41943040,bc.DEFAULT_COLLECTION_PERCENTILE,bc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),bc.DISABLED=new bc(-1,0,0);class Ec{constructor(t,e,n,r){this.userId=t,this.N=e,this.Ht=n,this.referenceDelegate=r,this.Jt={}}static Yt(t,e,n,r){$r(""!==t.uid);const s=t.isAuthenticated()?t.uid:"";return new Ec(s,e,n,r)}checkEmpty(t){let e=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Sc(t).Kt({index:_a.userMutationsIndex,range:n},(t,n,r)=>{e=!1,r.done()}).next(()=>e)}addMutationBatch(t,e,n,r){const s=Nc(t),i=Sc(t);return i.add({}).next(o=>{$r("number"==typeof o);const a=new Ja(o,e,n,r),c=function(t,e,n){const r=n.baseMutations.map(e=>ea(t.Wt,e)),s=n.mutations.map(e=>ea(t.Wt,e));return new _a(e,n.batchId,n.localWriteTime.toMillis(),r,s)}(this.N,this.userId,a),u=[];let h=new yo((t,e)=>is(t.canonicalString(),e.canonicalString()));for(const t of r){const e=Sa.key(this.userId,t.key.path,o);h=h.add(t.key.path.popLast()),u.push(i.put(c)),u.push(s.put(e,Sa.PLACEHOLDER))}return h.forEach(e=>{u.push(this.Ht.addToCollectionParentIndex(t,e))}),t.addOnCommittedListener(()=>{this.Jt[o]=a.keys()}),Va.waitFor(u).next(()=>a)})}lookupMutationBatch(t,e){return Sc(t).get(e).next(t=>t?($r(t.userId===this.userId),cc(this.N,t)):null)}Xt(t,e){return this.Jt[e]?Va.resolve(this.Jt[e]):this.lookupMutationBatch(t,e).next(t=>{if(t){const n=t.keys();return this.Jt[e]=n,n}return null})}getNextMutationBatchAfterBatchId(t,e){const n=e+1,r=IDBKeyRange.lowerBound([this.userId,n]);let s=null;return Sc(t).Kt({index:_a.userMutationsIndex,range:r},(t,e,r)=>{e.userId===this.userId&&($r(e.batchId>=n),s=cc(this.N,e)),r.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(t){const e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return Sc(t).Kt({index:_a.userMutationsIndex,range:e,reverse:!0},(t,e,r)=>{n=e.batchId,r.done()}).next(()=>n)}getAllMutationBatches(t){const e=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Sc(t).Lt(_a.userMutationsIndex,e).next(t=>t.map(t=>cc(this.N,t)))}getAllMutationBatchesAffectingDocumentKey(t,e){const n=Sa.prefixForPath(this.userId,e.path),r=IDBKeyRange.lowerBound(n),s=[];return Nc(t).Kt({range:r},(n,r,i)=>{const[o,a,c]=n,u=ba(a);if(o===this.userId&&e.path.isEqual(u))return Sc(t).get(c).next(t=>{if(!t)throw zr();$r(t.userId===this.userId),s.push(cc(this.N,t))});i.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new yo(is);const r=[];return e.forEach(e=>{const s=Sa.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(s),o=Nc(t).Kt({range:i},(t,r,s)=>{const[i,o,a]=t,c=ba(o);i===this.userId&&e.path.isEqual(c)?n=n.add(a):s.done()});r.push(o)}),Va.waitFor(r).next(()=>this.Zt(t,n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,r=n.length+1,s=Sa.prefixForPath(this.userId,n),i=IDBKeyRange.lowerBound(s);let o=new yo(is);return Nc(t).Kt({range:i},(t,e,s)=>{const[i,a,c]=t,u=ba(a);i===this.userId&&n.isPrefixOf(u)?u.length===r&&(o=o.add(c)):s.done()}).next(()=>this.Zt(t,o))}Zt(t,e){const n=[],r=[];return e.forEach(e=>{r.push(Sc(t).get(e).next(t=>{if(null===t)throw zr();$r(t.userId===this.userId),n.push(cc(this.N,t))}))}),Va.waitFor(r).next(()=>n)}removeMutationBatch(t,e){return Tc(t.Qt,this.userId,e).next(n=>(t.addOnCommittedListener(()=>{this.te(e.batchId)}),Va.forEach(n,e=>this.referenceDelegate.markPotentiallyOrphaned(t,e))))}te(t){delete this.Jt[t]}performConsistencyCheck(t){return this.checkEmpty(t).next(e=>{if(!e)return Va.resolve();const n=IDBKeyRange.lowerBound(Sa.prefixForUser(this.userId)),r=[];return Nc(t).Kt({range:n},(t,e,n)=>{if(t[0]===this.userId){const e=ba(t[1]);r.push(e)}else n.done()}).next(()=>{$r(0===r.length)})})}containsKey(t,e){return _c(t,this.userId,e)}ee(t){return Ac(t).get(this.userId).next(t=>t||new Ea(this.userId,-1,""))}}function _c(t,e,n){const r=Sa.prefixForPath(e,n.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return Nc(t).Kt({range:i,qt:!0},(t,n,r)=>{const[i,a,c]=t;i===e&&a===s&&(o=!0),r.done()}).next(()=>o)}function Sc(t){return Za(t,_a.store)}function Nc(t){return Za(t,Sa.store)}function Ac(t){return Za(t,Ea.store)}class Dc{constructor(t){this.ne=t}next(){return this.ne+=2,this.ne}static se(){return new Dc(0)}static ie(){return new Dc(-1)}}class xc{constructor(t,e){this.referenceDelegate=t,this.N=e}allocateTargetId(t){return this.re(t).next(e=>{const n=new Dc(e.highestTargetId);return e.highestTargetId=n.next(),this.oe(t,e).next(()=>e.highestTargetId)})}getLastRemoteSnapshotVersion(t){return this.re(t).next(t=>us.fromTimestamp(new cs(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(t){return this.re(t).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(t,e,n){return this.re(t).next(r=>(r.highestListenSequenceNumber=e,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),e>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=e),this.oe(t,r)))}addTargetData(t,e){return this.ae(t,e).next(()=>this.re(t).next(n=>(n.targetCount+=1,this.ce(e,n),this.oe(t,n))))}updateTargetData(t,e){return this.ae(t,e)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next(()=>Cc(t).delete(e.targetId)).next(()=>this.re(t)).next(e=>($r(e.targetCount>0),e.targetCount-=1,this.oe(t,e)))}removeTargets(t,e,n){let r=0;const s=[];return Cc(t).Kt((i,o)=>{const a=uc(o);a.sequenceNumber<=e&&null===n.get(a.targetId)&&(r++,s.push(this.removeTargetData(t,a)))}).next(()=>Va.waitFor(s)).next(()=>r)}forEachTarget(t,e){return Cc(t).Kt((t,n)=>{const r=uc(n);e(r)})}re(t){return kc(t).get(La.key).next(t=>($r(null!==t),t))}oe(t,e){return kc(t).put(La.key,e)}ae(t,e){return Cc(t).put(hc(this.N,e))}ce(t,e){let n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n}getTargetCount(t){return this.re(t).next(t=>t.targetCount)}getTargetData(t,e){const n=Ws(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let s=null;return Cc(t).Kt({range:r,index:Ca.queryTargetsIndexName},(t,n,r)=>{const i=uc(n);Ys(e,i.target)&&(s=i,r.done())}).next(()=>s)}addMatchingKeys(t,e,n){const r=[],s=Lc(t);return e.forEach(e=>{const i=ya(e.path);r.push(s.put(new ka(n,i))),r.push(this.referenceDelegate.addReference(t,n,e))}),Va.waitFor(r)}removeMatchingKeys(t,e,n){const r=Lc(t);return Va.forEach(e,e=>{const s=ya(e.path);return Va.waitFor([r.delete([n,s]),this.referenceDelegate.removeReference(t,n,e)])})}removeMatchingKeysForTargetId(t,e){const n=Lc(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(t,e){const n=IDBKeyRange.bound([e],[e+1],!1,!0),r=Lc(t);let s=No();return r.Kt({range:n,qt:!0},(t,e,n)=>{const r=ba(t[1]),i=new xs(r);s=s.add(i)}).next(()=>s)}containsKey(t,e){const n=ya(e.path),r=IDBKeyRange.bound([n],[as(n)],!1,!0);let s=0;return Lc(t).Kt({index:ka.documentTargetsIndex,qt:!0,range:r},([t,e],n,r)=>{0!==t&&(s++,r.done())}).next(()=>s>0)}Et(t,e){return Cc(t).get(e).next(t=>t?uc(t):null)}}function Cc(t){return Za(t,Ca.store)}function kc(t){return Za(t,La.store)}function Lc(t){return Za(t,ka.store)}async function Rc(t){if(t.code!==Hr.FAILED_PRECONDITION||t.message!==qa)throw t;Vr("LocalStore","Unexpectedly lost primary lease")}function Oc([t,e],[n,r]){const s=is(t,n);return 0===s?is(e,r):s}class Pc{constructor(t){this.ue=t,this.buffer=new yo(Oc),this.he=0}le(){return++this.he}fe(t){const e=[t,this.le()];if(this.buffer.size<this.ue)this.buffer=this.buffer.add(e);else{const t=this.buffer.last();Oc(e,t)<0&&(this.buffer=this.buffer.delete(t).add(e))}}get maxValue(){return this.buffer.last()[0]}}class Fc{constructor(t,e){this.garbageCollector=t,this.asyncQueue=e,this.de=!1,this.we=null}start(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this._e(t)}stop(){this.we&&(this.we.cancel(),this.we=null)}get started(){return null!==this.we}_e(t){const e=this.de?3e5:6e4;Vr("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.we=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.we=null,this.de=!0;try{await t.collectGarbage(this.garbageCollector)}catch(t){$a(t)?Vr("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await Rc(t)}await this._e(t)})}}class Mc{constructor(t,e){this.me=t,this.params=e}calculateTargetCount(t,e){return this.me.ge(t).next(t=>Math.floor(e/100*t))}nthSequenceNumber(t,e){if(0===e)return Va.resolve(ns.T);const n=new Pc(e);return this.me.forEachTarget(t,t=>n.fe(t.sequenceNumber)).next(()=>this.me.ye(t,t=>n.fe(t))).next(()=>n.maxValue)}removeTargets(t,e,n){return this.me.removeTargets(t,e,n)}removeOrphanedDocuments(t,e){return this.me.removeOrphanedDocuments(t,e)}collect(t,e){return-1===this.params.cacheSizeCollectionThreshold?(Vr("LruGarbageCollector","Garbage collection skipped; disabled"),Va.resolve(vc)):this.getCacheSize(t).next(n=>n<this.params.cacheSizeCollectionThreshold?(Vr("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),vc):this.pe(t,e))}getCacheSize(t){return this.me.getCacheSize(t)}pe(t,e){let n,r,s,i,o,a,c;const u=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(e=>(e>this.params.maximumSequenceNumbersToCollect?(Vr("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${e}`),r=this.params.maximumSequenceNumbersToCollect):r=e,i=Date.now(),this.nthSequenceNumber(t,r))).next(r=>(n=r,o=Date.now(),this.removeTargets(t,n,e))).next(e=>(s=e,a=Date.now(),this.removeOrphanedDocuments(t,n))).next(t=>(c=Date.now(),Ur()<=A.in.DEBUG&&Vr("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${i-u}ms\n\tDetermined least recently used ${r} in `+(o-i)+"ms\n"+`\tRemoved ${s} targets in `+(a-o)+"ms\n"+`\tRemoved ${t} documents in `+(c-a)+"ms\n"+`Total Duration: ${c-u}ms`),Va.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:s,documentsRemoved:t})))}}class qc{constructor(t,e){this.db=t,this.garbageCollector=function(t,e){return new Mc(t,e)}(this,e)}ge(t){const e=this.Ee(t);return this.db.getTargetCache().getTargetCount(t).next(t=>e.next(e=>t+e))}Ee(t){let e=0;return this.ye(t,t=>{e++}).next(()=>e)}forEachTarget(t,e){return this.db.getTargetCache().forEachTarget(t,e)}ye(t,e){return this.Te(t,(t,n)=>e(n))}addReference(t,e,n){return Uc(t,n)}removeReference(t,e,n){return Uc(t,n)}removeTargets(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)}markPotentiallyOrphaned(t,e){return Uc(t,e)}Ie(t,e){return function(t,e){let n=!1;return Ac(t).jt(r=>_c(t,r,e).next(t=>(t&&(n=!0),Va.resolve(!t)))).next(()=>n)}(t,e)}removeOrphanedDocuments(t,e){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[];let s=0;return this.Te(t,(i,o)=>{if(o<=e){const e=this.Ie(t,i).next(e=>{if(!e)return s++,n.getEntry(t,i).next(()=>(n.removeEntry(i),Lc(t).delete([0,ya(i.path)])))});r.push(e)}}).next(()=>Va.waitFor(r)).next(()=>n.apply(t)).next(()=>s)}removeTarget(t,e){const n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)}updateLimboDocument(t,e){return Uc(t,e)}Te(t,e){const n=Lc(t);let r,s=ns.T;return n.Kt({index:ka.documentTargetsIndex},([t,n],{path:i,sequenceNumber:o})=>{0===t?(s!==ns.T&&e(new xs(ba(r)),s),s=o,r=i):s=ns.T}).next(()=>{s!==ns.T&&e(new xs(ba(r)),s)})}getCacheSize(t){return this.db.getRemoteDocumentCache().getSize(t)}}function Uc(t,e){return Lc(t).put(function(t,e){return new ka(0,ya(t.path),e)}(e,t.currentSequenceNumber))}class Vc{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[r,s]of n)if(this.equalsFn(r,t))return s}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],t))return void(r[n]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1}forEach(t){ls(this.inner,(e,n)=>{for(const[r,s]of n)t(r,s)})}isEmpty(){return ds(this.inner)}}class Bc{constructor(){this.changes=new Vc(t=>t.toString(),(t,e)=>t.isEqual(e)),this.changesApplied=!1}getReadTime(t){const e=this.changes.get(t);return e?e.readTime:us.min()}addEntry(t,e){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:e})}removeEntry(t,e=null){this.assertNotApplied(),this.changes.set(t,{document:Gs.newInvalidDocument(t),readTime:e})}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?Va.resolve(n.document):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class jc{constructor(t,e){this.N=t,this.Ht=e}addEntry(t,e,n){return $c(t).put(Gc(e),n)}removeEntry(t,e){const n=$c(t),r=Gc(e);return n.delete(r)}updateMetadata(t,e){return this.getMetadata(t).next(n=>(n.byteSize+=e,this.Ae(t,n)))}getEntry(t,e){return $c(t).get(Gc(e)).next(t=>this.Re(e,t))}be(t,e){return $c(t).get(Gc(e)).next(t=>({document:this.Re(e,t),size:Ic(t)}))}getEntries(t,e){let n=bo();return this.Pe(t,e,(t,e)=>{const r=this.Re(t,e);n=n.insert(t,r)}).next(()=>n)}ve(t,e){let n=bo(),r=new go(xs.comparator);return this.Pe(t,e,(t,e)=>{const s=this.Re(t,e);n=n.insert(t,s),r=r.insert(t,Ic(e))}).next(()=>({documents:n,Ve:r}))}Pe(t,e,n){if(e.isEmpty())return Va.resolve();const r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),s=e.getIterator();let i=s.getNext();return $c(t).Kt({range:r},(t,e,r)=>{const o=xs.fromSegments(t);for(;i&&xs.comparator(i,o)<0;)n(i,null),i=s.getNext();i&&i.isEqual(o)&&(n(i,e),i=s.hasNext()?s.getNext():null),i?r.Mt(i.path.toArray()):r.done()}).next(()=>{for(;i;)n(i,null),i=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(t,e,n){let r=bo();const s=e.path.length+1,i={};if(n.isEqual(us.min())){const t=e.path.toArray();i.range=IDBKeyRange.lowerBound(t)}else{const t=e.path.toArray(),r=sc(n);i.range=IDBKeyRange.lowerBound([t,r],!0),i.index=Da.collectionReadTimeIndex}return $c(t).Kt(i,(t,n,i)=>{if(t.length!==s)return;const o=nc(this.N,n);e.path.isPrefixOf(o.key.path)?Ai(e,o)&&(r=r.insert(o.key,o)):i.done()}).next(()=>r)}newChangeBuffer(t){return new Kc(this,!!t&&t.trackRemovals)}getSize(t){return this.getMetadata(t).next(t=>t.byteSize)}getMetadata(t){return zc(t).get(xa.key).next(t=>($r(!!t),t))}Ae(t,e){return zc(t).put(xa.key,e)}Re(t,e){if(e){const t=nc(this.N,e);if(!t.isNoDocument()||!t.version.isEqual(us.min()))return t}return Gs.newInvalidDocument(t)}}class Kc extends Bc{constructor(t,e){super(),this.Se=t,this.trackRemovals=e,this.De=new Vc(t=>t.toString(),(t,e)=>t.isEqual(e))}applyChanges(t){const e=[];let n=0,r=new yo((t,e)=>is(t.canonicalString(),e.canonicalString()));return this.changes.forEach((s,i)=>{const o=this.De.get(s);if(i.document.isValidDocument()){const a=rc(this.Se.N,i.document,this.getReadTime(s));r=r.add(s.path.popLast());const c=Ic(a);n+=c-o,e.push(this.Se.addEntry(t,s,a))}else if(n-=o,this.trackRemovals){const n=rc(this.Se.N,Gs.newNoDocument(s,us.min()),this.getReadTime(s));e.push(this.Se.addEntry(t,s,n))}else e.push(this.Se.removeEntry(t,s))}),r.forEach(n=>{e.push(this.Se.Ht.addToCollectionParentIndex(t,n))}),e.push(this.Se.updateMetadata(t,n)),Va.waitFor(e)}getFromCache(t,e){return this.Se.be(t,e).next(t=>(this.De.set(e,t.size),t.document))}getAllFromCache(t,e){return this.Se.ve(t,e).next(({documents:t,Ve:e})=>(e.forEach((t,e)=>{this.De.set(t,e)}),t))}}function zc(t){return Za(t,xa.store)}function $c(t){return Za(t,Da.store)}function Gc(t){return t.path.toArray()}class Hc{constructor(t){this.N=t}Ct(t,e,n,r){$r(n<r&&n>=0&&r<=11);const s=new Ba("createOrUpgrade",e);n<1&&r>=1&&(function(t){t.createObjectStore(Ia.store)}(t),function(t){t.createObjectStore(Ea.store,{keyPath:Ea.keyPath}),t.createObjectStore(_a.store,{keyPath:_a.keyPath,autoIncrement:!0}).createIndex(_a.userMutationsIndex,_a.userMutationsKeyPath,{unique:!0}),t.createObjectStore(Sa.store)}(t),Qc(t),function(t){t.createObjectStore(Da.store)}(t));let i=Va.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(ka.store),t.deleteObjectStore(Ca.store),t.deleteObjectStore(La.store)}(t),Qc(t)),i=i.next(()=>function(t){const e=t.store(La.store),n=new La(0,0,us.min().toTimestamp(),0);return e.put(La.key,n)}(s))),n<4&&r>=4&&(0!==n&&(i=i.next(()=>function(t,e){return e.store(_a.store).Lt().next(n=>{t.deleteObjectStore(_a.store),t.createObjectStore(_a.store,{keyPath:_a.keyPath,autoIncrement:!0}).createIndex(_a.userMutationsIndex,_a.userMutationsKeyPath,{unique:!0});const r=e.store(_a.store),s=n.map(t=>r.put(t));return Va.waitFor(s)})}(t,s))),i=i.next(()=>{!function(t){t.createObjectStore(Oa.store,{keyPath:Oa.keyPath})}(t)})),n<5&&r>=5&&(i=i.next(()=>this.Ce(s))),n<6&&r>=6&&(i=i.next(()=>(function(t){t.createObjectStore(xa.store)}(t),this.Ne(s)))),n<7&&r>=7&&(i=i.next(()=>this.xe(s))),n<8&&r>=8&&(i=i.next(()=>this.ke(t,s))),n<9&&r>=9&&(i=i.next(()=>{!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){const e=t.objectStore(Da.store);e.createIndex(Da.readTimeIndex,Da.readTimeIndexPath,{unique:!1}),e.createIndex(Da.collectionReadTimeIndex,Da.collectionReadTimeIndexPath,{unique:!1})}(e)})),n<10&&r>=10&&(i=i.next(()=>this.$e(s))),n<11&&r>=11&&(i=i.next(()=>{!function(t){t.createObjectStore(Pa.store,{keyPath:Pa.keyPath})}(t),function(t){t.createObjectStore(Fa.store,{keyPath:Fa.keyPath})}(t)})),i}Ne(t){let e=0;return t.store(Da.store).Kt((t,n)=>{e+=Ic(n)}).next(()=>{const n=new xa(e);return t.store(xa.store).put(xa.key,n)})}Ce(t){const e=t.store(Ea.store),n=t.store(_a.store);return e.Lt().next(e=>Va.forEach(e,e=>{const r=IDBKeyRange.bound([e.userId,-1],[e.userId,e.lastAcknowledgedBatchId]);return n.Lt(_a.userMutationsIndex,r).next(n=>Va.forEach(n,n=>{$r(n.userId===e.userId);const r=cc(this.N,n);return Tc(t,e.userId,r).next(()=>{})}))}))}xe(t){const e=t.store(ka.store),n=t.store(Da.store);return t.store(La.store).get(La.key).next(t=>{const r=[];return n.Kt((n,s)=>{const i=new gs(n),o=function(t){return[0,ya(t)]}(i);r.push(e.get(o).next(n=>n?Va.resolve():(n=>e.put(new ka(0,ya(n),t.highestListenSequenceNumber)))(i)))}).next(()=>Va.waitFor(r))})}ke(t,e){t.createObjectStore(Ra.store,{keyPath:Ra.keyPath});const n=e.store(Ra.store),r=new pc,s=t=>{if(r.add(t)){const e=t.lastSegment(),r=t.popLast();return n.put({collectionId:e,parent:ya(r)})}};return e.store(Da.store).Kt({qt:!0},(t,e)=>{const n=new gs(t);return s(n.popLast())}).next(()=>e.store(Sa.store).Kt({qt:!0},([t,e,n],r)=>{const i=ba(e);return s(i.popLast())}))}$e(t){const e=t.store(Ca.store);return e.Kt((t,n)=>{const r=uc(n),s=hc(this.N,r);return e.put(s)})}}function Qc(t){t.createObjectStore(ka.store,{keyPath:ka.keyPath}).createIndex(ka.documentTargetsIndex,ka.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Ca.store,{keyPath:Ca.keyPath}).createIndex(Ca.queryTargetsIndexName,Ca.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(La.store)}const Wc="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Yc{constructor(t,e,n,r,s,i,o,a,c,u){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.Oe=s,this.window=i,this.document=o,this.Fe=c,this.Me=u,this.Le=null,this.Be=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Ue=null,this.inForeground=!1,this.qe=null,this.Ke=null,this.je=Number.NEGATIVE_INFINITY,this.Qe=t=>Promise.resolve(),!Yc.bt())throw new Qr(Hr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new qc(this,r),this.We=e+"main",this.N=new ec(a),this.Ge=new ja(this.We,11,new Hc(this.N)),this.ze=new xc(this.referenceDelegate,this.N),this.Ht=new yc,this.He=function(t,e){return new jc(t,e)}(this.N,this.Ht),this.Je=new dc,this.window&&this.window.localStorage?this.Ye=this.window.localStorage:(this.Ye=null,!1===u&&Br("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Xe().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new Qr(Hr.FAILED_PRECONDITION,Wc);return this.Ze(),this.tn(),this.en(),this.runTransaction("getHighestListenSequenceNumber","readonly",t=>this.ze.getHighestSequenceNumber(t))}).then(t=>{this.Le=new ns(t,this.Fe)}).then(()=>{this.Be=!0}).catch(t=>(this.Ge&&this.Ge.close(),Promise.reject(t)))}nn(t){return this.Qe=async e=>{if(this.started)return t(e)},t(this.isPrimary)}setDatabaseDeletedListener(t){this.Ge.xt(async e=>{null===e.newVersion&&await t()})}setNetworkEnabled(t){this.networkEnabled!==t&&(this.networkEnabled=t,this.Oe.enqueueAndForget(async()=>{this.started&&await this.Xe()}))}Xe(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t=>Jc(t).put(new Oa(this.clientId,Date.now(),this.networkEnabled,this.inForeground)).next(()=>{if(this.isPrimary)return this.sn(t).next(t=>{t||(this.isPrimary=!1,this.Oe.enqueueRetryable(()=>this.Qe(!1)))})}).next(()=>this.rn(t)).next(e=>this.isPrimary&&!e?this.on(t).next(()=>!1):!!e&&this.an(t).next(()=>!0))).catch(t=>{if($a(t))return Vr("IndexedDbPersistence","Failed to extend owner lease: ",t),this.isPrimary;if(!this.allowTabSynchronization)throw t;return Vr("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(t=>{this.isPrimary!==t&&this.Oe.enqueueRetryable(()=>this.Qe(t)),this.isPrimary=t})}sn(t){return Zc(t).get(Ia.key).next(t=>Va.resolve(this.cn(t)))}un(t){return Jc(t).delete(this.clientId)}async hn(){if(this.isPrimary&&!this.ln(this.je,18e5)){this.je=Date.now();const t=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const e=Za(t,Oa.store);return e.Lt().next(t=>{const n=this.fn(t,18e5),r=t.filter(t=>-1===n.indexOf(t));return Va.forEach(r,t=>e.delete(t.clientId)).next(()=>r)})}).catch(()=>[]);if(this.Ye)for(const e of t)this.Ye.removeItem(this.dn(e.clientId))}}en(){this.Ke=this.Oe.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Xe().then(()=>this.hn()).then(()=>this.en()))}cn(t){return!!t&&t.ownerId===this.clientId}rn(t){return this.Me?Va.resolve(!0):Zc(t).get(Ia.key).next(e=>{if(null!==e&&this.ln(e.leaseTimestampMs,5e3)&&!this.wn(e.ownerId)){if(this.cn(e)&&this.networkEnabled)return!0;if(!this.cn(e)){if(!e.allowTabSynchronization)throw new Qr(Hr.FAILED_PRECONDITION,Wc);return!1}}return!(!this.networkEnabled||!this.inForeground)||Jc(t).Lt().next(t=>void 0===this.fn(t,5e3).find(t=>{if(this.clientId!==t.clientId){const e=!this.inForeground&&t.inForeground,n=this.networkEnabled===t.networkEnabled;if(!this.networkEnabled&&t.networkEnabled||e&&n)return!0}return!1}))}).next(t=>(this.isPrimary!==t&&Vr("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async shutdown(){this.Be=!1,this._n(),this.Ke&&(this.Ke.cancel(),this.Ke=null),this.mn(),this.gn(),await this.Ge.runTransaction("shutdown","readwrite",[Ia.store,Oa.store],t=>{const e=new Ya(t,ns.T);return this.on(e).next(()=>this.un(e))}),this.Ge.close(),this.yn()}fn(t,e){return t.filter(t=>this.ln(t.updateTimeMs,e)&&!this.wn(t.clientId))}pn(){return this.runTransaction("getActiveClients","readonly",t=>Jc(t).Lt().next(t=>this.fn(t,18e5).map(t=>t.clientId)))}get started(){return this.Be}getMutationQueue(t){return Ec.Yt(t,this.N,this.Ht,this.referenceDelegate)}getTargetCache(){return this.ze}getRemoteDocumentCache(){return this.He}getIndexManager(){return this.Ht}getBundleCache(){return this.Je}runTransaction(t,e,n){let r;return Vr("IndexedDbPersistence","Starting transaction:",t),this.Ge.runTransaction(t,"readonly"===e?"readonly":"readwrite",Ma,s=>(r=new Ya(s,this.Le?this.Le.next():ns.T),"readwrite-primary"===e?this.sn(r).next(t=>!!t||this.rn(r)).next(e=>{if(!e)throw Br(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.Oe.enqueueRetryable(()=>this.Qe(!1)),new Qr(Hr.FAILED_PRECONDITION,qa);return n(r)}).next(t=>this.an(r).next(()=>t)):this.En(r).next(()=>n(r)))).then(t=>(r.raiseOnCommittedEvent(),t))}En(t){return Zc(t).get(Ia.key).next(t=>{if(null!==t&&this.ln(t.leaseTimestampMs,5e3)&&!this.wn(t.ownerId)&&!this.cn(t)&&!(this.Me||this.allowTabSynchronization&&t.allowTabSynchronization))throw new Qr(Hr.FAILED_PRECONDITION,Wc)})}an(t){const e=new Ia(this.clientId,this.allowTabSynchronization,Date.now());return Zc(t).put(Ia.key,e)}static bt(){return ja.bt()}on(t){const e=Zc(t);return e.get(Ia.key).next(t=>this.cn(t)?(Vr("IndexedDbPersistence","Releasing primary lease."),e.delete(Ia.key)):Va.resolve())}ln(t,e){const n=Date.now();return!(t<n-e||t>n&&(Br(`Detected an update time that is in the future: ${t} > ${n}`),1))}Ze(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.qe=()=>{this.Oe.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.Xe()))},this.document.addEventListener("visibilitychange",this.qe),this.inForeground="visible"===this.document.visibilityState)}mn(){this.qe&&(this.document.removeEventListener("visibilitychange",this.qe),this.qe=null)}tn(){var t;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Ue=()=>{this._n(),(0,D.G6)()&&navigator.appVersion.match("Version/14")&&this.Oe.enterRestrictedMode(!0),this.Oe.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Ue))}gn(){this.Ue&&(this.window.removeEventListener("pagehide",this.Ue),this.Ue=null)}wn(t){var e;try{const n=null!==(null===(e=this.Ye)||void 0===e?void 0:e.getItem(this.dn(t)));return Vr("IndexedDbPersistence",`Client '${t}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(t){return Br("IndexedDbPersistence","Failed to get zombied client id.",t),!1}}_n(){if(this.Ye)try{this.Ye.setItem(this.dn(this.clientId),String(Date.now()))}catch(t){Br("Failed to set zombie client id.",t)}}yn(){if(this.Ye)try{this.Ye.removeItem(this.dn(this.clientId))}catch(t){}}dn(t){return`firestore_zombie_${this.persistenceKey}_${t}`}}function Zc(t){return Za(t,Ia.store)}function Jc(t){return Za(t,Oa.store)}function Xc(t,e){let n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}class tu{constructor(t,e){this.progress=t,this.Tn=e}}class eu{constructor(t,e,n){this.He=t,this.In=e,this.Ht=n}An(t,e){return this.In.getAllMutationBatchesAffectingDocumentKey(t,e).next(n=>this.Rn(t,e,n))}Rn(t,e,n){return this.He.getEntry(t,e).next(t=>{for(const e of n)e.applyToLocalView(t);return t})}bn(t,e){t.forEach((t,n)=>{for(const r of e)r.applyToLocalView(n)})}Pn(t,e){return this.He.getEntries(t,e).next(e=>this.vn(t,e).next(()=>e))}vn(t,e){return this.In.getAllMutationBatchesAffectingDocumentKeys(t,e).next(t=>this.bn(e,t))}getDocumentsMatchingQuery(t,e,n){return function(t){return xs.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.Vn(t,e.path):bi(e)?this.Sn(t,e,n):this.Dn(t,e,n)}Vn(t,e){return this.An(t,new xs(e)).next(t=>{let e=Io();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e})}Sn(t,e,n){const r=e.collectionGroup;let s=Io();return this.Ht.getCollectionParents(t,r).next(i=>Va.forEach(i,i=>{const o=function(t,e){return new fi(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,i.child(r));return this.Dn(t,o,n).next(t=>{t.forEach((t,e)=>{s=s.insert(t,e)})})}).next(()=>s))}Dn(t,e,n){let r,s;return this.He.getDocumentsMatchingQuery(t,e,n).next(n=>(r=n,this.In.getAllMutationBatchesAffectingQuery(t,e))).next(e=>(s=e,this.Cn(t,s,r).next(t=>{r=t;for(const e of s)for(const t of e.mutations){const n=t.key;let s=r.get(n);null==s&&(s=Gs.newInvalidDocument(n),r=r.insert(n,s)),Zi(t,s,e.localWriteTime),s.isFoundDocument()||(r=r.remove(n))}}))).next(()=>(r.forEach((t,n)=>{Ai(e,n)||(r=r.remove(t))}),r))}Cn(t,e,n){let r=No();for(const i of e)for(const t of i.mutations)t instanceof no&&null===n.get(t.key)&&(r=r.add(t.key));let s=n;return this.He.getEntries(t,r).next(t=>(t.forEach((t,e)=>{e.isFoundDocument()&&(s=s.insert(t,e))}),s))}}class nu{constructor(t,e,n,r){this.targetId=t,this.fromCache=e,this.Nn=n,this.xn=r}static kn(t,e){let n=No(),r=No();for(const s of e.docChanges)switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}return new nu(t,e.fromCache,n,r)}}class ru{$n(t){this.On=t}getDocumentsMatchingQuery(t,e,n,r){return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}(e)||n.isEqual(us.min())?this.Fn(t,e):this.On.Pn(t,r).next(s=>{const i=this.Mn(e,s);return(pi(e)||yi(e))&&this.Ln(e.limitType,i,r,n)?this.Fn(t,e):(Ur()<=A.in.DEBUG&&Vr("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),Ni(e)),this.On.getDocumentsMatchingQuery(t,e,n).next(t=>(i.forEach(e=>{t=t.insert(e.key,e)}),t)))})}Mn(t,e){let n=new yo(Di(t));return e.forEach((e,r)=>{Ai(t,r)&&(n=n.add(r))}),n}Ln(t,e,n,r){if(n.size!==e.size)return!0;const s="F"===t?e.last():e.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(r)>0)}Fn(t,e){return Ur()<=A.in.DEBUG&&Vr("QueryEngine","Using full collection scan to execute query:",Ni(e)),this.On.getDocumentsMatchingQuery(t,e,us.min())}}class su{constructor(t,e,n,r){this.persistence=t,this.Bn=e,this.N=r,this.Un=new go(is),this.qn=new Vc(t=>Ws(t),Ys),this.Kn=us.min(),this.In=t.getMutationQueue(n),this.jn=t.getRemoteDocumentCache(),this.ze=t.getTargetCache(),this.Qn=new eu(this.jn,this.In,this.persistence.getIndexManager()),this.Je=t.getBundleCache(),this.Bn.$n(this.Qn)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.Un))}}function iu(t,e,n,r){return new su(t,e,n,r)}async function ou(t,e){const n=Gr(t);let r=n.In,s=n.Qn;const i=await n.persistence.runTransaction("Handle user change","readonly",t=>{let i;return n.In.getAllMutationBatches(t).next(o=>(i=o,r=n.persistence.getMutationQueue(e),s=new eu(n.jn,r,n.persistence.getIndexManager()),r.getAllMutationBatches(t))).next(e=>{const n=[],r=[];let o=No();for(const t of i){n.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){r.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return s.Pn(t,o).next(t=>({Wn:t,removedBatchIds:n,addedBatchIds:r}))})});return n.In=r,n.Qn=s,n.Bn.$n(n.Qn),i}function au(t){const e=Gr(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.ze.getLastRemoteSnapshotVersion(t))}function cu(t,e,n,r,s){let i=No();return n.forEach(t=>i=i.add(t)),e.getEntries(t,i).next(t=>{let i=bo();return n.forEach((n,o)=>{const a=t.get(n),c=(null==s?void 0:s.get(n))||r;o.isNoDocument()&&o.version.isEqual(us.min())?(e.removeEntry(n,c),i=i.insert(n,o)):!a.isValidDocument()||o.version.compareTo(a.version)>0||0===o.version.compareTo(a.version)&&a.hasPendingWrites?(e.addEntry(o,c),i=i.insert(n,o)):Vr("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",o.version)}),i})}function uu(t,e){const n=Gr(t);return n.persistence.runTransaction("Get next mutation batch","readonly",t=>(void 0===e&&(e=-1),n.In.getNextMutationBatchAfterBatchId(t,e)))}function hu(t,e){const n=Gr(t);return n.persistence.runTransaction("Allocate target","readwrite",t=>{let r;return n.ze.getTargetData(t,e).next(s=>s?(r=s,Va.resolve(r)):n.ze.allocateTargetId(t).next(s=>(r=new tc(e,s,0,t.currentSequenceNumber),n.ze.addTargetData(t,r).next(()=>r))))}).then(t=>{const r=n.Un.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Un=n.Un.insert(t.targetId,t),n.qn.set(e,t.targetId)),t})}async function lu(t,e,n){const r=Gr(t),s=r.Un.get(e),i=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",i,t=>r.persistence.referenceDelegate.removeTarget(t,s))}catch(t){if(!$a(t))throw t;Vr("LocalStore",`Failed to update sequence numbers for target ${e}: ${t}`)}r.Un=r.Un.remove(e),r.qn.delete(s.target)}function du(t,e,n){const r=Gr(t);let s=us.min(),i=No();return r.persistence.runTransaction("Execute query","readonly",t=>function(t,e,n){const r=Gr(t),s=r.qn.get(n);return void 0!==s?Va.resolve(r.Un.get(s)):r.ze.getTargetData(e,n)}(r,t,Ii(e)).next(e=>{if(e)return s=e.lastLimboFreeSnapshotVersion,r.ze.getMatchingKeysForTargetId(t,e.targetId).next(t=>{i=t})}).next(()=>r.Bn.getDocumentsMatchingQuery(t,e,n?s:us.min(),n?i:No())).next(t=>({documents:t,Gn:i})))}function fu(t,e){const n=Gr(t),r=Gr(n.ze),s=n.Un.get(e);return s?Promise.resolve(s.target):n.persistence.runTransaction("Get target data","readonly",t=>r.Et(t,e).next(t=>t?t.target:null))}function gu(t){const e=Gr(t);return e.persistence.runTransaction("Get new document changes","readonly",t=>function(t,e,n){const r=Gr(t);let s=bo(),i=sc(n);const o=$c(e),a=IDBKeyRange.lowerBound(i,!0);return o.Kt({index:Da.readTimeIndex,range:a},(t,e)=>{const n=nc(r.N,e);s=s.insert(n.key,n),i=e.readTime}).next(()=>({Tn:s,readTime:ic(i)}))}(e.jn,t,e.Kn)).then(({Tn:t,readTime:n})=>(e.Kn=n,t))}async function mu(t,e,n=No()){const r=await hu(t,Ii(lc(e.bundledQuery))),s=Gr(t);return s.persistence.runTransaction("Save named query","readwrite",t=>{const i=zo(e.readTime);if(r.snapshotVersion.compareTo(i)>=0)return s.Je.saveNamedQuery(t,e);const o=r.withResumeToken(ws.EMPTY_BYTE_STRING,i);return s.Un=s.Un.insert(o.targetId,o),s.ze.updateTargetData(t,o).next(()=>s.ze.removeMatchingKeysForTargetId(t,r.targetId)).next(()=>s.ze.addMatchingKeys(t,n,r.targetId)).next(()=>s.Je.saveNamedQuery(t,e))})}class pu{constructor(t){this.N=t,this.Yn=new Map,this.Xn=new Map}getBundleMetadata(t,e){return Va.resolve(this.Yn.get(e))}saveBundleMetadata(t,e){var n;return this.Yn.set(e.id,{id:(n=e).id,version:n.version,createTime:zo(n.createTime)}),Va.resolve()}getNamedQuery(t,e){return Va.resolve(this.Xn.get(e))}saveNamedQuery(t,e){return this.Xn.set(e.name,function(t){return{name:t.name,query:lc(t.bundledQuery),readTime:zo(t.readTime)}}(e)),Va.resolve()}}class yu{constructor(){this.Zn=new yo(wu.ts),this.es=new yo(wu.ns)}isEmpty(){return this.Zn.isEmpty()}addReference(t,e){const n=new wu(t,e);this.Zn=this.Zn.add(n),this.es=this.es.add(n)}ss(t,e){t.forEach(t=>this.addReference(t,e))}removeReference(t,e){this.rs(new wu(t,e))}os(t,e){t.forEach(t=>this.removeReference(t,e))}cs(t){const e=new xs(new gs([])),n=new wu(e,t),r=new wu(e,t+1),s=[];return this.es.forEachInRange([n,r],t=>{this.rs(t),s.push(t.key)}),s}us(){this.Zn.forEach(t=>this.rs(t))}rs(t){this.Zn=this.Zn.delete(t),this.es=this.es.delete(t)}hs(t){const e=new xs(new gs([])),n=new wu(e,t),r=new wu(e,t+1);let s=No();return this.es.forEachInRange([n,r],t=>{s=s.add(t.key)}),s}containsKey(t){const e=new wu(t,0),n=this.Zn.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class wu{constructor(t,e){this.key=t,this.ls=e}static ts(t,e){return xs.comparator(t.key,e.key)||is(t.ls,e.ls)}static ns(t,e){return is(t.ls,e.ls)||xs.comparator(t.key,e.key)}}class vu{constructor(t,e){this.Ht=t,this.referenceDelegate=e,this.In=[],this.fs=1,this.ds=new yo(wu.ts)}checkEmpty(t){return Va.resolve(0===this.In.length)}addMutationBatch(t,e,n,r){const s=this.fs;this.fs++;const i=new Ja(s,e,n,r);this.In.push(i);for(const o of r)this.ds=this.ds.add(new wu(o.key,s)),this.Ht.addToCollectionParentIndex(t,o.key.path.popLast());return Va.resolve(i)}lookupMutationBatch(t,e){return Va.resolve(this.ws(e))}getNextMutationBatchAfterBatchId(t,e){const n=this._s(e+1),r=n<0?0:n;return Va.resolve(this.In.length>r?this.In[r]:null)}getHighestUnacknowledgedBatchId(){return Va.resolve(0===this.In.length?-1:this.fs-1)}getAllMutationBatches(t){return Va.resolve(this.In.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new wu(e,0),r=new wu(e,Number.POSITIVE_INFINITY),s=[];return this.ds.forEachInRange([n,r],t=>{const e=this.ws(t.ls);s.push(e)}),Va.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new yo(is);return e.forEach(t=>{const e=new wu(t,0),r=new wu(t,Number.POSITIVE_INFINITY);this.ds.forEachInRange([e,r],t=>{n=n.add(t.ls)})}),Va.resolve(this.gs(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,r=n.length+1;let s=n;xs.isDocumentKey(s)||(s=s.child(""));const i=new wu(new xs(s),0);let o=new yo(is);return this.ds.forEachWhile(t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(o=o.add(t.ls)),!0)},i),Va.resolve(this.gs(o))}gs(t){const e=[];return t.forEach(t=>{const n=this.ws(t);null!==n&&e.push(n)}),e}removeMutationBatch(t,e){$r(0===this.ys(e.batchId,"removed")),this.In.shift();let n=this.ds;return Va.forEach(e.mutations,r=>{const s=new wu(r.key,e.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(t,r.key)}).next(()=>{this.ds=n})}te(t){}containsKey(t,e){const n=new wu(e,0),r=this.ds.firstAfterOrEqual(n);return Va.resolve(e.isEqual(r&&r.key))}performConsistencyCheck(t){return Va.resolve()}ys(t,e){return this._s(t)}_s(t){return 0===this.In.length?0:t-this.In[0].batchId}ws(t){const e=this._s(t);return e<0||e>=this.In.length?null:this.In[e]}}class bu{constructor(t,e){this.Ht=t,this.ps=e,this.docs=new go(xs.comparator),this.size=0}addEntry(t,e,n){const r=e.key,s=this.docs.get(r),i=s?s.size:0,o=this.ps(e);return this.docs=this.docs.insert(r,{document:e.clone(),size:o,readTime:n}),this.size+=o-i,this.Ht.addToCollectionParentIndex(t,r.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return Va.resolve(n?n.document.clone():Gs.newInvalidDocument(e))}getEntries(t,e){let n=bo();return e.forEach(t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.clone():Gs.newInvalidDocument(t))}),Va.resolve(n)}getDocumentsMatchingQuery(t,e,n){let r=bo();const s=new xs(e.path.child("")),i=this.docs.getIteratorFrom(s);for(;i.hasNext();){const{key:t,value:{document:s,readTime:o}}=i.getNext();if(!e.path.isPrefixOf(t.path))break;o.compareTo(n)<=0||Ai(e,s)&&(r=r.insert(s.key,s.clone()))}return Va.resolve(r)}Es(t,e){return Va.forEach(this.docs,t=>e(t))}newChangeBuffer(t){return new Tu(this)}getSize(t){return Va.resolve(this.size)}}class Tu extends Bc{constructor(t){super(),this.Se=t}applyChanges(t){const e=[];return this.changes.forEach((n,r)=>{r.document.isValidDocument()?e.push(this.Se.addEntry(t,r.document,this.getReadTime(n))):this.Se.removeEntry(n)}),Va.waitFor(e)}getFromCache(t,e){return this.Se.getEntry(t,e)}getAllFromCache(t,e){return this.Se.getEntries(t,e)}}class Iu{constructor(t){this.persistence=t,this.Ts=new Vc(t=>Ws(t),Ys),this.lastRemoteSnapshotVersion=us.min(),this.highestTargetId=0,this.Is=0,this.As=new yu,this.targetCount=0,this.Rs=Dc.se()}forEachTarget(t,e){return this.Ts.forEach((t,n)=>e(n)),Va.resolve()}getLastRemoteSnapshotVersion(t){return Va.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return Va.resolve(this.Is)}allocateTargetId(t){return this.highestTargetId=this.Rs.next(),Va.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Is&&(this.Is=e),Va.resolve()}ae(t){this.Ts.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.Rs=new Dc(e),this.highestTargetId=e),t.sequenceNumber>this.Is&&(this.Is=t.sequenceNumber)}addTargetData(t,e){return this.ae(e),this.targetCount+=1,Va.resolve()}updateTargetData(t,e){return this.ae(e),Va.resolve()}removeTargetData(t,e){return this.Ts.delete(e.target),this.As.cs(e.targetId),this.targetCount-=1,Va.resolve()}removeTargets(t,e,n){let r=0;const s=[];return this.Ts.forEach((i,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.Ts.delete(i),s.push(this.removeMatchingKeysForTargetId(t,o.targetId)),r++)}),Va.waitFor(s).next(()=>r)}getTargetCount(t){return Va.resolve(this.targetCount)}getTargetData(t,e){const n=this.Ts.get(e)||null;return Va.resolve(n)}addMatchingKeys(t,e,n){return this.As.ss(e,n),Va.resolve()}removeMatchingKeys(t,e,n){this.As.os(e,n);const r=this.persistence.referenceDelegate,s=[];return r&&e.forEach(e=>{s.push(r.markPotentiallyOrphaned(t,e))}),Va.waitFor(s)}removeMatchingKeysForTargetId(t,e){return this.As.cs(e),Va.resolve()}getMatchingKeysForTargetId(t,e){const n=this.As.hs(e);return Va.resolve(n)}containsKey(t,e){return Va.resolve(this.As.containsKey(e))}}class Eu{constructor(t,e){this.bs={},this.Le=new ns(0),this.Be=!1,this.Be=!0,this.referenceDelegate=t(this),this.ze=new Iu(this),this.Ht=new mc,this.He=function(t,e){return new bu(t,e)}(this.Ht,t=>this.referenceDelegate.Ps(t)),this.N=new ec(e),this.Je=new pu(this.N)}start(){return Promise.resolve()}shutdown(){return this.Be=!1,Promise.resolve()}get started(){return this.Be}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(){return this.Ht}getMutationQueue(t){let e=this.bs[t.toKey()];return e||(e=new vu(this.Ht,this.referenceDelegate),this.bs[t.toKey()]=e),e}getTargetCache(){return this.ze}getRemoteDocumentCache(){return this.He}getBundleCache(){return this.Je}runTransaction(t,e,n){Vr("MemoryPersistence","Starting transaction:",t);const r=new _u(this.Le.next());return this.referenceDelegate.vs(),n(r).next(t=>this.referenceDelegate.Vs(r).next(()=>t)).toPromise().then(t=>(r.raiseOnCommittedEvent(),t))}Ss(t,e){return Va.or(Object.values(this.bs).map(n=>()=>n.containsKey(t,e)))}}class _u extends Ua{constructor(t){super(),this.currentSequenceNumber=t}}class Su{constructor(t){this.persistence=t,this.Ds=new yu,this.Cs=null}static Ns(t){return new Su(t)}get xs(){if(this.Cs)return this.Cs;throw zr()}addReference(t,e,n){return this.Ds.addReference(n,e),this.xs.delete(n.toString()),Va.resolve()}removeReference(t,e,n){return this.Ds.removeReference(n,e),this.xs.add(n.toString()),Va.resolve()}markPotentiallyOrphaned(t,e){return this.xs.add(e.toString()),Va.resolve()}removeTarget(t,e){this.Ds.cs(e.targetId).forEach(t=>this.xs.add(t.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next(t=>{t.forEach(t=>this.xs.add(t.toString()))}).next(()=>n.removeTargetData(t,e))}vs(){this.Cs=new Set}Vs(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Va.forEach(this.xs,n=>{const r=xs.fromPath(n);return this.ks(t,r).next(t=>{t||e.removeEntry(r)})}).next(()=>(this.Cs=null,e.apply(t)))}updateLimboDocument(t,e){return this.ks(t,e).next(t=>{t?this.xs.delete(e.toString()):this.xs.add(e.toString())})}Ps(t){return 0}ks(t,e){return Va.or([()=>Va.resolve(this.Ds.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ss(t,e)])}}function Nu(t,e){return`firestore_clients_${t}_${e}`}function Au(t,e,n){let r=`firestore_mutations_${t}_${n}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function Du(t,e){return`firestore_targets_${t}_${e}`}class xu{constructor(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}static $s(t,e,n){const r=JSON.parse(n);let s,i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code,i&&(s=new Qr(r.error.code,r.error.message))),i?new xu(t,e,r.state,s):(Br("SharedClientState",`Failed to parse mutation state for ID '${e}': ${n}`),null)}Os(){const t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}}class Cu{constructor(t,e,n){this.targetId=t,this.state=e,this.error=n}static $s(t,e){const n=JSON.parse(e);let r,s="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return s&&n.error&&(s="string"==typeof n.error.message&&"string"==typeof n.error.code,s&&(r=new Qr(n.error.code,n.error.message))),s?new Cu(t,n.state,r):(Br("SharedClientState",`Failed to parse target state for ID '${t}': ${e}`),null)}Os(){const t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}}class ku{constructor(t,e){this.clientId=t,this.activeTargetIds=e}static $s(t,e){const n=JSON.parse(e);let r="object"==typeof n&&n.activeTargetIds instanceof Array,s=Do();for(let i=0;r&&i<n.activeTargetIds.length;++i)r=Ds(n.activeTargetIds[i]),s=s.add(n.activeTargetIds[i]);return r?new ku(t,s):(Br("SharedClientState",`Failed to parse client data for instance '${t}': ${e}`),null)}}class Lu{constructor(t,e){this.clientId=t,this.onlineState=e}static $s(t){const e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new Lu(e.clientId,e.onlineState):(Br("SharedClientState",`Failed to parse online state: ${t}`),null)}}class Ru{constructor(){this.activeTargetIds=Do()}Fs(t){this.activeTargetIds=this.activeTargetIds.add(t)}Ms(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Os(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class Ou{constructor(t,e,n,r,s){this.window=t,this.Oe=e,this.persistenceKey=n,this.Ls=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Bs=this.Us.bind(this),this.qs=new go(is),this.started=!1,this.Ks=[];const i=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.js=Nu(this.persistenceKey,this.Ls),this.Qs=function(t){return`firestore_sequence_number_${t}`}(this.persistenceKey),this.qs=this.qs.insert(this.Ls,new Ru),this.Ws=new RegExp(`^firestore_clients_${i}_([^_]*)$`),this.Gs=new RegExp(`^firestore_mutations_${i}_(\\d+)(?:_(.*))?$`),this.zs=new RegExp(`^firestore_targets_${i}_(\\d+)$`),this.Hs=function(t){return`firestore_online_state_${t}`}(this.persistenceKey),this.Js=function(t){return`firestore_bundle_loaded_${t}`}(this.persistenceKey),this.window.addEventListener("storage",this.Bs)}static bt(t){return!(!t||!t.localStorage)}async start(){const t=await this.syncEngine.pn();for(const n of t){if(n===this.Ls)continue;const t=this.getItem(Nu(this.persistenceKey,n));if(t){const e=ku.$s(n,t);e&&(this.qs=this.qs.insert(e.clientId,e))}}this.Ys();const e=this.storage.getItem(this.Hs);if(e){const t=this.Xs(e);t&&this.Zs(t)}for(const n of this.Ks)this.Us(n);this.Ks=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(t){this.setItem(this.Qs,JSON.stringify(t))}getAllActiveQueryTargets(){return this.ti(this.qs)}isActiveQueryTarget(t){let e=!1;return this.qs.forEach((n,r)=>{r.activeTargetIds.has(t)&&(e=!0)}),e}addPendingMutation(t){this.ei(t,"pending")}updateMutationState(t,e,n){this.ei(t,e,n),this.ni(t)}addLocalQueryTarget(t){let e="not-current";if(this.isActiveQueryTarget(t)){const n=this.storage.getItem(Du(this.persistenceKey,t));if(n){const r=Cu.$s(t,n);r&&(e=r.state)}}return this.si.Fs(t),this.Ys(),e}removeLocalQueryTarget(t){this.si.Ms(t),this.Ys()}isLocalQueryTarget(t){return this.si.activeTargetIds.has(t)}clearQueryState(t){this.removeItem(Du(this.persistenceKey,t))}updateQueryState(t,e,n){this.ii(t,e,n)}handleUserChange(t,e,n){e.forEach(t=>{this.ni(t)}),this.currentUser=t,n.forEach(t=>{this.addPendingMutation(t)})}setOnlineState(t){this.ri(t)}notifyBundleLoaded(){this.oi()}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Bs),this.removeItem(this.js),this.started=!1)}getItem(t){const e=this.storage.getItem(t);return Vr("SharedClientState","READ",t,e),e}setItem(t,e){Vr("SharedClientState","SET",t,e),this.storage.setItem(t,e)}removeItem(t){Vr("SharedClientState","REMOVE",t),this.storage.removeItem(t)}Us(t){const e=t;if(e.storageArea===this.storage){if(Vr("SharedClientState","EVENT",e.key,e.newValue),e.key===this.js)return void Br("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Oe.enqueueRetryable(async()=>{if(this.started){if(null!==e.key)if(this.Ws.test(e.key)){if(null==e.newValue){const t=this.ai(e.key);return this.ci(t,null)}{const t=this.ui(e.key,e.newValue);if(t)return this.ci(t.clientId,t)}}else if(this.Gs.test(e.key)){if(null!==e.newValue){const t=this.hi(e.key,e.newValue);if(t)return this.li(t)}}else if(this.zs.test(e.key)){if(null!==e.newValue){const t=this.fi(e.key,e.newValue);if(t)return this.di(t)}}else if(e.key===this.Hs){if(null!==e.newValue){const t=this.Xs(e.newValue);if(t)return this.Zs(t)}}else if(e.key===this.Qs){const t=function(t){let e=ns.T;if(null!=t)try{const n=JSON.parse(t);$r("number"==typeof n),e=n}catch(t){Br("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(e.newValue);t!==ns.T&&this.sequenceNumberHandler(t)}else if(e.key===this.Js)return this.syncEngine.wi()}else this.Ks.push(e)})}}get si(){return this.qs.get(this.Ls)}Ys(){this.setItem(this.js,this.si.Os())}ei(t,e,n){const r=new xu(this.currentUser,t,e,n),s=Au(this.persistenceKey,this.currentUser,t);this.setItem(s,r.Os())}ni(t){const e=Au(this.persistenceKey,this.currentUser,t);this.removeItem(e)}ri(t){this.storage.setItem(this.Hs,JSON.stringify({clientId:this.Ls,onlineState:t}))}ii(t,e,n){const r=Du(this.persistenceKey,t),s=new Cu(t,e,n);this.setItem(r,s.Os())}oi(){this.setItem(this.Js,"value-not-used")}ai(t){const e=this.Ws.exec(t);return e?e[1]:null}ui(t,e){const n=this.ai(t);return ku.$s(n,e)}hi(t,e){const n=this.Gs.exec(t),r=Number(n[1]);return xu.$s(new Fr(void 0!==n[2]?n[2]:null),r,e)}fi(t,e){const n=this.zs.exec(t),r=Number(n[1]);return Cu.$s(r,e)}Xs(t){return Lu.$s(t)}async li(t){if(t.user.uid===this.currentUser.uid)return this.syncEngine._i(t.batchId,t.state,t.error);Vr("SharedClientState",`Ignoring mutation for non-active user ${t.user.uid}`)}di(t){return this.syncEngine.mi(t.targetId,t.state,t.error)}ci(t,e){const n=e?this.qs.insert(t,e):this.qs.remove(t),r=this.ti(this.qs),s=this.ti(n),i=[],o=[];return s.forEach(t=>{r.has(t)||i.push(t)}),r.forEach(t=>{s.has(t)||o.push(t)}),this.syncEngine.gi(i,o).then(()=>{this.qs=n})}Zs(t){this.qs.get(t.clientId)&&this.onlineStateHandler(t.onlineState)}ti(t){let e=Do();return t.forEach((t,n)=>{e=e.unionWith(n.activeTargetIds)}),e}}class Pu{constructor(){this.yi=new Ru,this.pi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t){return this.yi.Fs(t),this.pi[t]||"not-current"}updateQueryState(t,e,n){this.pi[t]=e}removeLocalQueryTarget(t){this.yi.Ms(t)}isLocalQueryTarget(t){return this.yi.activeTargetIds.has(t)}clearQueryState(t){delete this.pi[t]}getAllActiveQueryTargets(){return this.yi.activeTargetIds}isActiveQueryTarget(t){return this.yi.activeTargetIds.has(t)}start(){return this.yi=new Ru,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(){}}class Fu{Ei(t){}shutdown(){}}class Mu{constructor(){this.Ti=()=>this.Ii(),this.Ai=()=>this.Ri(),this.bi=[],this.Pi()}Ei(t){this.bi.push(t)}shutdown(){window.removeEventListener("online",this.Ti),window.removeEventListener("offline",this.Ai)}Pi(){window.addEventListener("online",this.Ti),window.addEventListener("offline",this.Ai)}Ii(){Vr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.bi)t(0)}Ri(){Vr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.bi)t(1)}static bt(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const qu={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class Uu{constructor(t){this.vi=t.vi,this.Vi=t.Vi}Si(t){this.Di=t}Ci(t){this.Ni=t}onMessage(t){this.xi=t}close(){this.Vi()}send(t){this.vi(t)}ki(){this.Di()}$i(t){this.Ni(t)}Oi(t){this.xi(t)}}class Vu extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId,this.Fi=(t.ssl?"https":"http")+"://"+t.host,this.Mi="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}Li(t,e,n,r){const s=this.Bi(t,e);Vr("RestConnection","Sending: ",s,n);const i={};return this.Ui(i,r),this.qi(t,s,i,n).then(t=>(Vr("RestConnection","Received: ",t),t),e=>{throw jr("RestConnection",`${t} failed with error: `,e,"url: ",s,"request:",n),e})}Ki(t,e,n,r){return this.Li(t,e,n,r)}Ui(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/"+Mr,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e)for(const n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n])}Bi(t,e){return`${this.Fi}/v1/${e}:${qu[t]}`}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams}qi(t,e,n,r){return new Promise((s,i)=>{const o=new Pr;o.listenOnce(Cr.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case xr.NO_ERROR:const e=o.getResponseJson();Vr("Connection","XHR received:",JSON.stringify(e)),s(e);break;case xr.TIMEOUT:Vr("Connection",'RPC "'+t+'" timed out'),i(new Qr(Hr.DEADLINE_EXCEEDED,"Request time out"));break;case xr.HTTP_ERROR:const n=o.getStatus();if(Vr("Connection",'RPC "'+t+'" failed with status:',n,"response text:",o.getResponseText()),n>0){const t=o.getResponseJson().error;if(t&&t.status&&t.message){const e=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(Hr).indexOf(e)>=0?e:Hr.UNKNOWN}(t.status);i(new Qr(e,t.message))}else i(new Qr(Hr.UNKNOWN,"Server responded with status "+o.getStatus()))}else i(new Qr(Hr.UNAVAILABLE,"Connection failed."));break;default:zr()}}finally{Vr("Connection",'RPC "'+t+'" completed.')}});const a=JSON.stringify(r);o.send(e,"POST",a,n,15)})}ji(t,e){const n=[this.Fi,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=Ar(),s=Dr(),i={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(i.xmlHttpFactory=new Rr({})),this.Ui(i.initMessageHeaders,e),(0,D.uI)()||(0,D.b$)()||(0,D.d)()||(0,D.w1)()||(0,D.Mn)()||(0,D.ru)()||(i.httpHeadersOverwriteParam="$httpHeaders");const o=n.join("");Vr("Connection","Creating WebChannel: "+o,i);const a=r.createWebChannel(o,i);let c=!1,u=!1;const h=new Uu({vi:t=>{u?Vr("Connection","Not sending because WebChannel is closed:",t):(c||(Vr("Connection","Opening WebChannel transport."),a.open(),c=!0),Vr("Connection","WebChannel sending:",t),a.send(t))},Vi:()=>a.close()}),l=(t,e,n)=>{t.listen(e,t=>{try{n(t)}catch(t){setTimeout(()=>{throw t},0)}})};return l(a,Or.EventType.OPEN,()=>{u||Vr("Connection","WebChannel transport opened.")}),l(a,Or.EventType.CLOSE,()=>{u||(u=!0,Vr("Connection","WebChannel transport closed"),h.$i())}),l(a,Or.EventType.ERROR,t=>{u||(u=!0,jr("Connection","WebChannel transport errored:",t),h.$i(new Qr(Hr.UNAVAILABLE,"The operation could not be completed")))}),l(a,Or.EventType.MESSAGE,t=>{var e;if(!u){const n=t.data[0];$r(!!n);const r=n,s=r.error||(null===(e=r[0])||void 0===e?void 0:e.error);if(s){Vr("Connection","WebChannel received error:",s);const t=s.status;let e=function(t){const e=uo[t];if(void 0!==e)return fo(e)}(t),n=s.message;void 0===e&&(e=Hr.INTERNAL,n="Unknown error status: "+t+" with message "+s.message),u=!0,h.$i(new Qr(e,n)),a.close()}else Vr("Connection","WebChannel received:",n),h.Oi(n)}}),l(s,kr.STAT_EVENT,t=>{t.stat===Lr.PROXY?Vr("Connection","Detected buffering proxy"):t.stat===Lr.NOPROXY&&Vr("Connection","Detected no buffering proxy")}),setTimeout(()=>{h.ki()},0),h}}function Bu(){return"undefined"!=typeof window?window:null}function ju(){return"undefined"!=typeof document?document:null}function Ku(t){return new Vo(t,!0)}class zu{constructor(t,e,n=1e3,r=1.5,s=6e4){this.Oe=t,this.timerId=e,this.Qi=n,this.Wi=r,this.Gi=s,this.zi=0,this.Hi=null,this.Ji=Date.now(),this.reset()}reset(){this.zi=0}Yi(){this.zi=this.Gi}Xi(t){this.cancel();const e=Math.floor(this.zi+this.Zi()),n=Math.max(0,Date.now()-this.Ji),r=Math.max(0,e-n);r>0&&Vr("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.zi} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.Hi=this.Oe.enqueueAfterDelay(this.timerId,r,()=>(this.Ji=Date.now(),t())),this.zi*=this.Wi,this.zi<this.Qi&&(this.zi=this.Qi),this.zi>this.Gi&&(this.zi=this.Gi)}tr(){null!==this.Hi&&(this.Hi.skipDelay(),this.Hi=null)}cancel(){null!==this.Hi&&(this.Hi.cancel(),this.Hi=null)}Zi(){return(Math.random()-.5)*this.zi}}class $u{constructor(t,e,n,r,s,i){this.Oe=t,this.er=n,this.nr=r,this.credentialsProvider=s,this.listener=i,this.state=0,this.sr=0,this.ir=null,this.stream=null,this.rr=new zu(t,e)}ar(){return 1===this.state||2===this.state||4===this.state}cr(){return 2===this.state}start(){3!==this.state?this.auth():this.ur()}async stop(){this.ar()&&await this.close(0)}hr(){this.state=0,this.rr.reset()}lr(){this.cr()&&null===this.ir&&(this.ir=this.Oe.enqueueAfterDelay(this.er,6e4,()=>this.dr()))}wr(t){this._r(),this.stream.send(t)}async dr(){if(this.cr())return this.close(0)}_r(){this.ir&&(this.ir.cancel(),this.ir=null)}async close(t,e){this._r(),this.rr.cancel(),this.sr++,3!==t?this.rr.reset():e&&e.code===Hr.RESOURCE_EXHAUSTED?(Br(e.toString()),Br("Using maximum backoff delay to prevent overloading the backend."),this.rr.Yi()):e&&e.code===Hr.UNAUTHENTICATED&&this.credentialsProvider.invalidateToken(),null!==this.stream&&(this.mr(),this.stream.close(),this.stream=null),this.state=t,await this.listener.Ci(e)}mr(){}auth(){this.state=1;const t=this.gr(this.sr),e=this.sr;this.credentialsProvider.getToken().then(t=>{this.sr===e&&this.yr(t)},e=>{t(()=>{const t=new Qr(Hr.UNKNOWN,"Fetching auth token failed: "+e.message);return this.pr(t)})})}yr(t){const e=this.gr(this.sr);this.stream=this.Er(t),this.stream.Si(()=>{e(()=>(this.state=2,this.listener.Si()))}),this.stream.Ci(t=>{e(()=>this.pr(t))}),this.stream.onMessage(t=>{e(()=>this.onMessage(t))})}ur(){this.state=4,this.rr.Xi(async()=>{this.state=0,this.start()})}pr(t){return Vr("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(3,t)}gr(t){return e=>{this.Oe.enqueueAndForget(()=>this.sr===t?e():(Vr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Gu extends $u{constructor(t,e,n,r,s){super(t,"listen_stream_connection_backoff","listen_stream_idle",e,n,s),this.N=r}Er(t){return this.nr.ji("Listen",t)}onMessage(t){this.rr.reset();const e=function(t,e){let n;if("targetChange"in e){const r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:zr()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(t,e){return t.D?($r(void 0===e||"string"==typeof e),ws.fromBase64String(e||"")):($r(void 0===e||e instanceof Uint8Array),ws.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(t){const e=void 0===t.code?Hr.UNKNOWN:fo(t.code);return new Qr(e,t.message||"")}(o);n=new Ro(r,s,i,a||null)}else if("documentChange"in e){const r=e.documentChange,s=Qo(t,r.document.name),i=zo(r.document.updateTime),o=new zs({mapValue:{fields:r.document.fields}}),a=Gs.newFoundDocument(s,i,o);n=new ko(r.targetIds||[],r.removedTargetIds||[],a.key,a)}else if("documentDelete"in e){const r=e.documentDelete,s=Qo(t,r.document),i=r.readTime?zo(r.readTime):us.min(),o=Gs.newNoDocument(s,i);n=new ko([],r.removedTargetIds||[],o.key,o)}else if("documentRemove"in e){const r=e.documentRemove,s=Qo(t,r.document);n=new ko([],r.removedTargetIds||[],s,null)}else{if(!("filter"in e))return zr();{const t=e.filter,r=new co(t.count||0);n=new Lo(t.targetId,r)}}return n}(this.N,t),n=function(t){if(!("targetChange"in t))return us.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?us.min():e.readTime?zo(e.readTime):us.min()}(t);return this.listener.Tr(e,n)}Ir(t){const e={};e.database=Zo(this.N),e.addTarget=function(t,e){let n;const r=e.target;return n=Zs(r)?{documents:ra(t,r)}:{query:sa(t,r)},n.targetId=e.targetId,e.resumeToken.approximateByteSize()>0?n.resumeToken=jo(t,e.resumeToken):e.snapshotVersion.compareTo(us.min())>0&&(n.readTime=Bo(t,e.snapshotVersion.toTimestamp())),n}(this.N,t);const n=function(t,e){const n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return zr()}}(0,e.purpose);return null==n?null:{"goog-listen-tags":n}}(0,t);n&&(e.labels=n),this.wr(e)}Ar(t){const e={};e.database=Zo(this.N),e.removeTarget=t,this.wr(e)}}class Hu extends $u{constructor(t,e,n,r,s){super(t,"write_stream_connection_backoff","write_stream_idle",e,n,s),this.N=r,this.Rr=!1}get br(){return this.Rr}start(){this.Rr=!1,this.lastStreamToken=void 0,super.start()}mr(){this.Rr&&this.Pr([])}Er(t){return this.nr.ji("Write",t)}onMessage(t){if($r(!!t.streamToken),this.lastStreamToken=t.streamToken,this.Rr){this.rr.reset();const e=function(t,e){return t&&t.length>0?($r(void 0!==e),t.map(t=>function(t,e){let n=zo(t.updateTime?t.updateTime:e);return n.isEqual(us.min())&&(n=zo(e)),new Gi(n,t.transformResults||[])}(t,e))):[]}(t.writeResults,t.commitTime),n=zo(t.commitTime);return this.listener.vr(n,e)}return $r(!t.writeResults||0===t.writeResults.length),this.Rr=!0,this.listener.Vr()}Sr(){const t={};t.database=Zo(this.N),this.wr(t)}Pr(t){const e={streamToken:this.lastStreamToken,writes:t.map(t=>ea(this.N,t))};this.wr(e)}}class Qu extends class{}{constructor(t,e,n){super(),this.credentials=t,this.nr=e,this.N=n,this.Dr=!1}Cr(){if(this.Dr)throw new Qr(Hr.FAILED_PRECONDITION,"The client has already been terminated.")}Li(t,e,n){return this.Cr(),this.credentials.getToken().then(r=>this.nr.Li(t,e,n,r)).catch(t=>{throw"FirebaseError"===t.name?(t.code===Hr.UNAUTHENTICATED&&this.credentials.invalidateToken(),t):new Qr(Hr.UNKNOWN,t.toString())})}Ki(t,e,n){return this.Cr(),this.credentials.getToken().then(r=>this.nr.Ki(t,e,n,r)).catch(t=>{throw"FirebaseError"===t.name?(t.code===Hr.UNAUTHENTICATED&&this.credentials.invalidateToken(),t):new Qr(Hr.UNKNOWN,t.toString())})}terminate(){this.Dr=!0}}class Wu{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.Nr=0,this.kr=null,this.$r=!0}Or(){0===this.Nr&&(this.Fr("Unknown"),this.kr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.kr=null,this.Mr("Backend didn't respond within 10 seconds."),this.Fr("Offline"),Promise.resolve())))}Lr(t){"Online"===this.state?this.Fr("Unknown"):(this.Nr++,this.Nr>=1&&(this.Br(),this.Mr(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.Fr("Offline")))}set(t){this.Br(),this.Nr=0,"Online"===t&&(this.$r=!1),this.Fr(t)}Fr(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}Mr(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.$r?(Br(e),this.$r=!1):Vr("OnlineStateTracker",e)}Br(){null!==this.kr&&(this.kr.cancel(),this.kr=null)}}class Yu{constructor(t,e,n,r,s){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.Ur=[],this.qr=new Map,this.Kr=new Set,this.jr=[],this.Qr=s,this.Qr.Ei(t=>{n.enqueueAndForget(async()=>{ih(this)&&(Vr("RemoteStore","Restarting streams for network reachability change."),await async function(t){const e=Gr(t);e.Kr.add(4),await Ju(e),e.Wr.set("Unknown"),e.Kr.delete(4),await Zu(e)}(this))})}),this.Wr=new Wu(n,r)}}async function Zu(t){if(ih(t))for(const e of t.jr)await e(!0)}async function Ju(t){for(const e of t.jr)await e(!1)}function Xu(t,e){const n=Gr(t);n.qr.has(e.targetId)||(n.qr.set(e.targetId,e),sh(n)?rh(n):Ih(n).cr()&&eh(n,e))}function th(t,e){const n=Gr(t),r=Ih(n);n.qr.delete(e),r.cr()&&nh(n,e),0===n.qr.size&&(r.cr()?r.lr():ih(n)&&n.Wr.set("Unknown"))}function eh(t,e){t.Gr.Y(e.targetId),Ih(t).Ir(e)}function nh(t,e){t.Gr.Y(e),Ih(t).Ar(e)}function rh(t){t.Gr=new Po({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),Et:e=>t.qr.get(e)||null}),Ih(t).start(),t.Wr.Or()}function sh(t){return ih(t)&&!Ih(t).ar()&&t.qr.size>0}function ih(t){return 0===Gr(t).Kr.size}function oh(t){t.Gr=void 0}async function ah(t){t.qr.forEach((e,n)=>{eh(t,e)})}async function ch(t,e){oh(t),sh(t)?(t.Wr.Lr(e),rh(t)):t.Wr.set("Unknown")}async function uh(t,e,n){if(t.Wr.set("Online"),e instanceof Ro&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const r of e.targetIds)t.qr.has(r)&&(await t.remoteSyncer.rejectListen(r,n),t.qr.delete(r),t.Gr.removeTarget(r))}(t,e)}catch(n){Vr("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await hh(t,n)}else if(e instanceof ko?t.Gr.rt(e):e instanceof Lo?t.Gr.ft(e):t.Gr.ct(e),!n.isEqual(us.min()))try{const e=await au(t.localStore);n.compareTo(e)>=0&&await function(t,e){const n=t.Gr._t(e);return n.targetChanges.forEach((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const s=t.qr.get(r);s&&t.qr.set(r,s.withResumeToken(n.resumeToken,e))}}),n.targetMismatches.forEach(e=>{const n=t.qr.get(e);if(!n)return;t.qr.set(e,n.withResumeToken(ws.EMPTY_BYTE_STRING,n.snapshotVersion)),nh(t,e);const r=new tc(n.target,e,1,n.sequenceNumber);eh(t,r)}),t.remoteSyncer.applyRemoteEvent(n)}(t,n)}catch(e){Vr("RemoteStore","Failed to raise snapshot:",e),await hh(t,e)}}async function hh(t,e,n){if(!$a(e))throw e;t.Kr.add(1),await Ju(t),t.Wr.set("Offline"),n||(n=()=>au(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{Vr("RemoteStore","Retrying IndexedDB access"),await n(),t.Kr.delete(1),await Zu(t)})}function lh(t,e){return e().catch(n=>hh(t,n,e))}async function dh(t){const e=Gr(t),n=Eh(e);let r=e.Ur.length>0?e.Ur[e.Ur.length-1].batchId:-1;for(;fh(e);)try{const t=await uu(e.localStore,r);if(null===t){0===e.Ur.length&&n.lr();break}r=t.batchId,gh(e,t)}catch(t){await hh(e,t)}mh(e)&&ph(e)}function fh(t){return ih(t)&&t.Ur.length<10}function gh(t,e){t.Ur.push(e);const n=Eh(t);n.cr()&&n.br&&n.Pr(e.mutations)}function mh(t){return ih(t)&&!Eh(t).ar()&&t.Ur.length>0}function ph(t){Eh(t).start()}async function yh(t){Eh(t).Sr()}async function wh(t){const e=Eh(t);for(const n of t.Ur)e.Pr(n.mutations)}async function vh(t,e,n){const r=t.Ur.shift(),s=Xa.from(r,e,n);await lh(t,()=>t.remoteSyncer.applySuccessfulWrite(s)),await dh(t)}async function bh(t,e){e&&Eh(t).br&&await async function(t,e){if(lo(n=e.code)&&n!==Hr.ABORTED){const n=t.Ur.shift();Eh(t).hr(),await lh(t,()=>t.remoteSyncer.rejectFailedWrite(n.batchId,e)),await dh(t)}var n}(t,e),mh(t)&&ph(t)}async function Th(t,e){const n=Gr(t);e?(n.Kr.delete(2),await Zu(n)):e||(n.Kr.add(2),await Ju(n),n.Wr.set("Unknown"))}function Ih(t){return t.zr||(t.zr=function(t,e,n){const r=Gr(t);return r.Cr(),new Gu(e,r.nr,r.credentials,r.N,n)}(t.datastore,t.asyncQueue,{Si:ah.bind(null,t),Ci:ch.bind(null,t),Tr:uh.bind(null,t)}),t.jr.push(async e=>{e?(t.zr.hr(),sh(t)?rh(t):t.Wr.set("Unknown")):(await t.zr.stop(),oh(t))})),t.zr}function Eh(t){return t.Hr||(t.Hr=function(t,e,n){const r=Gr(t);return r.Cr(),new Hu(e,r.nr,r.credentials,r.N,n)}(t.datastore,t.asyncQueue,{Si:yh.bind(null,t),Ci:bh.bind(null,t),Vr:wh.bind(null,t),vr:vh.bind(null,t)}),t.jr.push(async e=>{e?(t.Hr.hr(),await dh(t)):(await t.Hr.stop(),t.Ur.length>0&&(Vr("RemoteStore",`Stopping write stream with ${t.Ur.length} pending writes`),t.Ur=[]))})),t.Hr}class _h{constructor(t,e,n,r,s){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=s,this.deferred=new Wr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(t=>{})}static createAndSchedule(t,e,n,r,s){const i=Date.now()+n,o=new _h(t,e,i,r,s);return o.start(n),o}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Qr(Hr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Sh(t,e){if(Br("AsyncQueue",`${e}: ${t}`),$a(t))return new Qr(Hr.UNAVAILABLE,`${e}: ${t}`);throw t}class Nh{constructor(t){this.comparator=t?(e,n)=>t(e,n)||xs.comparator(e.key,n.key):(t,e)=>xs.comparator(t.key,e.key),this.keyedMap=Io(),this.sortedSet=new go(this.comparator)}static emptySet(t){return new Nh(t.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((e,n)=>(t(e),!1))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof Nh))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(!t.isEqual(r))return!1}return!0}toString(){const t=[];return this.forEach(e=>{t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new Nh;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class Ah{constructor(){this.Jr=new go(xs.comparator)}track(t){const e=t.doc.key,n=this.Jr.get(e);n?0!==t.type&&3===n.type?this.Jr=this.Jr.insert(e,t):3===t.type&&1!==n.type?this.Jr=this.Jr.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Jr=this.Jr.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Jr=this.Jr.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Jr=this.Jr.remove(e):1===t.type&&2===n.type?this.Jr=this.Jr.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Jr=this.Jr.insert(e,{type:2,doc:t.doc}):zr():this.Jr=this.Jr.insert(e,t)}Yr(){const t=[];return this.Jr.inorderTraversal((e,n)=>{t.push(n)}),t}}class Dh{constructor(t,e,n,r,s,i,o,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=s,this.fromCache=i,this.syncStateChanged=o,this.excludesMetadataChanges=a}static fromInitialDocuments(t,e,n,r){const s=[];return e.forEach(t=>{s.push({type:0,doc:t})}),new Dh(t,e,Nh.emptySet(e),s,n,r,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&_i(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0}}class xh{constructor(){this.Xr=void 0,this.listeners=[]}}class Ch{constructor(){this.queries=new Vc(t=>Si(t),_i),this.onlineState="Unknown",this.Zr=new Set}}async function kh(t,e){const n=Gr(t),r=e.query;let s=!1,i=n.queries.get(r);if(i||(s=!0,i=new xh),s)try{i.Xr=await n.onListen(r)}catch(t){const n=Sh(t,`Initialization of query '${Ni(e.query)}' failed`);return void e.onError(n)}n.queries.set(r,i),i.listeners.push(e),e.eo(n.onlineState),i.Xr&&e.no(i.Xr)&&Ph(n)}async function Lh(t,e){const n=Gr(t),r=e.query;let s=!1;const i=n.queries.get(r);if(i){const t=i.listeners.indexOf(e);t>=0&&(i.listeners.splice(t,1),s=0===i.listeners.length)}if(s)return n.queries.delete(r),n.onUnlisten(r)}function Rh(t,e){const n=Gr(t);let r=!1;for(const s of e){const t=n.queries.get(s.query);if(t){for(const e of t.listeners)e.no(s)&&(r=!0);t.Xr=s}}r&&Ph(n)}function Oh(t,e,n){const r=Gr(t),s=r.queries.get(e);if(s)for(const i of s.listeners)i.onError(n);r.queries.delete(e)}function Ph(t){t.Zr.forEach(t=>{t.next()})}class Fh{constructor(t,e,n){this.query=t,this.so=e,this.io=!1,this.ro=null,this.onlineState="Unknown",this.options=n||{}}no(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new Dh(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}let e=!1;return this.io?this.oo(t)&&(this.so.next(t),e=!0):this.ao(t,this.onlineState)&&(this.co(t),e=!0),this.ro=t,e}onError(t){this.so.error(t)}eo(t){this.onlineState=t;let e=!1;return this.ro&&!this.io&&this.ao(this.ro,t)&&(this.co(this.ro),e=!0),e}ao(t,e){return!t.fromCache||!(this.options.uo&&"Offline"!==e||t.docs.isEmpty()&&"Offline"!==e)}oo(t){return t.docChanges.length>0||!!(t.syncStateChanged||this.ro&&this.ro.hasPendingWrites!==t.hasPendingWrites)&&!0===this.options.includeMetadataChanges}co(t){t=Dh.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.io=!0,this.so.next(t)}}class Mh{constructor(t,e){this.payload=t,this.byteLength=e}ho(){return"metadata"in this.payload}}class qh{constructor(t){this.N=t}zn(t){return Qo(this.N,t)}Hn(t){return t.metadata.exists?ta(this.N,t.document,!1):Gs.newNoDocument(this.zn(t.metadata.name),this.Jn(t.metadata.readTime))}Jn(t){return zo(t)}}class Uh{constructor(t,e,n){this.lo=t,this.localStore=e,this.N=n,this.queries=[],this.documents=[],this.progress=Vh(t)}fo(t){this.progress.bytesLoaded+=t.byteLength;let e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null}wo(t){const e=new Map,n=new qh(this.N);for(const r of t)if(r.metadata.queries){const t=n.zn(r.metadata.name);for(const n of r.metadata.queries){const r=(e.get(n)||No()).add(t);e.set(n,r)}}return e}async complete(){const t=await async function(t,e,n,r){const s=Gr(t);let i=No(),o=bo(),a=_o();for(const h of n){const t=e.zn(h.metadata.name);h.document&&(i=i.add(t)),o=o.insert(t,e.Hn(h)),a=a.insert(t,e.Jn(h.metadata.readTime))}const c=s.jn.newChangeBuffer({trackRemovals:!0}),u=await hu(s,function(t){return Ii(mi(gs.fromString(`__bundle__/docs/${t}`)))}(r));return s.persistence.runTransaction("Apply bundle documents","readwrite",t=>cu(t,c,o,us.min(),a).next(e=>(c.apply(t),e)).next(e=>s.ze.removeMatchingKeysForTargetId(t,u.targetId).next(()=>s.ze.addMatchingKeys(t,i,u.targetId)).next(()=>s.Qn.vn(t,e)).next(()=>e)))}(this.localStore,new qh(this.N),this.documents,this.lo.id),e=this.wo(this.documents);for(const n of this.queries)await mu(this.localStore,n,e.get(n.name));return this.progress.taskState="Success",new tu(Object.assign({},this.progress),t)}}function Vh(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}class Bh{constructor(t){this.key=t}}class jh{constructor(t){this.key=t}}class Kh{constructor(t,e){this.query=t,this._o=e,this.mo=null,this.current=!1,this.yo=No(),this.mutatedKeys=No(),this.po=Di(t),this.Eo=new Nh(this.po)}get To(){return this._o}Io(t,e){const n=e?e.Ao:new Ah,r=e?e.Eo:this.Eo;let s=e?e.mutatedKeys:this.mutatedKeys,i=r,o=!1;const a=pi(this.query)&&r.size===this.query.limit?r.last():null,c=yi(this.query)&&r.size===this.query.limit?r.first():null;if(t.inorderTraversal((t,e)=>{const u=r.get(t),h=Ai(this.query,e)?e:null,l=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations);let f=!1;u&&h?u.data.isEqual(h.data)?l!==d&&(n.track({type:3,doc:h}),f=!0):this.Ro(u,h)||(n.track({type:2,doc:h}),f=!0,(a&&this.po(h,a)>0||c&&this.po(h,c)<0)&&(o=!0)):!u&&h?(n.track({type:0,doc:h}),f=!0):u&&!h&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(h?(i=i.add(h),s=d?s.add(t):s.delete(t)):(i=i.delete(t),s=s.delete(t)))}),pi(this.query)||yi(this.query))for(;i.size>this.query.limit;){const t=pi(this.query)?i.last():i.first();i=i.delete(t.key),s=s.delete(t.key),n.track({type:1,doc:t})}return{Eo:i,Ao:n,Ln:o,mutatedKeys:s}}Ro(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n){const r=this.Eo;this.Eo=t.Eo,this.mutatedKeys=t.mutatedKeys;const s=t.Ao.Yr();s.sort((t,e)=>function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return zr()}};return n(t)-n(e)}(t.type,e.type)||this.po(t.doc,e.doc)),this.bo(n);const i=e?this.Po():[],o=0===this.yo.size&&this.current?1:0,a=o!==this.mo;return this.mo=o,0!==s.length||a?{snapshot:new Dh(this.query,t.Eo,r,s,t.mutatedKeys,0===o,a,!1),vo:i}:{vo:i}}eo(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({Eo:this.Eo,Ao:new Ah,mutatedKeys:this.mutatedKeys,Ln:!1},!1)):{vo:[]}}Vo(t){return!this._o.has(t)&&!!this.Eo.has(t)&&!this.Eo.get(t).hasLocalMutations}bo(t){t&&(t.addedDocuments.forEach(t=>this._o=this._o.add(t)),t.modifiedDocuments.forEach(t=>{}),t.removedDocuments.forEach(t=>this._o=this._o.delete(t)),this.current=t.current)}Po(){if(!this.current)return[];const t=this.yo;this.yo=No(),this.Eo.forEach(t=>{this.Vo(t.key)&&(this.yo=this.yo.add(t.key))});const e=[];return t.forEach(t=>{this.yo.has(t)||e.push(new jh(t))}),this.yo.forEach(n=>{t.has(n)||e.push(new Bh(n))}),e}So(t){this._o=t.Gn,this.yo=No();const e=this.Io(t.documents);return this.applyChanges(e,!0)}Do(){return Dh.fromInitialDocuments(this.query,this.Eo,this.mutatedKeys,0===this.mo)}}class zh{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class $h{constructor(t){this.key=t,this.Co=!1}}class Gh{constructor(t,e,n,r,s,i){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=i,this.No={},this.xo=new Vc(t=>Si(t),_i),this.ko=new Map,this.$o=new Set,this.Oo=new go(xs.comparator),this.Fo=new Map,this.Mo=new yu,this.Lo={},this.Bo=new Map,this.Uo=Dc.ie(),this.onlineState="Unknown",this.qo=void 0}get isPrimaryClient(){return!0===this.qo}}async function Hh(t,e){const n=vl(t);let r,s;const i=n.xo.get(e);if(i)r=i.targetId,n.sharedClientState.addLocalQueryTarget(r),s=i.view.Do();else{const t=await hu(n.localStore,Ii(e)),i=n.sharedClientState.addLocalQueryTarget(t.targetId);r=t.targetId,s=await Qh(n,e,r,"current"===i),n.isPrimaryClient&&Xu(n.remoteStore,t)}return s}async function Qh(t,e,n,r){t.Ko=(e,n,r)=>async function(t,e,n,r){let s=e.view.Io(n);s.Ln&&(s=await du(t.localStore,e.query,!1).then(({documents:t})=>e.view.Io(t,s)));const i=r&&r.targetChanges.get(e.targetId),o=e.view.applyChanges(s,t.isPrimaryClient,i);return il(t,e.targetId,o.vo),o.snapshot}(t,e,n,r);const s=await du(t.localStore,e,!0),i=new Kh(e,s.Gn),o=i.Io(s.documents),a=Co.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState),c=i.applyChanges(o,t.isPrimaryClient,a);il(t,n,c.vo);const u=new zh(e,n,i);return t.xo.set(e,u),t.ko.has(n)?t.ko.get(n).push(e):t.ko.set(n,[e]),c.snapshot}async function Wh(t,e){const n=Gr(t),r=n.xo.get(e),s=n.ko.get(r.targetId);if(s.length>1)return n.ko.set(r.targetId,s.filter(t=>!_i(t,e))),void n.xo.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await lu(n.localStore,r.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(r.targetId),th(n.remoteStore,r.targetId),rl(n,r.targetId)}).catch(Rc)):(rl(n,r.targetId),await lu(n.localStore,r.targetId,!0))}async function Yh(t,e){const n=Gr(t);try{const t=await function(t,e){const n=Gr(t),r=e.snapshotVersion;let s=n.Un;return n.persistence.runTransaction("Apply remote event","readwrite-primary",t=>{const i=n.jn.newChangeBuffer({trackRemovals:!0});s=n.Un;const o=[];e.targetChanges.forEach((e,i)=>{const a=s.get(i);if(!a)return;o.push(n.ze.removeMatchingKeys(t,e.removedDocuments,i).next(()=>n.ze.addMatchingKeys(t,e.addedDocuments,i)));const c=e.resumeToken;if(c.approximateByteSize()>0){const u=a.withResumeToken(c,r).withSequenceNumber(t.currentSequenceNumber);s=s.insert(i,u),function(t,e,n){return $r(e.resumeToken.approximateByteSize()>0),0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(a,u,e)&&o.push(n.ze.updateTargetData(t,u))}});let a=bo();if(e.documentUpdates.forEach((r,s)=>{e.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))}),o.push(cu(t,i,e.documentUpdates,r,void 0).next(t=>{a=t})),!r.isEqual(us.min())){const e=n.ze.getLastRemoteSnapshotVersion(t).next(e=>n.ze.setTargetsMetadata(t,t.currentSequenceNumber,r));o.push(e)}return Va.waitFor(o).next(()=>i.apply(t)).next(()=>n.Qn.vn(t,a)).next(()=>a)}).then(t=>(n.Un=s,t))}(n.localStore,e);e.targetChanges.forEach((t,e)=>{const r=n.Fo.get(e);r&&($r(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.Co=!0:t.modifiedDocuments.size>0?$r(r.Co):t.removedDocuments.size>0&&($r(r.Co),r.Co=!1))}),await cl(n,t,e)}catch(t){await Rc(t)}}function Zh(t,e,n){const r=Gr(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const t=[];r.xo.forEach((n,r)=>{const s=r.view.eo(e);s.snapshot&&t.push(s.snapshot)}),function(t,e){const n=Gr(t);n.onlineState=e;let r=!1;n.queries.forEach((t,n)=>{for(const s of n.listeners)s.eo(e)&&(r=!0)}),r&&Ph(n)}(r.eventManager,e),t.length&&r.No.Tr(t),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function Jh(t,e,n){const r=Gr(t);r.sharedClientState.updateQueryState(e,"rejected",n);const s=r.Fo.get(e),i=s&&s.key;if(i){let t=new go(xs.comparator);t=t.insert(i,Gs.newNoDocument(i,us.min()));const n=No().add(i),s=new xo(us.min(),new Map,new yo(is),t,n);await Yh(r,s),r.Oo=r.Oo.remove(i),r.Fo.delete(e),al(r)}else await lu(r.localStore,e,!1).then(()=>rl(r,e,n)).catch(Rc)}async function Xh(t,e){const n=Gr(t),r=e.batch.batchId;try{const t=await function(t,e){const n=Gr(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",t=>{const r=e.batch.keys(),s=n.jn.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){const s=n.batch,i=s.keys();let o=Va.resolve();return i.forEach(t=>{o=o.next(()=>r.getEntry(e,t)).next(e=>{const i=n.docVersions.get(t);$r(null!==i),e.version.compareTo(i)<0&&(s.applyToRemoteDocument(e,n),e.isValidDocument()&&r.addEntry(e,n.commitVersion))})}),o.next(()=>t.In.removeMutationBatch(e,s))}(n,t,e,s).next(()=>s.apply(t)).next(()=>n.In.performConsistencyCheck(t)).next(()=>n.Qn.Pn(t,r))})}(n.localStore,e);nl(n,r,null),el(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await cl(n,t)}catch(t){await Rc(t)}}async function tl(t,e,n){const r=Gr(t);try{const t=await function(t,e){const n=Gr(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",t=>{let r;return n.In.lookupMutationBatch(t,e).next(e=>($r(null!==e),r=e.keys(),n.In.removeMutationBatch(t,e))).next(()=>n.In.performConsistencyCheck(t)).next(()=>n.Qn.Pn(t,r))})}(r.localStore,e);nl(r,e,n),el(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await cl(r,t)}catch(n){await Rc(n)}}function el(t,e){(t.Bo.get(e)||[]).forEach(t=>{t.resolve()}),t.Bo.delete(e)}function nl(t,e,n){const r=Gr(t);let s=r.Lo[r.currentUser.toKey()];if(s){const t=s.get(e);t&&(n?t.reject(n):t.resolve(),s=s.remove(e)),r.Lo[r.currentUser.toKey()]=s}}function rl(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.ko.get(e))t.xo.delete(r),n&&t.No.jo(r,n);t.ko.delete(e),t.isPrimaryClient&&t.Mo.cs(e).forEach(e=>{t.Mo.containsKey(e)||sl(t,e)})}function sl(t,e){t.$o.delete(e.path.canonicalString());const n=t.Oo.get(e);null!==n&&(th(t.remoteStore,n),t.Oo=t.Oo.remove(e),t.Fo.delete(n),al(t))}function il(t,e,n){for(const r of n)r instanceof Bh?(t.Mo.addReference(r.key,e),ol(t,r)):r instanceof jh?(Vr("SyncEngine","Document no longer in limbo: "+r.key),t.Mo.removeReference(r.key,e),t.Mo.containsKey(r.key)||sl(t,r.key)):zr()}function ol(t,e){const n=e.key,r=n.path.canonicalString();t.Oo.get(n)||t.$o.has(r)||(Vr("SyncEngine","New document in limbo: "+n),t.$o.add(r),al(t))}function al(t){for(;t.$o.size>0&&t.Oo.size<t.maxConcurrentLimboResolutions;){const e=t.$o.values().next().value;t.$o.delete(e);const n=new xs(gs.fromString(e)),r=t.Uo.next();t.Fo.set(r,new $h(n)),t.Oo=t.Oo.insert(n,r),Xu(t.remoteStore,new tc(Ii(mi(n.path)),r,2,ns.T))}}async function cl(t,e,n){const r=Gr(t),s=[],i=[],o=[];r.xo.isEmpty()||(r.xo.forEach((t,a)=>{o.push(r.Ko(a,e,n).then(t=>{if(t){r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,t.fromCache?"not-current":"current"),s.push(t);const e=nu.kn(a.targetId,t);i.push(e)}}))}),await Promise.all(o),r.No.Tr(s),await async function(t,e){const n=Gr(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",t=>Va.forEach(e,e=>Va.forEach(e.Nn,r=>n.persistence.referenceDelegate.addReference(t,e.targetId,r)).next(()=>Va.forEach(e.xn,r=>n.persistence.referenceDelegate.removeReference(t,e.targetId,r)))))}catch(t){if(!$a(t))throw t;Vr("LocalStore","Failed to update sequence numbers: "+t)}for(const r of e){const t=r.targetId;if(!r.fromCache){const e=n.Un.get(t),r=e.withLastLimboFreeSnapshotVersion(e.snapshotVersion);n.Un=n.Un.insert(t,r)}}}(r.localStore,i))}async function ul(t,e){const n=Gr(t);if(!n.currentUser.isEqual(e)){Vr("SyncEngine","User change. New user:",e.toKey());const t=await ou(n.localStore,e);n.currentUser=e,function(t,e){t.Bo.forEach(t=>{t.forEach(t=>{t.reject(new Qr(Hr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),t.Bo.clear()}(n),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await cl(n,t.Wn)}}function hl(t,e){const n=Gr(t),r=n.Fo.get(e);if(r&&r.Co)return No().add(r.key);{let t=No();const r=n.ko.get(e);if(!r)return t;for(const e of r){const r=n.xo.get(e);t=t.unionWith(r.view.To)}return t}}async function ll(t,e){const n=Gr(t),r=await du(n.localStore,e.query,!0),s=e.view.So(r);return n.isPrimaryClient&&il(n,e.targetId,s.vo),s}async function dl(t){const e=Gr(t);return gu(e.localStore).then(t=>cl(e,t))}async function fl(t,e,n,r){const s=Gr(t),i=await function(t,e){const n=Gr(t),r=Gr(n.In);return n.persistence.runTransaction("Lookup mutation documents","readonly",t=>r.Xt(t,e).next(e=>e?n.Qn.Pn(t,e):Va.resolve(null)))}(s.localStore,e);null!==i?("pending"===n?await dh(s.remoteStore):"acknowledged"===n||"rejected"===n?(nl(s,e,r||null),el(s,e),function(t,e){Gr(Gr(t).In).te(e)}(s.localStore,e)):zr(),await cl(s,i)):Vr("SyncEngine","Cannot apply mutation batch with id: "+e)}async function gl(t,e,n){const r=Gr(t),s=[],i=[];for(const o of e){let t;const e=r.ko.get(o);if(e&&0!==e.length){t=await hu(r.localStore,Ii(e[0]));for(const t of e){const e=r.xo.get(t),n=await ll(r,e);n.snapshot&&i.push(n.snapshot)}}else{const e=await fu(r.localStore,o);t=await hu(r.localStore,e),await Qh(r,ml(e),o,!1)}s.push(t)}return r.No.Tr(i),s}function ml(t){return gi(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function pl(t){const e=Gr(t);return Gr(Gr(e.localStore).persistence).pn()}async function yl(t,e,n,r){const s=Gr(t);if(s.qo)Vr("SyncEngine","Ignoring unexpected query state notification.");else if(s.ko.has(e))switch(n){case"current":case"not-current":{const t=await gu(s.localStore),r=xo.createSynthesizedRemoteEventForCurrentChange(e,"current"===n);await cl(s,t,r);break}case"rejected":await lu(s.localStore,e,!0),rl(s,e,r);break;default:zr()}}async function wl(t,e,n){const r=vl(t);if(r.qo){for(const t of e){if(r.ko.has(t)){Vr("SyncEngine","Adding an already active target "+t);continue}const e=await fu(r.localStore,t),n=await hu(r.localStore,e);await Qh(r,ml(e),n.targetId,!1),Xu(r.remoteStore,n)}for(const t of n)r.ko.has(t)&&await lu(r.localStore,t,!1).then(()=>{th(r.remoteStore,t),rl(r,t)}).catch(Rc)}}function vl(t){const e=Gr(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Yh.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=hl.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Jh.bind(null,e),e.No.Tr=Rh.bind(null,e.eventManager),e.No.jo=Oh.bind(null,e.eventManager),e}function bl(t){const e=Gr(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Xh.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=tl.bind(null,e),e}class Tl{constructor(){this.synchronizeTabs=!1}async initialize(t){this.N=Ku(t.databaseInfo.databaseId),this.sharedClientState=this.Wo(t),this.persistence=this.Go(t),await this.persistence.start(),this.gcScheduler=this.zo(t),this.localStore=this.Ho(t)}zo(t){return null}Ho(t){return iu(this.persistence,new ru,t.initialUser,this.N)}Go(t){return new Eu(Su.Ns,this.N)}Wo(t){return new Pu}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class Il extends Tl{constructor(t,e,n){super(),this.Jo=t,this.cacheSizeBytes=e,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(t){await super.initialize(t),await async function(t){const e=Gr(t);return e.persistence.runTransaction("Synchronize last document change read time","readonly",t=>function(t){const e=$c(t);let n=us.min();return e.Kt({index:Da.readTimeIndex,reverse:!0},(t,e,r)=>{e.readTime&&(n=ic(e.readTime)),r.done()}).next(()=>n)}(t)).then(t=>{e.Kn=t})}(this.localStore),await this.Jo.initialize(this,t),await bl(this.Jo.syncEngine),await dh(this.Jo.remoteStore),await this.persistence.nn(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(this.localStore),Promise.resolve()))}Ho(t){return iu(this.persistence,new ru,t.initialUser,this.N)}zo(t){return new Fc(this.persistence.referenceDelegate.garbageCollector,t.asyncQueue)}Go(t){const e=Xc(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?bc.withCacheSize(this.cacheSizeBytes):bc.DEFAULT;return new Yc(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,Bu(),ju(),this.N,this.sharedClientState,!!this.forceOwnership)}Wo(t){return new Pu}}class El extends Il{constructor(t,e){super(t,e,!1),this.Jo=t,this.cacheSizeBytes=e,this.synchronizeTabs=!0}async initialize(t){await super.initialize(t);const e=this.Jo.syncEngine;this.sharedClientState instanceof Ou&&(this.sharedClientState.syncEngine={_i:fl.bind(null,e),mi:yl.bind(null,e),gi:wl.bind(null,e),pn:pl.bind(null,e),wi:dl.bind(null,e)},await this.sharedClientState.start()),await this.persistence.nn(async t=>{await async function(t,e){const n=Gr(t);if(vl(n),bl(n),!0===e&&!0!==n.qo){const t=n.sharedClientState.getAllActiveQueryTargets(),e=await gl(n,t.toArray());n.qo=!0,await Th(n.remoteStore,!0);for(const r of e)Xu(n.remoteStore,r)}else if(!1===e&&!1!==n.qo){const t=[];let e=Promise.resolve();n.ko.forEach((r,s)=>{n.sharedClientState.isLocalQueryTarget(s)?t.push(s):e=e.then(()=>(rl(n,s),lu(n.localStore,s,!0))),th(n.remoteStore,s)}),await e,await gl(n,t),function(t){const e=Gr(t);e.Fo.forEach((t,n)=>{th(e.remoteStore,n)}),e.Mo.us(),e.Fo=new Map,e.Oo=new go(xs.comparator)}(n),n.qo=!1,await Th(n.remoteStore,!1)}}(this.Jo.syncEngine,t),this.gcScheduler&&(t&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):t||this.gcScheduler.stop())})}Wo(t){const e=Bu();if(!Ou.bt(e))throw new Qr(Hr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=Xc(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new Ou(e,t.asyncQueue,n,t.clientId,t.initialUser)}}class _l{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>Zh(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=ul.bind(null,this.syncEngine),await Th(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new Ch}createDatastore(t){const e=Ku(t.databaseInfo.databaseId),n=new Vu(t.databaseInfo);return function(t,e,n){return new Qu(t,e,n)}(t.credentials,n,e)}createRemoteStore(t){return e=this.localStore,n=this.datastore,r=t.asyncQueue,s=t=>Zh(this.syncEngine,t,0),i=Mu.bt()?new Mu:new Fu,new Yu(e,n,r,s,i);var e,n,r,s,i}createSyncEngine(t,e){return function(t,e,n,r,s,i,o){const a=new Gh(t,e,n,r,s,i);return o&&(a.qo=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}terminate(){return async function(t){const e=Gr(t);Vr("RemoteStore","RemoteStore shutting down."),e.Kr.add(5),await Ju(e),e.Qr.shutdown(),e.Wr.set("Unknown")}(this.remoteStore)}}function Sl(t,e=10240){let n=0;return{async read(){if(n<t.byteLength){const r={value:t.slice(n,n+e),done:!1};return n+=e,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.reject("unimplemented")}}class Nl{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.Yo(this.observer.next,t)}error(t){this.observer.error?this.Yo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)}Xo(){this.muted=!0}Yo(t,e){this.muted||setTimeout(()=>{this.muted||t(e)},0)}}class Al{constructor(t,e){this.Zo=t,this.N=e,this.metadata=new Wr,this.buffer=new Uint8Array,this.ta=new TextDecoder("utf-8"),this.ea().then(t=>{t&&t.ho()?this.metadata.resolve(t.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==t?void 0:t.payload)}`))},t=>this.metadata.reject(t))}close(){return this.Zo.cancel()}async getMetadata(){return this.metadata.promise}async Qo(){return await this.getMetadata(),this.ea()}async ea(){const t=await this.na();if(null===t)return null;const e=this.ta.decode(t),n=Number(e);isNaN(n)&&this.sa(`length string (${e}) is not valid number`);const r=await this.ia(n);return new Mh(JSON.parse(r),t.length+n)}ra(){return this.buffer.findIndex(t=>t==="{".charCodeAt(0))}async na(){for(;this.ra()<0&&!(await this.oa()););if(0===this.buffer.length)return null;const t=this.ra();t<0&&this.sa("Reached the end of bundle when a length string is expected.");const e=this.buffer.slice(0,t);return this.buffer=this.buffer.slice(t),e}async ia(t){for(;this.buffer.length<t;)await this.oa()&&this.sa("Reached the end of bundle when more is expected.");const e=this.ta.decode(this.buffer.slice(0,t));return this.buffer=this.buffer.slice(t),e}sa(t){throw this.Zo.cancel(),new Error(`Invalid bundle format: ${t}`)}async oa(){const t=await this.Zo.read();if(!t.done){const e=new Uint8Array(this.buffer.length+t.value.length);e.set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e}return t.done}}class Dl{constructor(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(t){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new Qr(Hr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const e=await async function(t,e){const n=Gr(t),r=Zo(n.N)+"/documents",s={documents:e.map(t=>Ho(n.N,t))},i=await n.Ki("BatchGetDocuments",r,s),o=new Map;i.forEach(t=>{const e=function(t,e){return"found"in e?function(t,e){$r(!!e.found);const n=Qo(t,e.found.name),r=zo(e.found.updateTime),s=new zs({mapValue:{fields:e.found.fields}});return Gs.newFoundDocument(n,r,s)}(t,e):"missing"in e?function(t,e){$r(!!e.missing),$r(!!e.readTime);const n=Qo(t,e.missing),r=zo(e.readTime);return Gs.newNoDocument(n,r)}(t,e):zr()}(n.N,t);o.set(e.key.toString(),e)});const a=[];return e.forEach(t=>{const e=o.get(t.toString());$r(!!e),a.push(e)}),a}(this.datastore,t);return e.forEach(t=>this.recordVersion(t)),e}set(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())}update(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())}delete(t){this.write(new oo(t,this.precondition(t))),this.writtenDocs.add(t.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const t=this.readVersions;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((t,e)=>{const n=xs.fromPath(e);this.mutations.push(new ao(n,this.precondition(n)))}),await async function(t,e){const n=Gr(t),r=Zo(n.N)+"/documents",s={writes:e.map(t=>ea(n.N,t))};await n.Li("Commit",r,s)}(this.datastore,this.mutations),this.committed=!0}recordVersion(t){let e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw zr();e=us.min()}const n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new Qr(Hr.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)}precondition(t){const e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?Hi.updateTime(e):Hi.none()}preconditionForUpdate(t){const e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(us.min()))throw new Qr(Hr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Hi.updateTime(e)}return Hi.exists(!0)}write(t){this.ensureCommitNotCalled(),this.mutations.push(t)}ensureCommitNotCalled(){}}class xl{constructor(t,e,n,r){this.asyncQueue=t,this.datastore=e,this.updateFunction=n,this.deferred=r,this.aa=5,this.rr=new zu(this.asyncQueue,"transaction_retry")}run(){this.aa-=1,this.ca()}ca(){this.rr.Xi(async()=>{const t=new Dl(this.datastore),e=this.ua(t);e&&e.then(e=>{this.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{this.deferred.resolve(e)}).catch(t=>{this.ha(t)}))}).catch(t=>{this.ha(t)})})}ua(t){try{const e=this.updateFunction(t);return!Ns(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}ha(t){this.aa>0&&this.la(t)?(this.aa-=1,this.asyncQueue.enqueueAndForget(()=>(this.ca(),Promise.resolve()))):this.deferred.reject(t)}la(t){if("FirebaseError"===t.name){const e=t.code;return"aborted"===e||"failed-precondition"===e||!lo(e)}return!1}}class Cl{constructor(t,e,n){this.credentials=t,this.asyncQueue=e,this.databaseInfo=n,this.user=Fr.UNAUTHENTICATED,this.clientId=ss.I(),this.credentialListener=()=>Promise.resolve(),this.credentials.start(e,async t=>{Vr("FirestoreClient","Received user=",t.uid),await this.credentialListener(t),this.user=t})}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.credentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new Qr(Hr.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const t=new Wr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.credentials.shutdown(),t.resolve()}catch(e){const n=Sh(e,"Failed to shutdown persistence");t.reject(n)}}),t.promise}}async function kl(t,e){t.asyncQueue.verifyOperationInProgress(),Vr("FirestoreClient","Initializing OfflineComponentProvider");const n=await t.getConfiguration();await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener(async t=>{r.isEqual(t)||(await ou(e.localStore,t),r=t)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t.offlineComponents=e}async function Ll(t,e){t.asyncQueue.verifyOperationInProgress();const n=await Rl(t);Vr("FirestoreClient","Initializing OnlineComponentProvider");const r=await t.getConfiguration();await e.initialize(n,r),t.setCredentialChangeListener(t=>async function(t,e){const n=Gr(t);n.asyncQueue.verifyOperationInProgress(),Vr("RemoteStore","RemoteStore received new credentials");const r=ih(n);n.Kr.add(3),await Ju(n),r&&n.Wr.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.Kr.delete(3),await Zu(n)}(e.remoteStore,t)),t.onlineComponents=e}async function Rl(t){return t.offlineComponents||(Vr("FirestoreClient","Using default OfflineComponentProvider"),await kl(t,new Tl)),t.offlineComponents}async function Ol(t){return t.onlineComponents||(Vr("FirestoreClient","Using default OnlineComponentProvider"),await Ll(t,new _l)),t.onlineComponents}function Pl(t){return Rl(t).then(t=>t.persistence)}function Fl(t){return Rl(t).then(t=>t.localStore)}function Ml(t){return Ol(t).then(t=>t.remoteStore)}function ql(t){return Ol(t).then(t=>t.syncEngine)}async function Ul(t){const e=await Ol(t),n=e.eventManager;return n.onListen=Hh.bind(null,e.syncEngine),n.onUnlisten=Wh.bind(null,e.syncEngine),n}function Vl(t,e,n={}){const r=new Wr;return t.asyncQueue.enqueueAndForget(async()=>function(t,e,n,r,s){const i=new Nl({next:i=>{e.enqueueAndForget(()=>Lh(t,o));const a=i.docs.has(n);!a&&i.fromCache?s.reject(new Qr(Hr.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&i.fromCache&&r&&"server"===r.source?s.reject(new Qr(Hr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):s.resolve(i)},error:t=>s.reject(t)}),o=new Fh(mi(n.path),i,{includeMetadataChanges:!0,uo:!0});return kh(t,o)}(await Ul(t),t.asyncQueue,e,n,r)),r.promise}function Bl(t,e,n={}){const r=new Wr;return t.asyncQueue.enqueueAndForget(async()=>function(t,e,n,r,s){const i=new Nl({next:n=>{e.enqueueAndForget(()=>Lh(t,o)),n.fromCache&&"server"===r.source?s.reject(new Qr(Hr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):s.resolve(n)},error:t=>s.reject(t)}),o=new Fh(n,i,{includeMetadataChanges:!0,uo:!0});return kh(t,o)}(await Ul(t),t.asyncQueue,e,n,r)),r.promise}class jl{constructor(t,e,n,r,s,i,o,a){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=s,this.forceLongPolling=i,this.autoDetectLongPolling=o,this.useFetchStreams=a}}class Kl{constructor(t,e){this.projectId=t,this.database=e||"(default)"}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof Kl&&t.projectId===this.projectId&&t.database===this.database}}const zl=new Map;function $l(t,e,n){if(!n)throw new Qr(Hr.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function Gl(t,e,n,r){if(!0===e&&!0===r)throw new Qr(Hr.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function Hl(t){if(!xs.isDocumentKey(t))throw new Qr(Hr.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Ql(t){if(xs.isDocumentKey(t))throw new Qr(Hr.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function Wl(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":zr()}function Yl(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Qr(Hr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Wl(t);throw new Qr(Hr.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}function Zl(t,e){if(e<=0)throw new Qr(Hr.INVALID_ARGUMENT,`Function ${t}() requires a positive number, but it was: ${e}.`)}class Jl{constructor(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new Qr(Hr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Qr(Hr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,Gl("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class Xl{constructor(t,e){this._credentials=e,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Jl({}),this._settingsFrozen=!1,t instanceof Kl?this._databaseId=t:(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Qr(Hr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Kl(t.options.projectId)}(t))}get app(){if(!this._app)throw new Qr(Hr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new Qr(Hr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Jl(t),void 0!==t.credentials&&(this._credentials=function(t){if(!t)return new Zr;switch(t.type){case"gapi":const e=t.client;return $r(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new es(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new Qr(Hr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=zl.get(t);e&&(Vr("ComponentProvider","Removing Datastore"),zl.delete(t),e.terminate())}(this),Promise.resolve()}}class td{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new nd(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new td(this.firestore,t,this._key)}}class ed{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new ed(this.firestore,t,this._query)}}class nd extends ed{constructor(t,e,n){super(t,e,mi(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new td(this.firestore,null,new xs(t))}withConverter(t){return new nd(this.firestore,t,this._path)}}function rd(t,e,...n){if(t=(0,D.m9)(t),$l("collection","path",e),t instanceof Xl){const r=gs.fromString(e,...n);return Ql(r),new nd(t,null,r)}{if(!(t instanceof td||t instanceof nd))throw new Qr(Hr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(gs.fromString(e,...n));return Ql(r),new nd(t.firestore,null,r)}}function sd(t,e,...n){if(t=(0,D.m9)(t),1===arguments.length&&(e=ss.I()),$l("doc","path",e),t instanceof Xl){const r=gs.fromString(e,...n);return Hl(r),new td(t,null,new xs(r))}{if(!(t instanceof td||t instanceof nd))throw new Qr(Hr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(gs.fromString(e,...n));return Hl(r),new td(t.firestore,t instanceof nd?t.converter:null,new xs(r))}}function id(t,e){return t=(0,D.m9)(t),e=(0,D.m9)(e),(t instanceof td||t instanceof nd)&&(e instanceof td||e instanceof nd)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter}function od(t,e){return t=(0,D.m9)(t),e=(0,D.m9)(e),t instanceof ed&&e instanceof ed&&t.firestore===e.firestore&&_i(t._query,e._query)&&t.converter===e.converter}class ad{constructor(){this.fa=Promise.resolve(),this.da=[],this.wa=!1,this._a=[],this.ma=null,this.ga=!1,this.ya=!1,this.pa=[],this.rr=new zu(this,"async_queue_retry"),this.Ea=()=>{const t=ju();t&&Vr("AsyncQueue","Visibility state changed to "+t.visibilityState),this.rr.tr()};const t=ju();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Ea)}get isShuttingDown(){return this.wa}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.Ta(),this.Ia(t)}enterRestrictedMode(t){if(!this.wa){this.wa=!0,this.ya=t||!1;const e=ju();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.Ea)}}enqueue(t){if(this.Ta(),this.wa)return new Promise(()=>{});const e=new Wr;return this.Ia(()=>this.wa&&this.ya?Promise.resolve():(t().then(e.resolve,e.reject),e.promise)).then(()=>e.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.da.push(t),this.Aa()))}async Aa(){if(0!==this.da.length){try{await this.da[0](),this.da.shift(),this.rr.reset()}catch(t){if(!$a(t))throw t;Vr("AsyncQueue","Operation failed with retryable error: "+t)}this.da.length>0&&this.rr.Xi(()=>this.Aa())}}Ia(t){const e=this.fa.then(()=>(this.ga=!0,t().catch(t=>{throw this.ma=t,this.ga=!1,Br("INTERNAL UNHANDLED ERROR: ",function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t}).then(t=>(this.ga=!1,t))));return this.fa=e,e}enqueueAfterDelay(t,e,n){this.Ta(),this.pa.indexOf(t)>-1&&(e=0);const r=_h.createAndSchedule(this,t,e,n,t=>this.Ra(t));return this._a.push(r),r}Ta(){this.ma&&zr()}verifyOperationInProgress(){}async ba(){let t;do{t=this.fa,await t}while(t!==this.fa)}Pa(t){for(const e of this._a)if(e.timerId===t)return!0;return!1}va(t){return this.ba().then(()=>{this._a.sort((t,e)=>t.targetTimeMs-e.targetTimeMs);for(const e of this._a)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.ba()})}Va(t){this.pa.push(t)}Ra(t){const e=this._a.indexOf(t);this._a.splice(e,1)}}function cd(t){return function(t,e){if("object"!=typeof t||null===t)return!1;const n=t;for(const r of["next","error","complete"])if(r in n&&"function"==typeof n[r])return!0;return!1}(t)}class ud{constructor(){this._progressObserver={},this._taskCompletionResolver=new Wr,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(t,e,n){this._progressObserver={next:t,error:e,complete:n}}catch(t){return this._taskCompletionResolver.promise.catch(t)}then(t,e){return this._taskCompletionResolver.promise.then(t,e)}_completeWith(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)}_failWith(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)}_updateProgress(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}}class hd extends Xl{constructor(t,e){super(t,e),this.type="firestore",this._queue=new ad,this._persistenceKey="name"in t?t.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||dd(this),this._firestoreClient.terminate()}}function ld(t){return t._firestoreClient||dd(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function dd(t){var e;const n=t._freezeSettings(),r=function(t,e,n,r){return new jl(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,r.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,n);t._firestoreClient=new Cl(t._credentials,t._queue,r)}function fd(t,e,n){const r=new Wr;return t.asyncQueue.enqueue(async()=>{try{await kl(t,n),await Ll(t,e),r.resolve()}catch(t){if(!function(t){return"FirebaseError"===t.name?t.code===Hr.FAILED_PRECONDITION||t.code===Hr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(t))throw t;console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+t),r.reject(t)}}).then(()=>r.promise)}function gd(t){if(t._initialized||t._terminated)throw new Qr(Hr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class md{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new Qr(Hr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ps(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class pd{constructor(t){this._byteString=t}static fromBase64String(t){try{return new pd(ws.fromBase64String(t))}catch(t){throw new Qr(Hr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new pd(ws.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}class yd{constructor(t){this._methodName=t}}class wd{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new Qr(Hr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new Qr(Hr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return is(this._lat,t._lat)||is(this._long,t._long)}}const vd=/^__.*__$/;class bd{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return null!==this.fieldMask?new no(t,this.data,this.fieldMask,e,this.fieldTransforms):new eo(t,this.data,e,this.fieldTransforms)}}class Td{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return new no(t,this.data,this.fieldMask,e,this.fieldTransforms)}}function Id(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw zr()}}class Ed{constructor(t,e,n,r,s,i){this.settings=t,this.databaseId=e,this.N=n,this.ignoreUndefinedProperties=r,void 0===s&&this.Sa(),this.fieldTransforms=s||[],this.fieldMask=i||[]}get path(){return this.settings.path}get Da(){return this.settings.Da}Ca(t){return new Ed(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.N,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Na(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Ca({path:n,xa:!1});return r.ka(t),r}$a(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Ca({path:n,xa:!1});return r.Sa(),r}Oa(t){return this.Ca({path:void 0,xa:!0})}Fa(t){return Kd(t,this.settings.methodName,this.settings.Ma||!1,this.path,this.settings.La)}contains(t){return void 0!==this.fieldMask.find(e=>t.isPrefixOf(e))||void 0!==this.fieldTransforms.find(e=>t.isPrefixOf(e.field))}Sa(){if(this.path)for(let t=0;t<this.path.length;t++)this.ka(this.path.get(t))}ka(t){if(0===t.length)throw this.Fa("Document fields must not be empty");if(Id(this.Da)&&vd.test(t))throw this.Fa('Document fields cannot begin and end with "__"')}}class _d{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.N=n||Ku(t)}Ba(t,e,n,r=!1){return new Ed({Da:t,methodName:e,La:n,path:ps.emptyPath(),xa:!1,Ma:r},this.databaseId,this.N,this.ignoreUndefinedProperties)}}function Sd(t){const e=t._freezeSettings(),n=Ku(t._databaseId);return new _d(t._databaseId,!!e.ignoreUndefinedProperties,n)}function Nd(t,e,n,r,s,i={}){const o=t.Ba(i.merge||i.mergeFields?2:0,e,n,s);Ud("Data must be an object, but it was:",o,r);const a=Md(r,o);let c,u;if(i.merge)c=new ys(o.fieldMask),u=o.fieldTransforms;else if(i.mergeFields){const t=[];for(const r of i.mergeFields){const s=Vd(e,r,n);if(!o.contains(s))throw new Qr(Hr.INVALID_ARGUMENT,`Field '${s}' is specified in your field mask but missing from your input data.`);zd(t,s)||t.push(s)}c=new ys(t),u=o.fieldTransforms.filter(t=>c.covers(t.field))}else c=null,u=o.fieldTransforms;return new bd(new zs(a),c,u)}class Ad extends yd{_toFieldTransform(t){if(2!==t.Da)throw t.Fa(1===t.Da?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof Ad}}function Dd(t,e,n){return new Ed({Da:3,La:e.settings.La,methodName:t._methodName,xa:n},e.databaseId,e.N,e.ignoreUndefinedProperties)}class xd extends yd{_toFieldTransform(t){return new $i(t.path,new Mi)}isEqual(t){return t instanceof xd}}class Cd extends yd{constructor(t,e){super(t),this.Ua=e}_toFieldTransform(t){const e=Dd(this,t,!0),n=this.Ua.map(t=>Fd(t,e)),r=new qi(n);return new $i(t.path,r)}isEqual(t){return this===t}}class kd extends yd{constructor(t,e){super(t),this.Ua=e}_toFieldTransform(t){const e=Dd(this,t,!0),n=this.Ua.map(t=>Fd(t,e)),r=new Vi(n);return new $i(t.path,r)}isEqual(t){return this===t}}class Ld extends yd{constructor(t,e){super(t),this.qa=e}_toFieldTransform(t){const e=new ji(t.N,Li(t.N,this.qa));return new $i(t.path,e)}isEqual(t){return this===t}}function Rd(t,e,n,r){const s=t.Ba(1,e,n);Ud("Data must be an object, but it was:",s,r);const i=[],o=zs.empty();ls(r,(t,r)=>{const a=jd(e,t,n);r=(0,D.m9)(r);const c=s.$a(a);if(r instanceof Ad)i.push(a);else{const t=Fd(r,c);null!=t&&(i.push(a),o.set(a,t))}});const a=new ys(i);return new Td(o,a,s.fieldTransforms)}function Od(t,e,n,r,s,i){const o=t.Ba(1,e,n),a=[Vd(e,r,n)],c=[s];if(i.length%2!=0)throw new Qr(Hr.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let d=0;d<i.length;d+=2)a.push(Vd(e,i[d])),c.push(i[d+1]);const u=[],h=zs.empty();for(let d=a.length-1;d>=0;--d)if(!zd(u,a[d])){const t=a[d];let e=c[d];e=(0,D.m9)(e);const n=o.$a(t);if(e instanceof Ad)u.push(t);else{const r=Fd(e,n);null!=r&&(u.push(t),h.set(t,r))}}const l=new ys(u);return new Td(h,l,o.fieldTransforms)}function Pd(t,e,n,r=!1){return Fd(n,t.Ba(r?4:3,e))}function Fd(t,e){if(qd(t=(0,D.m9)(t)))return Ud("Unsupported field value:",e,t),Md(t,e);if(t instanceof yd)return function(t,e){if(!Id(e.Da))throw e.Fa(`${t._methodName}() can only be used with update() and set()`);if(!e.path)throw e.Fa(`${t._methodName}() is not currently supported inside arrays`);const n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.xa&&4!==e.Da)throw e.Fa("Nested arrays are not supported");return function(t,e){const n=[];let r=0;for(const s of t){let t=Fd(s,e.Oa(r));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=(0,D.m9)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Li(e.N,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=cs.fromDate(t);return{timestampValue:Bo(e.N,n)}}if(t instanceof cs){const n=new cs(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:Bo(e.N,n)}}if(t instanceof wd)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof pd)return{bytesValue:jo(e.N,t._byteString)};if(t instanceof td){const n=e.databaseId,r=t.firestore._databaseId;if(!r.isEqual(n))throw e.Fa(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:$o(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.Fa(`Unsupported field value: ${Wl(t)}`)}(t,e)}function Md(t,e){const n={};return ds(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):ls(t,(t,r)=>{const s=Fd(r,e.Na(t));null!=s&&(n[t]=s)}),{mapValue:{fields:n}}}function qd(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof cs||t instanceof wd||t instanceof pd||t instanceof td||t instanceof yd)}function Ud(t,e,n){if(!qd(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){const r=Wl(n);throw e.Fa("an object"===r?t+" a custom object":t+" "+r)}}function Vd(t,e,n){if((e=(0,D.m9)(e))instanceof md)return e._internalPath;if("string"==typeof e)return jd(t,e);throw Kd("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}const Bd=new RegExp("[~\\*/\\[\\]]");function jd(t,e,n){if(e.search(Bd)>=0)throw Kd(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new md(...e.split("."))._internalPath}catch(r){throw Kd(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Kd(t,e,n,r,s){const i=r&&!r.isEmpty(),o=void 0!==s;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(i||o)&&(c+=" (found",i&&(c+=` in field ${r}`),o&&(c+=` in document ${s}`),c+=")"),new Qr(Hr.INVALID_ARGUMENT,a+t+c)}function zd(t,e){return t.some(t=>t.isEqual(e))}class $d{constructor(t,e,n,r,s){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new td(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new Gd(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(Hd("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class Gd extends $d{data(){return super.data()}}function Hd(t,e){return"string"==typeof e?jd(t,e):e instanceof md?e._internalPath:e._delegate._internalPath}class Qd{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class Wd extends $d{constructor(t,e,n,r,s,i){super(t,e,n,r,i),this._firestore=t,this._firestoreImpl=t,this.metadata=s}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new Yd(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(Hd("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}}class Yd extends Wd{data(t={}){return super.data(t)}}class Zd{constructor(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new Qd(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,e){this._snapshot.docs.forEach(n=>{t.call(e,new Yd(this._firestore,this._userDataWriter,n.key,n,new Qd(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new Qr(Hr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){let e=0;return t._snapshot.docChanges.map(n=>({type:"added",doc:new Yd(t._firestore,t._userDataWriter,n.doc.key,n.doc,new Qd(t._snapshot.mutatedKeys.has(n.doc.key),t._snapshot.fromCache),t.query.converter),oldIndex:-1,newIndex:e++}))}{let n=t._snapshot.oldDocs;return t._snapshot.docChanges.filter(t=>e||3!==t.type).map(e=>{const r=new Yd(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Qd(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter);let s=-1,i=-1;return 0!==e.type&&(s=n.indexOf(e.doc.key),n=n.delete(e.doc.key)),1!==e.type&&(n=n.add(e.doc),i=n.indexOf(e.doc.key)),{type:Jd(e.type),doc:r,oldIndex:s,newIndex:i}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function Jd(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return zr()}}function Xd(t,e){return t instanceof Wd&&e instanceof Wd?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof Zd&&e instanceof Zd&&t._firestore===e._firestore&&od(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}function tf(t){if(yi(t)&&0===t.explicitOrderBy.length)throw new Qr(Hr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class ef{}function nf(t,...e){for(const n of e)t=n._apply(t);return t}class rf extends ef{constructor(t,e,n){super(),this.Ka=t,this.ja=e,this.Qa=n,this.type="where"}_apply(t){const e=Sd(t.firestore),n=function(t,e,n,r,s,i,o){let a;if(s.isKeyField()){if("array-contains"===i||"array-contains-any"===i)throw new Qr(Hr.INVALID_ARGUMENT,`Invalid Query. You can't perform '${i}' queries on FieldPath.documentId().`);if("in"===i||"not-in"===i){lf(o,i);const e=[];for(const n of o)e.push(hf(r,t,n));a={arrayValue:{values:e}}}else a=hf(r,t,o)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||lf(o,i),a=Pd(n,"where",o,"in"===i||"not-in"===i);const c=Js.create(s,i,a);return function(t,e){if(e.v()){const n=vi(t);if(null!==n&&!n.isEqual(e.field))throw new Qr(Hr.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${e.field.toString()}'`);const r=wi(t);null!==r&&df(0,e.field,r)}const n=function(t,e){for(const n of t.filters)if(e.indexOf(n.op)>=0)return n.op;return null}(t,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==n)throw new Qr(Hr.INVALID_ARGUMENT,n===e.op?`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`:`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}(t,c),c}(t._query,0,e,t.firestore._databaseId,this.Ka,this.ja,this.Qa);return new ed(t.firestore,t.converter,function(t,e){const n=t.filters.concat([e]);return new fi(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}(t._query,n))}}class sf extends ef{constructor(t,e){super(),this.Ka=t,this.Wa=e,this.type="orderBy"}_apply(t){const e=function(t,e,n){if(null!==t.startAt)throw new Qr(Hr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new Qr(Hr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const r=new ui(e,n);return function(t,e){if(null===wi(t)){const n=vi(t);null!==n&&df(0,n,e.field)}}(t,r),r}(t._query,this.Ka,this.Wa);return new ed(t.firestore,t.converter,function(t,e){const n=t.explicitOrderBy.concat([e]);return new fi(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))}}class of extends ef{constructor(t,e,n){super(),this.type=t,this.Ga=e,this.za=n}_apply(t){return new ed(t.firestore,t.converter,Ei(t._query,this.Ga,this.za))}}class af extends ef{constructor(t,e,n){super(),this.type=t,this.Ha=e,this.Ja=n}_apply(t){const e=uf(t,this.type,this.Ha,this.Ja);return new ed(t.firestore,t.converter,function(t,e){return new fi(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t._query,e))}}class cf extends ef{constructor(t,e,n){super(),this.type=t,this.Ha=e,this.Ja=n}_apply(t){const e=uf(t,this.type,this.Ha,this.Ja);return new ed(t.firestore,t.converter,function(t,e){return new fi(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t._query,e))}}function uf(t,e,n,r){if(n[0]=(0,D.m9)(n[0]),n[0]instanceof $d)return function(t,e,n,r,s){if(!r)throw new Qr(Hr.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const i=[];for(const o of Ti(t))if(o.field.isKeyField())i.push(Ms(e,r.key));else{const t=r.data.field(o.field);if(Es(t))throw new Qr(Hr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+o.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===t){const t=o.field.canonicalString();throw new Qr(Hr.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${t}' (used as the orderBy) does not exist.`)}i.push(t)}return new ai(i,s)}(t._query,t.firestore._databaseId,e,n[0]._document,r);{const s=Sd(t.firestore);return function(t,e,n,r,s,i){const o=t.explicitOrderBy;if(s.length>o.length)throw new Qr(Hr.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let c=0;c<s.length;c++){const i=s[c];if(o[c].field.isKeyField()){if("string"!=typeof i)throw new Qr(Hr.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof i}`);if(!bi(t)&&-1!==i.indexOf("/"))throw new Qr(Hr.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to ${r}() must be a plain document ID, but '${i}' contains a slash.`);const n=t.path.child(gs.fromString(i));if(!xs.isDocumentKey(n))throw new Qr(Hr.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const s=new xs(n);a.push(Ms(e,s))}else{const t=Pd(n,r,i);a.push(t)}}return new ai(a,i)}(t._query,t.firestore._databaseId,s,e,n,r)}}function hf(t,e,n){if("string"==typeof(n=(0,D.m9)(n))){if(""===n)throw new Qr(Hr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!bi(e)&&-1!==n.indexOf("/"))throw new Qr(Hr.INVALID_ARGUMENT,`Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(gs.fromString(n));if(!xs.isDocumentKey(r))throw new Qr(Hr.INVALID_ARGUMENT,`Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Ms(t,new xs(r))}if(n instanceof td)return Ms(t,n._key);throw new Qr(Hr.INVALID_ARGUMENT,`Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: ${Wl(n)}.`)}function lf(t,e){if(!Array.isArray(t)||0===t.length)throw new Qr(Hr.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`);if(t.length>10)throw new Qr(Hr.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters support a maximum of 10 elements in the value array.`)}function df(t,e,n){if(!n.isEqual(e))throw new Qr(Hr.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class ff{convertValue(t,e="none"){switch(Cs(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Ts(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Is(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw zr()}}convertObject(t,e){const n={};return ls(t.fields,(t,r)=>{n[t]=this.convertValue(r,e)}),n}convertGeoPoint(t){return new wd(Ts(t.latitude),Ts(t.longitude))}convertArray(t,e){return(t.values||[]).map(t=>this.convertValue(t,e))}convertServerTimestamp(t,e){switch(e){case"previous":const n=_s(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Ss(t));default:return null}}convertTimestamp(t){const e=bs(t);return new cs(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=gs.fromString(t);$r(pa(n));const r=new Kl(n.get(1),n.get(3)),s=new xs(n.popFirst(5));return r.isEqual(e)||Br(`Document ${s} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),s}}function gf(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}class mf extends ff{constructor(t){super(),this.firestore=t}convertBytes(t){return new pd(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new td(this.firestore,null,e)}}class pf{constructor(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=Sd(t)}set(t,e,n){this._verifyNotCommitted();const r=yf(t,this._firestore),s=gf(r.converter,e,n),i=Nd(this._dataReader,"WriteBatch.set",r._key,s,null!==r.converter,n);return this._mutations.push(i.toMutation(r._key,Hi.none())),this}update(t,e,n,...r){this._verifyNotCommitted();const s=yf(t,this._firestore);let i;return i="string"==typeof(e=(0,D.m9)(e))||e instanceof md?Od(this._dataReader,"WriteBatch.update",s._key,e,n,r):Rd(this._dataReader,"WriteBatch.update",s._key,e),this._mutations.push(i.toMutation(s._key,Hi.exists(!0))),this}delete(t){this._verifyNotCommitted();const e=yf(t,this._firestore);return this._mutations=this._mutations.concat(new oo(e._key,Hi.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Qr(Hr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function yf(t,e){if((t=(0,D.m9)(t)).firestore!==e)throw new Qr(Hr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}class wf extends ff{constructor(t){super(),this.firestore=t}convertBytes(t){return new pd(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new td(this.firestore,null,e)}}function vf(t,e,n){t=Yl(t,td);const r=Yl(t.firestore,hd),s=gf(t.converter,e,n);return If(r,[Nd(Sd(r),"setDoc",t._key,s,null!==t.converter,n).toMutation(t._key,Hi.none())])}function bf(t,e,n,...r){t=Yl(t,td);const s=Yl(t.firestore,hd),i=Sd(s);let o;return o="string"==typeof(e=(0,D.m9)(e))||e instanceof md?Od(i,"updateDoc",t._key,e,n,r):Rd(i,"updateDoc",t._key,e),If(s,[o.toMutation(t._key,Hi.exists(!0))])}function Tf(t,...e){var n,r,s;t=(0,D.m9)(t);let i={includeMetadataChanges:!1},o=0;"object"!=typeof e[o]||cd(e[o])||(i=e[o],o++);const a={includeMetadataChanges:i.includeMetadataChanges};if(cd(e[o])){const t=e[o];e[o]=null===(n=t.next)||void 0===n?void 0:n.bind(t),e[o+1]=null===(r=t.error)||void 0===r?void 0:r.bind(t),e[o+2]=null===(s=t.complete)||void 0===s?void 0:s.bind(t)}let c,u,h;if(t instanceof td)u=Yl(t.firestore,hd),h=mi(t._key.path),c={next:n=>{e[o]&&e[o](Ef(u,t,n))},error:e[o+1],complete:e[o+2]};else{const n=Yl(t,ed);u=Yl(n.firestore,hd),h=n._query;const r=new wf(u);c={next:t=>{e[o]&&e[o](new Zd(u,r,n,t))},error:e[o+1],complete:e[o+2]},tf(t._query)}return function(t,e,n,r){const s=new Nl(r),i=new Fh(e,s,n);return t.asyncQueue.enqueueAndForget(async()=>kh(await Ul(t),i)),()=>{s.Xo(),t.asyncQueue.enqueueAndForget(async()=>Lh(await Ul(t),i))}}(ld(u),h,a,c)}function If(t,e){return function(t,e){const n=new Wr;return t.asyncQueue.enqueueAndForget(async()=>async function(t,e,n){const r=bl(t);try{const t=await function(t,e){const n=Gr(t),r=cs.now(),s=e.reduce((t,e)=>t.add(e.key),No());let i;return n.persistence.runTransaction("Locally write mutations","readwrite",t=>n.Qn.Pn(t,s).next(s=>{i=s;const o=[];for(const t of e){const e=Ji(t,i.get(t.key));null!=e&&o.push(new no(t.key,e,$s(e.value.mapValue),Hi.exists(!0)))}return n.In.addMutationBatch(t,r,o,e)})).then(t=>(t.applyToLocalDocumentSet(i),{batchId:t.batchId,changes:i}))}(r.localStore,e);r.sharedClientState.addPendingMutation(t.batchId),function(t,e,n){let r=t.Lo[t.currentUser.toKey()];r||(r=new go(is)),r=r.insert(e,n),t.Lo[t.currentUser.toKey()]=r}(r,t.batchId,n),await cl(r,t.changes),await dh(r.remoteStore)}catch(t){const e=Sh(t,"Failed to persist write");n.reject(e)}}(await ql(t),e,n)),n.promise}(ld(t),e)}function Ef(t,e,n){const r=n.docs.get(e._key),s=new wf(t);return new Wd(t,s,e._key,r,new Qd(n.hasPendingWrites,n.fromCache),e.converter)}class _f extends class{constructor(t,e){this._firestore=t,this._transaction=e,this._dataReader=Sd(t)}get(t){const e=yf(t,this._firestore),n=new mf(this._firestore);return this._transaction.lookup([e._key]).then(t=>{if(!t||1!==t.length)return zr();const r=t[0];if(r.isFoundDocument())return new $d(this._firestore,n,r.key,r,e.converter);if(r.isNoDocument())return new $d(this._firestore,n,e._key,null,e.converter);throw zr()})}set(t,e,n){const r=yf(t,this._firestore),s=gf(r.converter,e,n),i=Nd(this._dataReader,"Transaction.set",r._key,s,null!==r.converter,n);return this._transaction.set(r._key,i),this}update(t,e,n,...r){const s=yf(t,this._firestore);let i;return i="string"==typeof(e=(0,D.m9)(e))||e instanceof md?Od(this._dataReader,"Transaction.update",s._key,e,n,r):Rd(this._dataReader,"Transaction.update",s._key,e),this._transaction.update(s._key,i),this}delete(t){const e=yf(t,this._firestore);return this._transaction.delete(e._key),this}}{constructor(t,e){super(t,e),this._firestore=t}get(t){const e=yf(t,this._firestore),n=new wf(this._firestore);return super.get(t).then(t=>new Wd(this._firestore,n,e._key,t._document,new Qd(!1,!1),e.converter))}}function Sf(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new Qr("invalid-argument",`Invalid options passed to function ${t}(): You cannot specify both "merge" and "mergeFields".`);return e}function Nf(){if("undefined"==typeof Uint8Array)throw new Qr("unimplemented","Uint8Arrays are not available in this environment.")}function Af(){if("undefined"==typeof atob)throw new Qr("unimplemented","Blobs are unavailable in Firestore in this environment.")}Mr=S.SDK_VERSION,(0,S._registerComponent)(new N.wA("firestore",(t,{options:e})=>{const n=t.getProvider("app").getImmediate(),r=new hd(n,new Xr(t.getProvider("auth-internal")));return e=Object.assign({useFetchStreams:!0},e),r._setSettings(e),r},"PUBLIC")),(0,S.registerVersion)("@firebase/firestore","3.1.0",void 0);class Df{constructor(t){this._delegate=t}static fromBase64String(t){return Af(),new Df(pd.fromBase64String(t))}static fromUint8Array(t){return Nf(),new Df(pd.fromUint8Array(t))}toBase64(){return Af(),this._delegate.toBase64()}toUint8Array(){return Nf(),this._delegate.toUint8Array()}isEqual(t){return this._delegate.isEqual(t._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function xf(t){return function(t,e){if("object"!=typeof t||null===t)return!1;const n=t;for(const r of["next","error","complete"])if(r in n&&"function"==typeof n[r])return!0;return!1}(t)}class Cf{enableIndexedDbPersistence(t,e){return function(t,e){gd(t=Yl(t,hd));const n=ld(t),r=t._freezeSettings(),s=new _l;return fd(n,s,new Il(s,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t._delegate,{forceOwnership:e})}enableMultiTabIndexedDbPersistence(t){return function(t){gd(t=Yl(t,hd));const e=ld(t),n=t._freezeSettings(),r=new _l;return fd(e,r,new El(r,n.cacheSizeBytes))}(t._delegate)}clearIndexedDbPersistence(t){return function(t){if(t._initialized&&!t._terminated)throw new Qr(Hr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new Wr;return t._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(t){if(!ja.bt())return Promise.resolve();const e=t+"main";await ja.delete(e)}(Xc(t._databaseId,t._persistenceKey)),e.resolve()}catch(t){e.reject(t)}}),e.promise}(t._delegate)}}class kf{constructor(t,e,n){this._delegate=e,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},t instanceof Kl||(this._appCompat=t)}get _databaseId(){return this._delegate._databaseId}settings(t){const e=this._delegate._getSettings();t.merge||e.host===t.host||jr("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),t.merge&&delete(t=Object.assign(Object.assign({},e),t)).merge,this._delegate._setSettings(t)}useEmulator(t,e,n={}){!function(t,e,n,r={}){var s;const i=(t=Yl(t,Xl))._getSettings();if("firestore.googleapis.com"!==i.host&&i.host!==e&&jr("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},i),{host:`${e}:${n}`,ssl:!1})),r.mockUserToken){let e,n;if("string"==typeof r.mockUserToken)e=r.mockUserToken,n=Fr.MOCK_USER;else{e=(0,D.Sg)(r.mockUserToken,null===(s=t._app)||void 0===s?void 0:s.options.projectId);const i=r.mockUserToken.sub||r.mockUserToken.user_id;if(!i)throw new Qr(Hr.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new Fr(i)}t._credentials=new Jr(new Yr(e,n))}}(this._delegate,t,e,n)}enableNetwork(){return function(t){return t.asyncQueue.enqueue(async()=>{const e=await Pl(t),n=await Ml(t);return e.setNetworkEnabled(!0),function(t){const e=Gr(t);return e.Kr.delete(0),Zu(e)}(n)})}(ld(Yl(this._delegate,hd)))}disableNetwork(){return function(t){return t.asyncQueue.enqueue(async()=>{const e=await Pl(t),n=await Ml(t);return e.setNetworkEnabled(!1),async function(t){const e=Gr(t);e.Kr.add(0),await Ju(e),e.Wr.set("Offline")}(n)})}(ld(Yl(this._delegate,hd)))}enablePersistence(t){let e=!1,n=!1;return t&&(e=!!t.synchronizeTabs,n=!!t.experimentalForceOwningTab,Gl("synchronizeTabs",e,"experimentalForceOwningTab",n)),e?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return function(t){const e=new Wr;return t.asyncQueue.enqueueAndForget(async()=>async function(t,e){const n=Gr(t);ih(n.remoteStore)||Vr("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const t=await function(t){const e=Gr(t);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",t=>e.In.getHighestUnacknowledgedBatchId(t))}(n.localStore);if(-1===t)return void e.resolve();const r=n.Bo.get(t)||[];r.push(e),n.Bo.set(t,r)}catch(t){const n=Sh(t,"Initialization of waitForPendingWrites() operation failed");e.reject(n)}}(await ql(t),e)),e.promise}(ld(Yl(this._delegate,hd)))}onSnapshotsInSync(t){return e=t,function(t,e){const n=new Nl(e);return t.asyncQueue.enqueueAndForget(async()=>function(t,e){Gr(t).Zr.add(e),e.next()}(await Ul(t),n)),()=>{n.Xo(),t.asyncQueue.enqueueAndForget(async()=>function(t,e){Gr(t).Zr.delete(e)}(await Ul(t),n))}}(ld(Yl(this._delegate,hd)),cd(e)?e:{next:e});var e}get app(){if(!this._appCompat)throw new Qr("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(t){try{return new $f(this,rd(this._delegate,t))}catch(e){throw Mf(e,"collection()","Firestore.collection()")}}doc(t){try{return new Ff(this,sd(this._delegate,t))}catch(e){throw Mf(e,"doc()","Firestore.doc()")}}collectionGroup(t){try{return new jf(this,function(t,e){if(t=Yl(t,Xl),$l("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new Qr(Hr.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new ed(t,null,function(t){return new fi(gs.emptyPath(),t)}(e))}(this._delegate,t))}catch(e){throw Mf(e,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(t){return n=e=>t(new Rf(this,e)),function(t,e){const n=new Wr;return t.asyncQueue.enqueueAndForget(async()=>{const r=await function(t){return Ol(t).then(t=>t.datastore)}(t);new xl(t.asyncQueue,r,e,n).run()}),n.promise}(ld(e=this._delegate),t=>n(new _f(e,t)));var e,n}batch(){return ld(this._delegate),new Of(new pf(this._delegate,t=>If(this._delegate,t)))}loadBundle(t){return function(t,e){const n=ld(t=Yl(t,hd)),r=new ud;return function(t,e,n,r){const s=function(t,e){let n;return n="string"==typeof t?(new TextEncoder).encode(t):t,function(t,e){return new Al(t,e)}(function(t,e){if(t instanceof Uint8Array)return Sl(t,e);if(t instanceof ArrayBuffer)return Sl(new Uint8Array(t),e);if(t instanceof ReadableStream)return t.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(n),e)}(n,Ku(e));t.asyncQueue.enqueueAndForget(async()=>{!function(t,e,n){const r=Gr(t);(async function(t,e,n){try{const r=await e.getMetadata();if(await function(t,e){const n=Gr(t),r=zo(e.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",t=>n.Je.getBundleMetadata(t,e.id)).then(t=>!!t&&t.createTime.compareTo(r)>=0)}(t.localStore,r))return await e.close(),void n._completeWith(function(t){return{taskState:"Success",documentsLoaded:t.totalDocuments,bytesLoaded:t.totalBytes,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}(r));n._updateProgress(Vh(r));const s=new Uh(r,t.localStore,e.N);let i=await e.Qo();for(;i;){const t=await s.fo(i);t&&n._updateProgress(t),i=await e.Qo()}const o=await s.complete();await cl(t,o.Tn,void 0),await function(t,e){const n=Gr(t);return n.persistence.runTransaction("Save bundle","readwrite",t=>n.Je.saveBundleMetadata(t,e))}(t.localStore,r),n._completeWith(o.progress)}catch(t){jr("SyncEngine",`Loading bundle failed with ${t}`),n._failWith(t)}})(r,e,n).then(()=>{r.sharedClientState.notifyBundleLoaded()})}(await ql(t),s,r)})}(n,t._databaseId,e,r),r}(this._delegate,t)}namedQuery(t){return(e=this._delegate,n=t,function(t,e){return t.asyncQueue.enqueue(async()=>function(t,e){const n=Gr(t);return n.persistence.runTransaction("Get named query","readonly",t=>n.Je.getNamedQuery(t,e))}(await Fl(t),e))}(ld(e=Yl(e,hd)),n).then(t=>t?new ed(e,null,t.query):null)).then(t=>t?new jf(this,t):null);var e,n}}class Lf extends ff{constructor(t){super(),this.firestore=t}convertBytes(t){return new Df(new pd(t))}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return Ff.forKey(e,this.firestore,null)}}class Rf{constructor(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new Lf(t)}get(t){const e=Gf(t);return this._delegate.get(e).then(t=>new Vf(this._firestore,new Wd(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,e.converter)))}set(t,e,n){const r=Gf(t);return n?(Sf("Transaction.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this}update(t,e,n,...r){const s=Gf(t);return 2===arguments.length?this._delegate.update(s,e):this._delegate.update(s,e,n,...r),this}delete(t){const e=Gf(t);return this._delegate.delete(e),this}}class Of{constructor(t){this._delegate=t}set(t,e,n){const r=Gf(t);return n?(Sf("WriteBatch.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this}update(t,e,n,...r){const s=Gf(t);return 2===arguments.length?this._delegate.update(s,e):this._delegate.update(s,e,n,...r),this}delete(t){const e=Gf(t);return this._delegate.delete(e),this}commit(){return this._delegate.commit()}}class Pf{constructor(t,e,n){this._firestore=t,this._userDataWriter=e,this._delegate=n}fromFirestore(t,e){const n=new Yd(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new Bf(this._firestore,n),null!=e?e:{})}toFirestore(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)}static getInstance(t,e){const n=Pf.INSTANCES;let r=n.get(t);r||(r=new WeakMap,n.set(t,r));let s=r.get(e);return s||(s=new Pf(t,new Lf(t),e),r.set(e,s)),s}}Pf.INSTANCES=new WeakMap;class Ff{constructor(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new Lf(t)}static forPath(t,e,n){if(t.length%2!=0)throw new Qr("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${t.canonicalString()} has ${t.length}`);return new Ff(e,new td(e._delegate,n,new xs(t)))}static forKey(t,e,n){return new Ff(e,new td(e._delegate,n,t))}get id(){return this._delegate.id}get parent(){return new $f(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(t){try{return new $f(this.firestore,rd(this._delegate,t))}catch(e){throw Mf(e,"collection()","DocumentReference.collection()")}}isEqual(t){return(t=(0,D.m9)(t))instanceof td&&id(this._delegate,t)}set(t,e){e=Sf("DocumentReference.set",e);try{return e?vf(this._delegate,t,e):vf(this._delegate,t)}catch(n){throw Mf(n,"setDoc()","DocumentReference.set()")}}update(t,e,...n){try{return 1===arguments.length?bf(this._delegate,t):bf(this._delegate,t,e,...n)}catch(r){throw Mf(r,"updateDoc()","DocumentReference.update()")}}delete(){return If(Yl((t=this._delegate).firestore,hd),[new oo(t._key,Hi.none())]);var t}onSnapshot(...t){const e=qf(t),n=Uf(t,t=>new Vf(this.firestore,new Wd(this.firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,this._delegate.converter)));return Tf(this._delegate,e,n)}get(t){let e;return e="cache"===(null==t?void 0:t.source)?function(t){t=Yl(t,td);const e=Yl(t.firestore,hd),n=ld(e),r=new wf(e);return function(t,e){const n=new Wr;return t.asyncQueue.enqueueAndForget(async()=>async function(t,e,n){try{const r=await function(t,e){const n=Gr(t);return n.persistence.runTransaction("read document","readonly",t=>n.Qn.An(t,e))}(t,e);r.isFoundDocument()?n.resolve(r):r.isNoDocument()?n.resolve(null):n.reject(new Qr(Hr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(t){const r=Sh(t,`Failed to get document '${e} from cache`);n.reject(r)}}(await Fl(t),e,n)),n.promise}(n,t._key).then(n=>new Wd(e,r,t._key,n,new Qd(null!==n&&n.hasLocalMutations,!0),t.converter))}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=Yl(t,td);const e=Yl(t.firestore,hd);return Vl(ld(e),t._key,{source:"server"}).then(n=>Ef(e,t,n))}(this._delegate):function(t){t=Yl(t,td);const e=Yl(t.firestore,hd);return Vl(ld(e),t._key).then(n=>Ef(e,t,n))}(this._delegate),e.then(t=>new Vf(this.firestore,new Wd(this.firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,this._delegate.converter)))}withConverter(t){return new Ff(this.firestore,this._delegate.withConverter(t?Pf.getInstance(this.firestore,t):null))}}function Mf(t,e,n){return t.message=t.message.replace(e,n),t}function qf(t){for(const e of t)if("object"==typeof e&&!xf(e))return e;return{}}function Uf(t,e){var n,r;let s;return s=xf(t[0])?t[0]:xf(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]},{next:t=>{s.next&&s.next(e(t))},error:null===(n=s.error)||void 0===n?void 0:n.bind(s),complete:null===(r=s.complete)||void 0===r?void 0:r.bind(s)}}class Vf{constructor(t,e){this._firestore=t,this._delegate=e}get ref(){return new Ff(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(t){return this._delegate.data(t)}get(t,e){return this._delegate.get(t,e)}isEqual(t){return Xd(this._delegate,t._delegate)}}class Bf extends Vf{data(t){const e=this._delegate.data(t);return void 0!==e||zr(),e}}class jf{constructor(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new Lf(t)}where(t,e,n){try{return new jf(this.firestore,nf(this._delegate,function(t,e,n){const r=e,s=Hd("where",t);return new rf(s,r,n)}(t,e,n)))}catch(r){throw Mf(r,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(t,e){try{return new jf(this.firestore,nf(this._delegate,function(t,e="asc"){const n=e,r=Hd("orderBy",t);return new sf(r,n)}(t,e)))}catch(n){throw Mf(n,/(orderBy|where)\(\)/,"Query.$1()")}}limit(t){try{return new jf(this.firestore,nf(this._delegate,(Zl("limit",e=t),new of("limit",e,"F"))))}catch(n){throw Mf(n,"limit()","Query.limit()")}var e}limitToLast(t){try{return new jf(this.firestore,nf(this._delegate,(Zl("limitToLast",e=t),new of("limitToLast",e,"L"))))}catch(n){throw Mf(n,"limitToLast()","Query.limitToLast()")}var e}startAt(...t){try{return new jf(this.firestore,nf(this._delegate,function(...t){return new af("startAt",t,!0)}(...t)))}catch(e){throw Mf(e,"startAt()","Query.startAt()")}}startAfter(...t){try{return new jf(this.firestore,nf(this._delegate,function(...t){return new af("startAfter",t,!1)}(...t)))}catch(e){throw Mf(e,"startAfter()","Query.startAfter()")}}endBefore(...t){try{return new jf(this.firestore,nf(this._delegate,function(...t){return new cf("endBefore",t,!0)}(...t)))}catch(e){throw Mf(e,"endBefore()","Query.endBefore()")}}endAt(...t){try{return new jf(this.firestore,nf(this._delegate,function(...t){return new cf("endAt",t,!1)}(...t)))}catch(e){throw Mf(e,"endAt()","Query.endAt()")}}isEqual(t){return od(this._delegate,t._delegate)}get(t){let e;return e="cache"===(null==t?void 0:t.source)?function(t){t=Yl(t,ed);const e=Yl(t.firestore,hd),n=ld(e),r=new wf(e);return function(t,e){const n=new Wr;return t.asyncQueue.enqueueAndForget(async()=>async function(t,e,n){try{const r=await du(t,e,!0),s=new Kh(e,r.Gn),i=s.Io(r.documents),o=s.applyChanges(i,!1);n.resolve(o.snapshot)}catch(t){const r=Sh(t,`Failed to execute query '${e} against cache`);n.reject(r)}}(await Fl(t),e,n)),n.promise}(n,t._query).then(n=>new Zd(e,r,t,n))}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=Yl(t,ed);const e=Yl(t.firestore,hd),n=ld(e),r=new wf(e);return Bl(n,t._query,{source:"server"}).then(n=>new Zd(e,r,t,n))}(this._delegate):function(t){t=Yl(t,ed);const e=Yl(t.firestore,hd),n=ld(e),r=new wf(e);return tf(t._query),Bl(n,t._query).then(n=>new Zd(e,r,t,n))}(this._delegate),e.then(t=>new zf(this.firestore,new Zd(this.firestore._delegate,this._userDataWriter,this._delegate,t._snapshot)))}onSnapshot(...t){const e=qf(t),n=Uf(t,t=>new zf(this.firestore,new Zd(this.firestore._delegate,this._userDataWriter,this._delegate,t._snapshot)));return Tf(this._delegate,e,n)}withConverter(t){return new jf(this.firestore,this._delegate.withConverter(t?Pf.getInstance(this.firestore,t):null))}}class Kf{constructor(t,e){this._firestore=t,this._delegate=e}get type(){return this._delegate.type}get doc(){return new Bf(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class zf{constructor(t,e){this._firestore=t,this._delegate=e}get query(){return new jf(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(t=>new Bf(this._firestore,t))}docChanges(t){return this._delegate.docChanges(t).map(t=>new Kf(this._firestore,t))}forEach(t,e){this._delegate.forEach(n=>{t.call(e,new Bf(this._firestore,n))})}isEqual(t){return Xd(this._delegate,t._delegate)}}class $f extends jf{constructor(t,e){super(t,e),this.firestore=t,this._delegate=e}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const t=this._delegate.parent;return t?new Ff(this.firestore,t):null}doc(t){try{return new Ff(this.firestore,void 0===t?sd(this._delegate):sd(this._delegate,t))}catch(e){throw Mf(e,"doc()","CollectionReference.doc()")}}add(t){return function(t,e){const n=Yl(t.firestore,hd),r=sd(t),s=gf(t.converter,e);return If(n,[Nd(Sd(t.firestore),"addDoc",r._key,s,null!==t.converter,{}).toMutation(r._key,Hi.exists(!1))]).then(()=>r)}(this._delegate,t).then(t=>new Ff(this.firestore,t))}isEqual(t){return id(this._delegate,t._delegate)}withConverter(t){return new $f(this.firestore,this._delegate.withConverter(t?Pf.getInstance(this.firestore,t):null))}}function Gf(t){return Yl(t,td)}class Hf{constructor(...t){this._delegate=new md(...t)}static documentId(){return new Hf(ps.keyField().canonicalString())}isEqual(t){return(t=(0,D.m9)(t))instanceof md&&this._delegate._internalPath.isEqual(t._internalPath)}}class Qf{constructor(t){this._delegate=t}static serverTimestamp(){const t=new xd("serverTimestamp");return t._methodName="FieldValue.serverTimestamp",new Qf(t)}static delete(){const t=new Ad("deleteField");return t._methodName="FieldValue.delete",new Qf(t)}static arrayUnion(...t){const e=function(...t){return new Cd("arrayUnion",t)}(...t);return e._methodName="FieldValue.arrayUnion",new Qf(e)}static arrayRemove(...t){const e=function(...t){return new kd("arrayRemove",t)}(...t);return e._methodName="FieldValue.arrayRemove",new Qf(e)}static increment(t){const e=new Ld("increment",t);return e._methodName="FieldValue.increment",new Qf(e)}isEqual(t){return this._delegate.isEqual(t._delegate)}}const Wf={Firestore:kf,GeoPoint:wd,Timestamp:cs,Blob:Df,Transaction:Rf,WriteBatch:Of,DocumentReference:Ff,DocumentSnapshot:Vf,Query:jf,QueryDocumentSnapshot:Bf,QuerySnapshot:zf,CollectionReference:$f,FieldPath:Hf,FieldValue:Qf,setLogLevel:function(t){qr.setLogLevel(t)},CACHE_SIZE_UNLIMITED:-1};var Yf;(Yf=_.Z).INTERNAL.registerComponent(new N.wA("firestore-compat",t=>{return e=t.getProvider("app-compat").getImmediate(),n=t.getProvider("firestore").getImmediate(),new kf(e,n,new Cf);var e,n},"PUBLIC").setServiceProps(Object.assign({},Wf))),Yf.registerVersion("@firebase/firestore-compat","0.1.3");var Zf=n(2965);function Jf(t,e){return function(t,e=c.z){return new u.y(n=>{let r;return null!=e?e.schedule(()=>{r=t.onSnapshot({includeMetadataChanges:!0},n)}):r=t.onSnapshot({includeMetadataChanges:!0},n),()=>{null!=r&&r()}})}(t,e)}function Xf(t,e){return Jf(t,e).pipe((0,w.U)(t=>({payload:t,type:"query"})))}function tg(t,e){return Xf(t,e).pipe((0,d.O)(void 0),g(),(0,w.U)(([t,e])=>{const n=e.payload.docChanges(),r=n.map(t=>({type:t.type,payload:t}));return t&&JSON.stringify(t.payload.metadata)!==JSON.stringify(e.payload.metadata)&&e.payload.docs.forEach((e,s)=>{const i=n.find(t=>t.doc.ref.isEqual(e.ref)),o=null==t?void 0:t.payload.docs.find(t=>t.ref.isEqual(e.ref));i&&JSON.stringify(i.doc.metadata)===JSON.stringify(e.metadata)||!i&&o&&JSON.stringify(o.metadata)===JSON.stringify(e.metadata)||r.push({type:"modified",payload:{oldIndex:s,newIndex:s,type:"modified",doc:e}})}),r}))}function eg(t,e,n){return tg(t,n).pipe((0,v.R)((t,n)=>function(t,e,n){return e.forEach(e=>{n.indexOf(e.type)>-1&&(t=function(t,e){switch(e.type){case"added":if(!t[e.newIndex]||!t[e.newIndex].doc.ref.isEqual(e.doc.ref))return ng(t,e.newIndex,0,e);break;case"modified":if(null==t[e.oldIndex]||t[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){const n=t.slice();return n.splice(e.oldIndex,1),n.splice(e.newIndex,0,e),n}return ng(t,e.newIndex,1,e)}break;case"removed":if(t[e.oldIndex]&&t[e.oldIndex].doc.ref.isEqual(e.doc.ref))return ng(t,e.oldIndex,1)}return t}(t,e))}),t}(t,n.map(t=>t.payload),e),[]),(0,b.x)(),(0,w.U)(t=>t.map(t=>({type:t.type,payload:t}))))}function ng(t,e,n,...r){const s=t.slice();return s.splice(e,n,...r),s}function rg(t){return t&&0!==t.length||(t=["added","removed","modified"]),t}n(7841);class sg{constructor(t,e,n){this.ref=t,this.query=e,this.afs=n}stateChanges(t){let e=tg(this.query,this.afs.schedulers.outsideAngular);return t&&t.length>0&&(e=e.pipe((0,w.U)(e=>e.filter(e=>t.indexOf(e.type)>-1)))),e.pipe((0,d.O)(void 0),g(),(0,T.h)(([t,e])=>e.length>0||!t),(0,w.U)(([t,e])=>e),l.iC)}auditTrail(t){return this.stateChanges(t).pipe((0,v.R)((t,e)=>[...t,...e],[]))}snapshotChanges(t){const e=rg(t);return eg(this.query,e,this.afs.schedulers.outsideAngular).pipe(l.iC)}valueChanges(t={}){return Xf(this.query,this.afs.schedulers.outsideAngular).pipe((0,w.U)(e=>e.payload.docs.map(e=>t.idField?Object.assign(Object.assign({},e.data()),{[t.idField]:e.id}):e.data())),l.iC)}get(t){return(0,h.D)(this.query.get(t)).pipe(l.iC)}add(t){return this.ref.add(t)}doc(t){return new ig(this.ref.doc(t),this.afs)}}class ig{constructor(t,e){this.ref=t,this.afs=e}set(t,e){return this.ref.set(t,e)}update(t){return this.ref.update(t)}delete(){return this.ref.delete()}collection(t,e){const n=this.ref.collection(t),{ref:r,query:s}=lg(n,e);return new sg(r,s,this.afs)}snapshotChanges(){return Jf(this.ref,this.afs.schedulers.outsideAngular).pipe((0,d.O)(void 0),g(),(0,w.U)(([t,e])=>e.exists?(null==t?void 0:t.exists)?{payload:e,type:"modified"}:{payload:e,type:"added"}:{payload:e,type:"removed"})).pipe(l.iC)}valueChanges(t={}){return this.snapshotChanges().pipe((0,w.U)(({payload:e})=>t.idField?Object.assign(Object.assign({},e.data()),{[t.idField]:e.id}):e.data()))}get(t){return(0,h.D)(this.ref.get(t)).pipe(l.iC)}}class og{constructor(t,e){this.query=t,this.afs=e}stateChanges(t){return t&&0!==t.length?tg(this.query,this.afs.schedulers.outsideAngular).pipe((0,w.U)(e=>e.filter(e=>t.indexOf(e.type)>-1)),(0,T.h)(t=>t.length>0),l.iC):tg(this.query,this.afs.schedulers.outsideAngular).pipe(l.iC)}auditTrail(t){return this.stateChanges(t).pipe((0,v.R)((t,e)=>[...t,...e],[]))}snapshotChanges(t){const e=rg(t);return eg(this.query,e,this.afs.schedulers.outsideAngular).pipe(l.iC)}valueChanges(t={}){return Xf(this.query,this.afs.schedulers.outsideAngular).pipe((0,w.U)(e=>e.payload.docs.map(e=>t.idField?Object.assign({[t.idField]:e.id},e.data()):e.data())),l.iC)}get(t){return(0,h.D)(this.query.get(t)).pipe(l.iC)}}const ag=new o.OlP("angularfire2.enableFirestorePersistence"),cg=new o.OlP("angularfire2.firestore.persistenceSettings"),ug=new o.OlP("angularfire2.firestore.settings"),hg=new o.OlP("angularfire2.firestore.use-emulator");function lg(t,e=(t=>t)){return{query:e(t),ref:t}}let dg=(()=>{class t{constructor(t,e,n,r,i,o,c,u,l,d,f,g,m,p,y,w,v){this.schedulers=c;const b=(0,I.on)(t,o,e),T=l;d&&(0,a.nw)(b,o,f,m,p,y,g,w),[this.firestore,this.persistenceEnabled$]=(0,I.cc)(`${b.name}.firestore`,"AngularFirestore",b.name,()=>{const t=o.runOutsideAngular(()=>b.firestore());if(r&&t.settings(r),T&&t.useEmulator(...T),n&&!(0,E.PM)(i)){const e=()=>{try{return(0,h.D)(t.enablePersistence(u||void 0).then(()=>!0,()=>!1))}catch(e){return"undefined"!=typeof console&&console.warn(e),(0,s.of)(!1)}};return[t,o.runOutsideAngular(e)]}return[t,(0,s.of)(!1)]},[r,T,n])}collection(t,e){let n;n="string"==typeof t?this.firestore.collection(t):t;const{ref:r,query:s}=lg(n,e),i=this.schedulers.ngZone.run(()=>r);return new sg(i,s,this)}collectionGroup(t,e){const n=e||(t=>t),r=this.firestore.collectionGroup(t);return new og(n(r),this)}doc(t){let e;e="string"==typeof t?this.firestore.doc(t):t;const n=this.schedulers.ngZone.run(()=>e);return new ig(n,this)}createId(){return this.firestore.collection("_").doc().id}}return t.\u0275fac=function(e){return new(e||t)(o.LFG(I.Dh),o.LFG(I.xv,8),o.LFG(ag,8),o.LFG(ug,8),o.LFG(o.Lbi),o.LFG(o.R0b),o.LFG(l.HU),o.LFG(cg,8),o.LFG(hg,8),o.LFG(a.zQ,8),o.LFG(a.Qv,8),o.LFG(a.L6,8),o.LFG(a._Q,8),o.LFG(a.rT,8),o.LFG(a.lh,8),o.LFG(a.f7,8),o.LFG(Zf.nm,8))},t.\u0275prov=o.Yz7({token:t,factory:t.\u0275fac,providedIn:"any"}),t})(),fg=(()=>{class t{constructor(t,e){this.afAuth=t,this.afs=e,this.bandera=0,this.logueado=!1,this.user$=this.afAuth.authState.pipe((0,i.w)(t=>t?this.afs.doc(`users/${t.uid}`).valueChanges():(0,s.of)(null)))}getBandera(){return this.bandera}logout(){return(0,r.mG)(this,void 0,void 0,function*(){try{this.bandera=0,this.logueado=!1,yield this.afAuth.signOut()}catch(t){console.log("Error: ",t)}})}getEstatusLogin(){return this.logueado}login(t,e){return(0,r.mG)(this,void 0,void 0,function*(){try{const{user:n}=yield this.afAuth.signInWithEmailAndPassword(t,e);return this.updateUserData(n),this.bandera=1,this.logueado=!0,n}catch(n){console.log("Error: ",n)}})}register(t,e){return(0,r.mG)(this,void 0,void 0,function*(){try{const{user:n}=yield this.afAuth.createUserWithEmailAndPassword(t,e);return yield this.sendVerificationEmail(),n}catch(n){console.log("Error->",n)}})}resetPassword(t){return(0,r.mG)(this,void 0,void 0,function*(){try{return this.afAuth.sendPasswordResetEmail(t)}catch(e){console.log("Error->",e)}})}sendVerificationEmail(){return(0,r.mG)(this,void 0,void 0,function*(){try{return(yield this.afAuth.currentUser).sendEmailVerification()}catch(t){console.log("Error: ",t)}})}isEmailVerified(t){return!0===t.emailVerified}updateUserData(t){return this.afs.doc(`users/${t.uid}`).set({uid:t.uid,email:t.email,emailVerified:t.emailVerified,displayName:t.displayName},{merge:!0})}}return t.\u0275fac=function(e){return new(e||t)(o.LFG(a.zQ),o.LFG(dg))},t.\u0275prov=o.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},910:(t,e,n)=>{"use strict";n.d(e,{N:()=>s});var r=n(3018);let s=(()=>{class t{constructor(){this.hardcode=[{id:1,name:"Blusa rosa",image:"../assets/blusa_rosa.jpg",url:"",description:"Cherokee",size:"9",price:"199"},{id:2,name:"Short",image:"../assets/short.jpg",url:"",description:"LEVIS",size:"M",price:"259"},{id:3,name:"Zapatillas",image:"../assets/zapatillas.png",url:"",description:"Flexi",size:"24",price:"239"},{id:4,name:"Lentes",image:"../assets/lentes.png",url:"",description:"Panama",size:"Unitalla",price:"299"},{id:5,name:"Camisa cuadros",image:"../assets/camisa.jpg",url:"",description:"Marca Bazzar",size:"32",price:"349"},{id:6,name:"Playera",image:"../assets/playera.jpg",url:"",description:"Marvel",size:"L",price:"489"},{id:7,name:"Saco",image:"../assets/saco.jpg",url:"",description:"T&H",size:"M",price:"1039"},{id:8,name:"Cintur\xf3n",image:"../assets/cinturon.jpg",url:"",description:"Buffway",size:"38",price:"199"},{id:9,name:"Calcetas",image:"../assets/calceta.jpg",url:"",description:"Grafito",size:"Recien nacido",price:"59"},{id:10,name:"Mameluco",image:"../assets/mameluco.jpg",url:"",description:"Little me",size:"3 meses",price:"399"},{id:11,name:"Pa\xf1alero",image:"../assets/panalero.jpg",url:"",description:"Bam-Bu",size:"6 meses",price:"119"},{id:12,name:"Mo\xf1o",image:"../assets/mono.jpg",url:"",description:"KidsLuxury",size:"Unitalla",price:"99"},{id:13,name:"Aretes Esfera",image:"../assets/arete.jpg",url:"",description:"Fraiche",size:"Unitalla",price:"117"},{id:14,name:"Collar perlas",image:"../assets/collar.jpg",url:"",description:"Eva",size:"Unitalla",price:"449"},{id:15,name:"Reloj",image:"../assets/reloj.jpg",url:"",description:"CURREN",size:"Unitalla",price:"739"},{id:16,name:"Anillo",image:"../assets/anillo.jpg",url:"",description:"Her",size:"CH",price:"79"},{id:17,name:"Tenis",image:"../assets/tenis.jpg",url:"",description:"Charly",size:"9",price:"459"},{id:18,name:"Tac\xf3n",image:"../assets/tacon.jpg",url:"",description:"Spring",size:"26",price:"449"},{id:19,name:"Zapato hombre",image:"../assets/zapato.jpg",url:"",description:"Privalia",size:"8",price:"639"},{id:20,name:"Chancla playa",image:"../assets/chancla.jpg",url:"",description:"Summer",size:"7",price:"89"},{id:21,name:"Sudadera",image:"../assets/sudadera.jpg",url:"",description:"Piru",size:"14",price:"259"},{id:22,name:"Playera",image:"../assets/thing.jpg",url:"",description:"Sibuts",size:"12",price:"249"},{id:23,name:"Impermeable",image:"../assets/impermeable.png",url:"",description:"Peques",size:"2 a 3 a\xf1os",price:"439"},{id:24,name:"Vestido",image:"../assets/vestido.jpg",url:"",description:"Up",size:"3 a\xf1os",price:"279"},{id:25,name:"Arroz",image:"../assets/arroz.jpg",url:"",description:"Verde valle",size:"32",price:"34"},{id:26,name:"Frijol",image:"../assets/frijol.jpg",url:"",description:"Frijolin",size:"L",price:"39"},{id:27,name:"Elote",image:"../assets/elote.jpg",url:"",description:"La coste\xf1a",size:"M",price:"19"},{id:28,name:"Champi\xf1ones",image:"../assets/champi.jpg",url:"",description:"Herdez",size:"38",price:"25"},{id:29,name:"Hisopos",image:"../assets/hisopo.jpg",url:"",description:"Medimart",size:"32",price:"24"},{id:30,name:"Alcohol et\xedlico",image:"../assets/alcohol.jpg",url:"",description:"Jaloma",size:"L",price:"29"},{id:31,name:"Agua oxigenada",image:"../assets/oxi.jpg",url:"",description:"Alcofarma",size:"M",price:"19"},{id:32,name:"Torundas",image:"../assets/torunda.jpg",url:"",description:"Medimart",size:"38",price:"42"},{id:33,name:"Tomate",image:"../assets/tomate.jpg",url:"",description:"Soriana",size:"32",price:"44 kg"},{id:34,name:"Cebolla",image:"../assets/cebolla.jpg",url:"",description:"Soriana",size:"L",price:"11 kg"},{id:35,name:"Manzana roja",image:"../assets/manzana.jpg",url:"",description:"Soriana",size:"M",price:"42 kg"},{id:36,name:"Platano Chiapas",image:"../assets/platano.jpg",url:"",description:"Soriana",size:"38",price:"10 kg"}],this.items=[],this.subtotal=0,this.total=0,this.envio=49}getNumberItems(){return this.items.length}addToCart(t){this.items.push(this.hardcode[t-1]),this.subtotal=this.subtotal+parseFloat(this.hardcode[t-1].price)}removeProduct(t){for(var e=0;e<this.items.length;)this.items[e].id===t?this.items.splice(e,1):++e;this.subtotal=this.subtotal-parseFloat(this.hardcode[t-1].price)}emptyCart(){this.items.length=0,this.subtotal=0,console.log(this.items)}getSubtotal(){return this.subtotal}getTotal(){return this.total=this.subtotal+this.envio,this.total}getEnvio(){return this.envio}envioGratis(){return this.envio=0,this.envio}getItems(){return this.items}setDatos(t,e,n,r){this.dia=t,this.hora=e,this.direccion=n,this.numero=r}getDia(){return this.dia}getHora(){return this.hora}getDireccion(){return this.direccion}getNumero(){return this.numero}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=r.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()}}]);